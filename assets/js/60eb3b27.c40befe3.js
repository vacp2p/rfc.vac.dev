"use strict";(self.webpackChunklogos_docs_template=self.webpackChunklogos_docs_template||[]).push([[7409],{11636:(e,a,t)=>{t.r(a),t.d(a,{assets:()=>m,contentTitle:()=>i,default:()=>h,frontMatter:()=>s,metadata:()=>p,toc:()=>o});var n=t(87462),r=(t(67294),t(3905));const s={title:"17/WAKU2-RLN-RELAY",name:"Waku v2 RLN Relay",status:"draft",editor:"Alvaro Revuelta &lt;alvaro@status.im&gt;",contributors:["Oskar Thor\xe9n &lt;oskarth@titanproxy.com&gt;","Aaryamann Challani &lt;p1ge0nh8er@proton.me&gt;","Sanaz Taheri &lt;sanaz@status.im&gt;","Hanno Cornelius &lt;hanno@status.im&gt;"]},i=void 0,p={unversionedId:"standards/core/17/rln-relay",id:"standards/core/17/rln-relay",title:"17/WAKU2-RLN-RELAY",description:"- Status: draft",source:"@site/waku/standards/core/17/rln-relay.md",sourceDirName:"standards/core/17",slug:"/standards/core/17/rln-relay",permalink:"/waku/standards/core/17/rln-relay",draft:!1,tags:[],version:"current",frontMatter:{title:"17/WAKU2-RLN-RELAY",name:"Waku v2 RLN Relay",status:"draft",editor:"Alvaro Revuelta &lt;alvaro@status.im&gt;",contributors:["Oskar Thor\xe9n &lt;oskarth@titanproxy.com&gt;","Aaryamann Challani &lt;p1ge0nh8er@proton.me&gt;","Sanaz Taheri &lt;sanaz@status.im&gt;","Hanno Cornelius &lt;hanno@status.im&gt;"]},sidebar:"defaultSidebar",previous:{title:"15/WAKU-BRIDGE",permalink:"/waku/standards/core/15/bridge"},next:{title:"19/WAKU2-LIGHTPUSH",permalink:"/waku/standards/core/19/lightpush"}},m={},o=[{value:"Abstract",id:"abstract",level:2},{value:"Motivation",id:"motivation",level:2},{value:"Specification",id:"specification",level:2},{value:"Flow",id:"flow",level:3},{value:"Setup and Registration",id:"setup-and-registration",level:4},{value:"Publishing",id:"publishing",level:4},{value:"Group Synchronization",id:"group-synchronization",level:4},{value:"Routing",id:"routing",level:4},{value:"Epoch Validation",id:"epoch-validation",level:5},{value:"Merkle Root Validation",id:"merkle-root-validation",level:5},{value:"Proof Verification",id:"proof-verification",level:5},{value:"Spam detection",id:"spam-detection",level:5},{value:"Payloads",id:"payloads",level:3},{value:"WakuMessage",id:"wakumessage",level:4},{value:"RateLimitProof",id:"ratelimitproof",level:4},{value:"Recommended System Parameters",id:"recommended-system-parameters",level:3},{value:"Epoch Length",id:"epoch-length",level:4},{value:"Maximum Epoch Gap",id:"maximum-epoch-gap",level:4},{value:"Copyright",id:"copyright",level:2},{value:"References",id:"references",level:2}],l={toc:o};function h(e){let{components:a,...s}=e;return(0,r.kt)("wrapper",(0,n.Z)({},l,s,{components:a,mdxType:"MDXLayout"}),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Status: draft"),(0,r.kt)("li",{parentName:"ul"},"Editor: Alvaro Revuelta ","<",(0,r.kt)("a",{parentName:"li",href:"mailto:alvaro@status.im"},"alvaro@status.im"),">"),(0,r.kt)("li",{parentName:"ul"},"Contributors:",(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"Oskar Thor\xe9n ","<",(0,r.kt)("a",{parentName:"li",href:"mailto:oskarth@titanproxy.com"},"oskarth@titanproxy.com"),">"),(0,r.kt)("li",{parentName:"ul"},"Aaryamann Challani ","<",(0,r.kt)("a",{parentName:"li",href:"mailto:p1ge0nh8er@proton.me"},"p1ge0nh8er@proton.me"),">"),(0,r.kt)("li",{parentName:"ul"},"Sanaz Taheri ","<",(0,r.kt)("a",{parentName:"li",href:"mailto:sanaz@status.im"},"sanaz@status.im"),">"),(0,r.kt)("li",{parentName:"ul"},"Hanno Cornelius ","<",(0,r.kt)("a",{parentName:"li",href:"mailto:hanno@status.im"},"hanno@status.im"),">")))),(0,r.kt)("h2",{id:"abstract"},"Abstract"),(0,r.kt)("p",null,"This specification describes the ",(0,r.kt)("inlineCode",{parentName:"p"},"17/WAKU2-RLN-RELAY")," protocol,\nwhich is an extension of ",(0,r.kt)("a",{parentName:"p",href:"../11/relay"},(0,r.kt)("inlineCode",{parentName:"a"},"11/WAKU2-RELAY")),"\nto provide spam protection using ",(0,r.kt)("a",{parentName:"p",href:"//vac/32/rln-v1"},"Rate Limiting Nullifiers (RLN)"),"."),(0,r.kt)("p",null,"The security objective is to contain spam activity in the (64/WAKU-NETWORK)[]\nby enforcing a global messaging rate to all the peers.\nPeers that violate the messaging rate are considered spammers and\ntheir message is considered spam.\nSpammers are also financially punished and removed from the system."),(0,r.kt)("h2",{id:"motivation"},"Motivation"),(0,r.kt)("p",null,"In open and anonymous p2p messaging networks,\none big problem is spam resistance.\nExisting solutions, such as Whisper\u2019s proof of work,\nare computationally expensive hence not suitable for resource-limited nodes.\nOther reputation-based approaches might not be desirable,\ndue to issues around arbitrary exclusion and privacy."),(0,r.kt)("p",null,"We augment the ",(0,r.kt)("a",{parentName:"p",href:"../11/relay"},(0,r.kt)("inlineCode",{parentName:"a"},"11/WAKU2-RELAY"))," protocol\nwith a novel construct of ",(0,r.kt)("a",{parentName:"p",href:"//vac/32/rln-v1"},"RLN"),"\nto enable an efficient economic spam prevention mechanism\nthat can be run in resource-constrained environments."),(0,r.kt)("h2",{id:"specification"},"Specification"),(0,r.kt)("p",null,"The key words \u201cMUST\u201d, \u201cMUST NOT\u201d, \u201cREQUIRED\u201d, \u201cSHALL\u201d, \u201cSHALL NOT\u201d, \u201cSHOULD\u201d,\n\u201cSHOULD NOT\u201d, \u201cRECOMMENDED\u201d, \u201cMAY\u201d, and\n\u201cOPTIONAL\u201d in this document are to be interpreted as described in\xa0",(0,r.kt)("a",{parentName:"p",href:"https://www.ietf.org/rfc/rfc2119.txt"},"2119"),"."),(0,r.kt)("h3",{id:"flow"},"Flow"),(0,r.kt)("p",null,"The messaging rate is defined by the ",(0,r.kt)("inlineCode",{parentName:"p"},"period"),"\nwhich indicates how many messages can be sent in a given period.\nWe define an ",(0,r.kt)("inlineCode",{parentName:"p"},"epoch")," as ",(0,r.kt)("span",{parentName:"p",className:"math math-inline"},(0,r.kt)("span",{parentName:"span",className:"katex"},(0,r.kt)("span",{parentName:"span",className:"katex-mathml"},(0,r.kt)("math",{parentName:"span",xmlns:"http://www.w3.org/1998/Math/MathML"},(0,r.kt)("semantics",{parentName:"math"},(0,r.kt)("mrow",{parentName:"semantics"},(0,r.kt)("mo",{parentName:"mrow",stretchy:"false"},"\u2308")),(0,r.kt)("annotation",{parentName:"semantics",encoding:"application/x-tex"},"\\lceil")))),(0,r.kt)("span",{parentName:"span",className:"katex-html","aria-hidden":"true"},(0,r.kt)("span",{parentName:"span",className:"base"},(0,r.kt)("span",{parentName:"span",className:"strut",style:{height:"1em",verticalAlign:"-0.25em"}}),(0,r.kt)("span",{parentName:"span",className:"mopen"},"\u2308")))))," ",(0,r.kt)("inlineCode",{parentName:"p"},"unix_time")," / ",(0,r.kt)("inlineCode",{parentName:"p"},"period")," ",(0,r.kt)("span",{parentName:"p",className:"math math-inline"},(0,r.kt)("span",{parentName:"span",className:"katex"},(0,r.kt)("span",{parentName:"span",className:"katex-mathml"},(0,r.kt)("math",{parentName:"span",xmlns:"http://www.w3.org/1998/Math/MathML"},(0,r.kt)("semantics",{parentName:"math"},(0,r.kt)("mrow",{parentName:"semantics"},(0,r.kt)("mo",{parentName:"mrow",stretchy:"false"},"\u2309")),(0,r.kt)("annotation",{parentName:"semantics",encoding:"application/x-tex"},"\\rceil")))),(0,r.kt)("span",{parentName:"span",className:"katex-html","aria-hidden":"true"},(0,r.kt)("span",{parentName:"span",className:"base"},(0,r.kt)("span",{parentName:"span",className:"strut",style:{height:"1em",verticalAlign:"-0.25em"}}),(0,r.kt)("span",{parentName:"span",className:"mclose"},"\u2309"))))),".\nFor example, if ",(0,r.kt)("inlineCode",{parentName:"p"},"unix_time")," is ",(0,r.kt)("inlineCode",{parentName:"p"},"1644810116")," and we set ",(0,r.kt)("inlineCode",{parentName:"p"},"period")," to ",(0,r.kt)("inlineCode",{parentName:"p"},"30"),",\nthen ",(0,r.kt)("inlineCode",{parentName:"p"},"epoch")," is  ",(0,r.kt)("span",{parentName:"p",className:"math math-inline"},(0,r.kt)("span",{parentName:"span",className:"katex"},(0,r.kt)("span",{parentName:"span",className:"katex-mathml"},(0,r.kt)("math",{parentName:"span",xmlns:"http://www.w3.org/1998/Math/MathML"},(0,r.kt)("semantics",{parentName:"math"},(0,r.kt)("mrow",{parentName:"semantics"},(0,r.kt)("mo",{parentName:"mrow",stretchy:"false"},"\u2308")),(0,r.kt)("annotation",{parentName:"semantics",encoding:"application/x-tex"},"\\lceil")))),(0,r.kt)("span",{parentName:"span",className:"katex-html","aria-hidden":"true"},(0,r.kt)("span",{parentName:"span",className:"base"},(0,r.kt)("span",{parentName:"span",className:"strut",style:{height:"1em",verticalAlign:"-0.25em"}}),(0,r.kt)("span",{parentName:"span",className:"mopen"},"\u2308")))))," ",(0,r.kt)("inlineCode",{parentName:"p"},"(unix_time/period)")," ",(0,r.kt)("span",{parentName:"p",className:"math math-inline"},(0,r.kt)("span",{parentName:"span",className:"katex"},(0,r.kt)("span",{parentName:"span",className:"katex-mathml"},(0,r.kt)("math",{parentName:"span",xmlns:"http://www.w3.org/1998/Math/MathML"},(0,r.kt)("semantics",{parentName:"math"},(0,r.kt)("mrow",{parentName:"semantics"},(0,r.kt)("mo",{parentName:"mrow",stretchy:"false"},"\u2309")),(0,r.kt)("annotation",{parentName:"semantics",encoding:"application/x-tex"},"\\rceil")))),(0,r.kt)("span",{parentName:"span",className:"katex-html","aria-hidden":"true"},(0,r.kt)("span",{parentName:"span",className:"base"},(0,r.kt)("span",{parentName:"span",className:"strut",style:{height:"1em",verticalAlign:"-0.25em"}}),(0,r.kt)("span",{parentName:"span",className:"mclose"},"\u2309")))))," ",(0,r.kt)("inlineCode",{parentName:"p"},"= 54827003"),"."),(0,r.kt)("p",null,">"," ",(0,r.kt)("strong",{parentName:"p"},"NOTE:")," The ",(0,r.kt)("inlineCode",{parentName:"p"},"epoch")," refers to the epoch in RLN and not Unix epoch.\nThis means a message can only be sent every period,\nwhere the ",(0,r.kt)("inlineCode",{parentName:"p"},"period")," is up to the application."),(0,r.kt)("p",null,"See section ",(0,r.kt)("a",{parentName:"p",href:"#recommended-system-parameters"},"Recommended System Parameters"),"\nfor the RECOMMENDED method to set a sensible ",(0,r.kt)("inlineCode",{parentName:"p"},"period")," value depending on the application.\nPeers subscribed to a spam-protected ",(0,r.kt)("inlineCode",{parentName:"p"},"pubsubTopic"),"\nare only allowed to send one message per ",(0,r.kt)("inlineCode",{parentName:"p"},"epoch"),".\nThe higher-level layers adopting ",(0,r.kt)("inlineCode",{parentName:"p"},"17/WAKU2-RLN-RELAY"),"\nMAY choose to enforce the messaging rate for ",(0,r.kt)("inlineCode",{parentName:"p"},"WakuMessages"),"\nwith a specific ",(0,r.kt)("inlineCode",{parentName:"p"},"contentTopic")," published on a ",(0,r.kt)("inlineCode",{parentName:"p"},"pubsubTopic"),"."),(0,r.kt)("h4",{id:"setup-and-registration"},"Setup and Registration"),(0,r.kt)("p",null,"A ",(0,r.kt)("inlineCode",{parentName:"p"},"pubsubTopic")," that is spam-protected requires subscribed peers to form a ",(0,r.kt)("a",{parentName:"p",href:"//vac/32/rln-v1"},"RLN group"),"."),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Peers MUST be registered to the RLN group to be able to publish messages."),(0,r.kt)("li",{parentName:"ul"},"Registration MAY be moderated through a smart contract\ndeployed on the Ethereum blockchain.")),(0,r.kt)("p",null,"Each peer has an ",(0,r.kt)("a",{parentName:"p",href:"//vac/32/rln-v1"},"RLN key pair")," denoted by ",(0,r.kt)("inlineCode",{parentName:"p"},"sk"),"\nand ",(0,r.kt)("inlineCode",{parentName:"p"},"pk"),"."),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"The secret key ",(0,r.kt)("inlineCode",{parentName:"li"},"sk")," is secret data and MUST be persisted securely by the peer."),(0,r.kt)("li",{parentName:"ul"},"The state of the membership contract\nSHOULD contain a list of all registered members' public identity keys i.e., ",(0,r.kt)("inlineCode",{parentName:"li"},"pk"),"s.")),(0,r.kt)("p",null,"For registration,\na peer MUST create a transaction to invoke the registration function on the contract,\nwhich registers its ",(0,r.kt)("inlineCode",{parentName:"p"},"pk")," in the RLN group."),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"The transaction MUST transfer additional tokens to the contract to be staked.\nThis amount is denoted by ",(0,r.kt)("inlineCode",{parentName:"li"},"staked_fund")," and is a system parameter.\nThe peer who has the secret key ",(0,r.kt)("inlineCode",{parentName:"li"},"sk")," associated with a registered ",(0,r.kt)("inlineCode",{parentName:"li"},"pk"),"\nwould be able to withdraw a portion ",(0,r.kt)("inlineCode",{parentName:"li"},"reward_portion"),"\nof the staked fund by providing valid proof.")),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"reward_portion")," is also a system parameter."),(0,r.kt)("p",null,">"," ",(0,r.kt)("strong",{parentName:"p"},"NOTE:")," Initially ",(0,r.kt)("inlineCode",{parentName:"p"},"sk")," is only known to its owning peer however,\nit may get exposed to other peers in case the owner attempts spamming the system\ni.e., sending more than one message per ",(0,r.kt)("inlineCode",{parentName:"p"},"epoch"),"."),(0,r.kt)("p",null,"An overview of registration is illustrated in Figure 1."),(0,r.kt)("p",null,(0,r.kt)("img",{alt:"Figure 1: Registration.",src:t(95926).Z,width:"1257",height:"1016"})),(0,r.kt)("h4",{id:"publishing"},"Publishing"),(0,r.kt)("p",null,"To publish at a given ",(0,r.kt)("inlineCode",{parentName:"p"},"epoch"),", the publishing peer proceeds\nbased on the regular ",(0,r.kt)("a",{parentName:"p",href:"../11/relay"},(0,r.kt)("inlineCode",{parentName:"a"},"11/WAKU2-RELAY"))," protocol.\nHowever, to protect against spamming, each ",(0,r.kt)("inlineCode",{parentName:"p"},"WakuMessage"),"\n(which is wrapped inside the ",(0,r.kt)("inlineCode",{parentName:"p"},"data")," field of a PubSub message)\nMUST carry a ",(0,r.kt)("a",{parentName:"p",href:"#ratelimitproof"},(0,r.kt)("inlineCode",{parentName:"a"},"RateLimitProof"))," with the following fields.\nSection ",(0,r.kt)("a",{parentName:"p",href:"#payloads"},"Payload")," covers the details about the type and\nencoding of these fields."),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"The ",(0,r.kt)("inlineCode",{parentName:"li"},"merkle_root")," contains the root of the Merkle tree."),(0,r.kt)("li",{parentName:"ul"},"The ",(0,r.kt)("inlineCode",{parentName:"li"},"epoch")," represents the current epoch."),(0,r.kt)("li",{parentName:"ul"},"The ",(0,r.kt)("inlineCode",{parentName:"li"},"nullifier")," is an internal nullifier acting as a fingerprint\nthat allows specifying whether two messages are published by the same peer\nduring the same ",(0,r.kt)("inlineCode",{parentName:"li"},"epoch"),"."),(0,r.kt)("li",{parentName:"ul"},"The ",(0,r.kt)("inlineCode",{parentName:"li"},"nullifier")," is a deterministic value derived from ",(0,r.kt)("inlineCode",{parentName:"li"},"sk")," and\n",(0,r.kt)("inlineCode",{parentName:"li"},"epoch")," therefore any two messages issued by the same peer\n(i.e., using the same ",(0,r.kt)("inlineCode",{parentName:"li"},"sk"),")\nfor the same ",(0,r.kt)("inlineCode",{parentName:"li"},"epoch")," are guaranteed to have identical ",(0,r.kt)("inlineCode",{parentName:"li"},"nullifier"),"s."),(0,r.kt)("li",{parentName:"ul"},"The ",(0,r.kt)("inlineCode",{parentName:"li"},"share_x")," and\n",(0,r.kt)("inlineCode",{parentName:"li"},"share_y")," can be seen as partial disclosure of peer's ",(0,r.kt)("inlineCode",{parentName:"li"},"sk")," for the intended ",(0,r.kt)("inlineCode",{parentName:"li"},"epoch"),".\nThey are derived deterministically from peer's ",(0,r.kt)("inlineCode",{parentName:"li"},"sk")," and\ncurrent ",(0,r.kt)("inlineCode",{parentName:"li"},"epoch")," using ",(0,r.kt)("a",{parentName:"li",href:"//vac/32/rln-v1"},"Shamir secret sharing scheme"),".")),(0,r.kt)("p",null,"If a peer discloses more than one such pair (",(0,r.kt)("inlineCode",{parentName:"p"},"share_x"),", ",(0,r.kt)("inlineCode",{parentName:"p"},"share_y"),") for the same ",(0,r.kt)("inlineCode",{parentName:"p"},"epoch"),",\nit would allow full disclosure of its  ",(0,r.kt)("inlineCode",{parentName:"p"},"sk")," and\nhence get access to its staked fund in the membership contract."),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"The ",(0,r.kt)("inlineCode",{parentName:"li"},"proof")," field is a zero-knowledge proof signifying that:")),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"The message owner is the current member of the group i.e.,\nthe peer's identity commitment key, ",(0,r.kt)("inlineCode",{parentName:"li"},"pk"),",\nis part of the membership group Merkle tree with the root ",(0,r.kt)("inlineCode",{parentName:"li"},"merkle_root"),"."),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("inlineCode",{parentName:"li"},"share_x")," and ",(0,r.kt)("inlineCode",{parentName:"li"},"share_y")," are correctly computed."),(0,r.kt)("li",{parentName:"ol"},"The ",(0,r.kt)("inlineCode",{parentName:"li"},"nullifier")," is constructed correctly.\nFor more details about the proof generation check ",(0,r.kt)("a",{parentName:"li",href:"//vac/32/rln-v1"},"RLN"),"\nThe proof generation relies on the knowledge of two pieces of private information\ni.e., ",(0,r.kt)("inlineCode",{parentName:"li"},"sk")," and ",(0,r.kt)("inlineCode",{parentName:"li"},"authPath"),".\nThe ",(0,r.kt)("inlineCode",{parentName:"li"},"authPath")," is a subset of Merkle tree nodes\nby which a peer can prove the inclusion of its ",(0,r.kt)("inlineCode",{parentName:"li"},"pk")," in the group.")),(0,r.kt)("p",null,"The proof generation also requires a set of public inputs which are:\nthe Merkle tree root ",(0,r.kt)("inlineCode",{parentName:"p"},"merkle_root"),", the current ",(0,r.kt)("inlineCode",{parentName:"p"},"epoch"),", and\nthe message for which the proof is going to be generated.\nIn ",(0,r.kt)("inlineCode",{parentName:"p"},"17/WAKU2-RLN-RELAY"),",\nthe message is the concatenation of ",(0,r.kt)("inlineCode",{parentName:"p"},"WakuMessage"),"'s  ",(0,r.kt)("inlineCode",{parentName:"p"},"payload")," filed and\nits ",(0,r.kt)("inlineCode",{parentName:"p"},"contentTopic")," i.e., ",(0,r.kt)("inlineCode",{parentName:"p"},"payload||contentTopic"),"."),(0,r.kt)("h4",{id:"group-synchronization"},"Group Synchronization"),(0,r.kt)("p",null,"Proof generation relies on the knowledge of Merkle tree root ",(0,r.kt)("inlineCode",{parentName:"p"},"merkle_root")," and\n",(0,r.kt)("inlineCode",{parentName:"p"},"authPath")," which both require access to the membership Merkle tree.\nGetting access to the Merkle tree can be done in various ways:"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Peers construct the tree locally.\nThis can be done by listening to the registration and\ndeletion events emitted by the membership contract.\nPeers MUST update the local Merkle tree on a per-block basis.\nThis is discussed further\nin the ",(0,r.kt)("a",{parentName:"p",href:"#merkle-root-validation"},"Merkle Root Validation")," section.")),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"For synchronizing the state of slashed ",(0,r.kt)("inlineCode",{parentName:"p"},"pk"),"s,\ndisseminate such information through a ",(0,r.kt)("inlineCode",{parentName:"p"},"pubsubTopic")," to which all peers are subscribed.\nA deletion transaction SHOULD occur on the membership contract.\nThe benefit of an off-chain slashing\nis that it allows real-time removal of spammers as opposed to on-chain slashing\nin which peers get informed with a delay,\nwhere the delay is due to mining the slashing transaction."))),(0,r.kt)("p",null,"For the group synchronization,\none important security consideration is that peers MUST make sure they always use\nthe most recent Merkle tree root in their proof generation.\nThe reason is that using an old root can allow inference\nabout the index of the user's ",(0,r.kt)("inlineCode",{parentName:"p"},"pk")," in the membership tree\nhence compromising user privacy and breaking message unlinkability."),(0,r.kt)("h4",{id:"routing"},"Routing"),(0,r.kt)("p",null,"Upon the receipt of a PubSub message via ",(0,r.kt)("a",{parentName:"p",href:"../11/relay"},(0,r.kt)("inlineCode",{parentName:"a"},"11/WAKU2-RELAY"))," protocol,\nthe routing peer parses the ",(0,r.kt)("inlineCode",{parentName:"p"},"data")," field as a ",(0,r.kt)("inlineCode",{parentName:"p"},"WakuMessage")," and\ngets access to the ",(0,r.kt)("inlineCode",{parentName:"p"},"RateLimitProof")," field.",(0,r.kt)("br",{parentName:"p"}),"\n","The peer then validates the ",(0,r.kt)("inlineCode",{parentName:"p"},"RateLimitProof"),"  as explained next."),(0,r.kt)("h5",{id:"epoch-validation"},"Epoch Validation"),(0,r.kt)("p",null,"If the ",(0,r.kt)("inlineCode",{parentName:"p"},"epoch")," attached to the ",(0,r.kt)("inlineCode",{parentName:"p"},"WakuMessage")," is more than ",(0,r.kt)("inlineCode",{parentName:"p"},"max_epoch_gap"),",\napart from the routing peer's current ",(0,r.kt)("inlineCode",{parentName:"p"},"epoch"),",\nthen the ",(0,r.kt)("inlineCode",{parentName:"p"},"WakuMessage")," MUST be discarded and considered invalid.\nThis is to prevent a newly registered peer from spamming the system\nby messaging for all the past epochs.\n",(0,r.kt)("inlineCode",{parentName:"p"},"max_epoch_gap")," is a system parameter\nfor which we provide some recommendations in section ",(0,r.kt)("a",{parentName:"p",href:"#recommended-system-parameters"},"Recommended System Parameters"),"."),(0,r.kt)("h5",{id:"merkle-root-validation"},"Merkle Root Validation"),(0,r.kt)("p",null,"The routing peers MUST check whether the provided Merkle root\nin the ",(0,r.kt)("inlineCode",{parentName:"p"},"RateLimitProof")," is valid.\nIt can do so by maintaining a local set of valid Merkle roots,\nwhich consist of ",(0,r.kt)("inlineCode",{parentName:"p"},"acceptable_root_window_size")," past roots.\nThese roots refer to the final state of the Merkle tree\nafter a whole block consisting of group changes is processed.\nThe Merkle roots are updated on a per-block basis instead of a per-event basis.\nThis is done because if Merkle roots are updated on a per-event basis,\nsome peers could send messages with a root that refers to a Merkle tree state\nthat might get invalidated while the message is still propagating in the network,\ndue to many registrations happening during this time frame.\nBy updating roots on a per-block basis instead,\nwe will have only one root update per-block processed,\nregardless on how many registrations happened in a block, and\npeers will be able to successfully propagate messages in a time frame\ncorresponding to roughly the size of the roots window times the block mining time."),(0,r.kt)("p",null,"Atomic processing of the blocks are necessary\nso that even if the peer is unable to process one event,\nthe previous roots remain valid, and can be used to generate valid RateLimitProof's."),(0,r.kt)("p",null,"This also allows peers which are not well connected to the network\nto be able to send messages, accounting for network delay.\nThis network delay is related to the nature of asynchronous network conditions,\nwhich means that peers see membership changes asynchronously, and\ntherefore may have differing local Merkle trees.\nSee ",(0,r.kt)("a",{parentName:"p",href:"#recommended-system-parameters"},"Recommended System Parameters"),"\non choosing an appropriate ",(0,r.kt)("inlineCode",{parentName:"p"},"acceptable_root_window_size"),"."),(0,r.kt)("h5",{id:"proof-verification"},"Proof Verification"),(0,r.kt)("p",null,"The routing peers MUST check whether the zero-knowledge proof ",(0,r.kt)("inlineCode",{parentName:"p"},"proof")," is valid.\nIt does so by running the zk verification algorithm as explained in ",(0,r.kt)("a",{parentName:"p",href:"//vac/32/rln-v1"},"RLN"),".\nIf ",(0,r.kt)("inlineCode",{parentName:"p"},"proof")," is invalid then the message MUST be discarded."),(0,r.kt)("h5",{id:"spam-detection"},"Spam detection"),(0,r.kt)("p",null,"To enable local spam detection and slashing,\nrouting peers MUST record the ",(0,r.kt)("inlineCode",{parentName:"p"},"nullifier"),", ",(0,r.kt)("inlineCode",{parentName:"p"},"share_x"),", and ",(0,r.kt)("inlineCode",{parentName:"p"},"share_y"),"\nof incoming messages which are not discarded i.e.,\nnot found spam or with invalid proof or epoch.\nTo spot spam messages, the peer checks whether a message\nwith an identical ",(0,r.kt)("inlineCode",{parentName:"p"},"nullifier")," has already been relayed."),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"If such a message exists and its ",(0,r.kt)("inlineCode",{parentName:"li"},"share_x")," and ",(0,r.kt)("inlineCode",{parentName:"li"},"share_y"),"\ncomponents are different from the incoming message, then slashing takes place.\nThat is, the peer uses the  ",(0,r.kt)("inlineCode",{parentName:"li"},"share_x")," and ",(0,r.kt)("inlineCode",{parentName:"li"},"share_y"),"\nof the new message and the ",(0,r.kt)("inlineCode",{parentName:"li"},"share'_x")," and ",(0,r.kt)("inlineCode",{parentName:"li"},"share'_y"),"\nof the old record to reconstruct the ",(0,r.kt)("inlineCode",{parentName:"li"},"sk")," of the message owner.\nThe ",(0,r.kt)("inlineCode",{parentName:"li"},"sk")," then MAY be used to delete the spammer from the group and\nwithdraw a portion ",(0,r.kt)("inlineCode",{parentName:"li"},"reward_portion")," of its staked funds."),(0,r.kt)("li",{parentName:"ol"},"If the ",(0,r.kt)("inlineCode",{parentName:"li"},"share_x")," and\n",(0,r.kt)("inlineCode",{parentName:"li"},"share_y")," fields of the previously relayed message are identical\nto the incoming message,\nthen the message is a duplicate and MUST be discarded."),(0,r.kt)("li",{parentName:"ol"},"If none is found, then the message gets relayed.")),(0,r.kt)("p",null,"An overview of the routing procedure and slashing is provided in Figure 2."),(0,r.kt)("p",null,(0,r.kt)("img",{alt:"Figure 2: Publishing, Routing and Slashing workflow.",src:t(13974).Z,width:"816",height:"1323"})),(0,r.kt)("hr",null),(0,r.kt)("h3",{id:"payloads"},"Payloads"),(0,r.kt)("p",null,"Payloads are protobuf messages implemented using ",(0,r.kt)("a",{parentName:"p",href:"https://developers.google.com/protocol-buffers/"},"protocol buffers v3"),".\nNodes MAY extend the ",(0,r.kt)("a",{parentName:"p",href:"../14/message"},"14/WAKU2-MESSAGE"),"\nwith a ",(0,r.kt)("inlineCode",{parentName:"p"},"rate_limit_proof")," field to indicate that their message is not spam."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-diff"},'\nsyntax = "proto3";\n\nmessage RateLimitProof {\n  bytes proof = 1;\n  bytes merkle_root = 2;\n  bytes epoch = 3;\n  bytes share_x = 4;\n  bytes share_y = 5;\n  bytes nullifier = 6;\n}\n\nmessage WakuMessage {\n  bytes payload = 1;\n  string content_topic = 2;\n  optional uint32 version = 3;\n  optional sint64 timestamp = 10;\n  optional bool ephemeral = 31;\n  RateLimitProof rate_limit_proof = 21;\n}\n\n')),(0,r.kt)("h4",{id:"wakumessage"},"WakuMessage"),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"rate_limit_proof")," holds the information required to prove that the message owner\nhas not exceeded the message rate limit."),(0,r.kt)("h4",{id:"ratelimitproof"},"RateLimitProof"),(0,r.kt)("p",null,"Below is the description of the fields of ",(0,r.kt)("inlineCode",{parentName:"p"},"RateLimitProof")," and their types."),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:"right"},"Parameter"),(0,r.kt)("th",{parentName:"tr",align:null},"Type"),(0,r.kt)("th",{parentName:"tr",align:null},"Description"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"right"},(0,r.kt)("inlineCode",{parentName:"td"},"proof")),(0,r.kt)("td",{parentName:"tr",align:null},"array of 256 bytes uncompressed or 128 bytes compressed"),(0,r.kt)("td",{parentName:"tr",align:null},"the zkSNARK proof as explained in the ",(0,r.kt)("a",{parentName:"td",href:"#publishing"},"Publishing process"))),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"right"},(0,r.kt)("inlineCode",{parentName:"td"},"merkle_root")),(0,r.kt)("td",{parentName:"tr",align:null},"array of 32 bytes in little-endian order"),(0,r.kt)("td",{parentName:"tr",align:null},"the root of membership group Merkle tree at the time of publishing the message")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"right"},(0,r.kt)("inlineCode",{parentName:"td"},"share_x")," and ",(0,r.kt)("inlineCode",{parentName:"td"},"share_y")),(0,r.kt)("td",{parentName:"tr",align:null},"array of 32 bytes each"),(0,r.kt)("td",{parentName:"tr",align:null},"Shamir secret shares of the user's secret identity key ",(0,r.kt)("inlineCode",{parentName:"td"},"sk")," . ",(0,r.kt)("inlineCode",{parentName:"td"},"share_x")," is the Poseidon hash of the ",(0,r.kt)("inlineCode",{parentName:"td"},"WakuMessage"),"'s ",(0,r.kt)("inlineCode",{parentName:"td"},"payload")," concatenated with its ",(0,r.kt)("inlineCode",{parentName:"td"},"contentTopic")," . ",(0,r.kt)("inlineCode",{parentName:"td"},"share_y")," is calculated using ",(0,r.kt)("a",{parentName:"td",href:"//vac/32/rln-v1"},"Shamir secret sharing scheme"))),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"right"},(0,r.kt)("inlineCode",{parentName:"td"},"nullifier")),(0,r.kt)("td",{parentName:"tr",align:null},"array of 32 bytes"),(0,r.kt)("td",{parentName:"tr",align:null},"internal nullifier derived from ",(0,r.kt)("inlineCode",{parentName:"td"},"epoch")," and peer's ",(0,r.kt)("inlineCode",{parentName:"td"},"sk")," as explained in ",(0,r.kt)("a",{parentName:"td",href:"//vac/32/rln-v1"},"RLN construct"))))),(0,r.kt)("h3",{id:"recommended-system-parameters"},"Recommended System Parameters"),(0,r.kt)("p",null,"The system parameters are summarized in the following table,\nand the RECOMMENDED values for a subset of them are presented next."),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:"right"},"Parameter"),(0,r.kt)("th",{parentName:"tr",align:null},"Description"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"right"},(0,r.kt)("inlineCode",{parentName:"td"},"period")),(0,r.kt)("td",{parentName:"tr",align:null},"the length of ",(0,r.kt)("inlineCode",{parentName:"td"},"epoch")," in seconds")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"right"},(0,r.kt)("inlineCode",{parentName:"td"},"staked_fund")),(0,r.kt)("td",{parentName:"tr",align:null},"the amount of funds to be staked by peers at the registration")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"right"},(0,r.kt)("inlineCode",{parentName:"td"},"reward_portion")),(0,r.kt)("td",{parentName:"tr",align:null},"the percentage of ",(0,r.kt)("inlineCode",{parentName:"td"},"staked_fund")," to be rewarded to the slashers")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"right"},(0,r.kt)("inlineCode",{parentName:"td"},"max_epoch_gap")),(0,r.kt)("td",{parentName:"tr",align:null},"the maximum allowed gap between the ",(0,r.kt)("inlineCode",{parentName:"td"},"epoch")," of a routing peer and the incoming message")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"right"},(0,r.kt)("inlineCode",{parentName:"td"},"acceptable_root_window_size")),(0,r.kt)("td",{parentName:"tr",align:null},"The maximum number of past Merkle roots to store")))),(0,r.kt)("h4",{id:"epoch-length"},"Epoch Length"),(0,r.kt)("p",null,"A sensible value for the ",(0,r.kt)("inlineCode",{parentName:"p"},"period")," depends on the application\nfor which the spam protection is going to be used.\nFor example, while the ",(0,r.kt)("inlineCode",{parentName:"p"},"period")," of ",(0,r.kt)("inlineCode",{parentName:"p"},"1")," second i.e.,\nmessaging rate of ",(0,r.kt)("inlineCode",{parentName:"p"},"1")," per second, might be acceptable for a chat application,\nmight be too low for communication among Ethereum network validators.\nOne should look at the desired throughput of the application\nto decide on a proper ",(0,r.kt)("inlineCode",{parentName:"p"},"period")," value."),(0,r.kt)("h4",{id:"maximum-epoch-gap"},"Maximum Epoch Gap"),(0,r.kt)("p",null,"We discussed in the ",(0,r.kt)("a",{parentName:"p",href:"#routing"},"Routing")," section that the gap between the epoch\nobserved by the routing peer and\nthe one attached to the incoming message\nshould not exceed a threshold denoted by ",(0,r.kt)("inlineCode",{parentName:"p"},"max_epoch_gap"),".\nThe value of ",(0,r.kt)("inlineCode",{parentName:"p"},"max_epoch_gap")," can be measured based on the following factors."),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Network transmission delay ",(0,r.kt)("inlineCode",{parentName:"li"},"Network_Delay"),":\nthe maximum time that it takes for a message to be fully disseminated\nin the GossipSub network."),(0,r.kt)("li",{parentName:"ul"},"Clock asynchrony ",(0,r.kt)("inlineCode",{parentName:"li"},"Clock_Asynchrony"),":\nThe maximum difference between the Unix epoch clocks perceived\nby network peers which can be due to clock drifts.\n")),(0,r.kt)("p",null,"With a reasonable approximation of the preceding values,\none can set ",(0,r.kt)("inlineCode",{parentName:"p"},"max_epoch_gap")," as"),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"max_epoch_gap"),"\n",(0,r.kt)("span",{parentName:"p",className:"math math-inline"},(0,r.kt)("span",{parentName:"span",className:"katex"},(0,r.kt)("span",{parentName:"span",className:"katex-mathml"},(0,r.kt)("math",{parentName:"span",xmlns:"http://www.w3.org/1998/Math/MathML"},(0,r.kt)("semantics",{parentName:"math"},(0,r.kt)("mrow",{parentName:"semantics"},(0,r.kt)("mo",{parentName:"mrow"},"="),(0,r.kt)("mo",{parentName:"mrow",stretchy:"false"},"\u2308"),(0,r.kt)("mfrac",{parentName:"mrow"},(0,r.kt)("mrow",{parentName:"mfrac"},(0,r.kt)("mtext",{parentName:"mrow"},"Network\xa0Delay"),(0,r.kt)("mo",{parentName:"mrow"},"+"),(0,r.kt)("mtext",{parentName:"mrow"},"Clock\xa0Asynchrony")),(0,r.kt)("mtext",{parentName:"mfrac"},"Epoch\xa0Length")),(0,r.kt)("mo",{parentName:"mrow",stretchy:"false"},"\u2309")),(0,r.kt)("annotation",{parentName:"semantics",encoding:"application/x-tex"},"= \\lceil \\frac{\\text{Network Delay} + \\text{Clock Asynchrony}}{\\text{Epoch Length}}\\rceil")))),(0,r.kt)("span",{parentName:"span",className:"katex-html","aria-hidden":"true"},(0,r.kt)("span",{parentName:"span",className:"base"},(0,r.kt)("span",{parentName:"span",className:"strut",style:{height:"0.3669em"}}),(0,r.kt)("span",{parentName:"span",className:"mrel"},"="),(0,r.kt)("span",{parentName:"span",className:"mspace",style:{marginRight:"0.2778em"}})),(0,r.kt)("span",{parentName:"span",className:"base"},(0,r.kt)("span",{parentName:"span",className:"strut",style:{height:"1.4133em",verticalAlign:"-0.4811em"}}),(0,r.kt)("span",{parentName:"span",className:"mopen"},"\u2308"),(0,r.kt)("span",{parentName:"span",className:"mord"},(0,r.kt)("span",{parentName:"span",className:"mopen nulldelimiter"}),(0,r.kt)("span",{parentName:"span",className:"mfrac"},(0,r.kt)("span",{parentName:"span",className:"vlist-t vlist-t2"},(0,r.kt)("span",{parentName:"span",className:"vlist-r"},(0,r.kt)("span",{parentName:"span",className:"vlist",style:{height:"0.9322em"}},(0,r.kt)("span",{parentName:"span",style:{top:"-2.655em"}},(0,r.kt)("span",{parentName:"span",className:"pstrut",style:{height:"3em"}}),(0,r.kt)("span",{parentName:"span",className:"sizing reset-size6 size3 mtight"},(0,r.kt)("span",{parentName:"span",className:"mord mtight"},(0,r.kt)("span",{parentName:"span",className:"mord text mtight"},(0,r.kt)("span",{parentName:"span",className:"mord mtight"},"Epoch\xa0Length"))))),(0,r.kt)("span",{parentName:"span",style:{top:"-3.23em"}},(0,r.kt)("span",{parentName:"span",className:"pstrut",style:{height:"3em"}}),(0,r.kt)("span",{parentName:"span",className:"frac-line",style:{borderBottomWidth:"0.04em"}})),(0,r.kt)("span",{parentName:"span",style:{top:"-3.4461em"}},(0,r.kt)("span",{parentName:"span",className:"pstrut",style:{height:"3em"}}),(0,r.kt)("span",{parentName:"span",className:"sizing reset-size6 size3 mtight"},(0,r.kt)("span",{parentName:"span",className:"mord mtight"},(0,r.kt)("span",{parentName:"span",className:"mord text mtight"},(0,r.kt)("span",{parentName:"span",className:"mord mtight"},"Network\xa0Delay")),(0,r.kt)("span",{parentName:"span",className:"mbin mtight"},"+"),(0,r.kt)("span",{parentName:"span",className:"mord text mtight"},(0,r.kt)("span",{parentName:"span",className:"mord mtight"},"Clock\xa0Asynchrony")))))),(0,r.kt)("span",{parentName:"span",className:"vlist-s"},"\u200b")),(0,r.kt)("span",{parentName:"span",className:"vlist-r"},(0,r.kt)("span",{parentName:"span",className:"vlist",style:{height:"0.4811em"}},(0,r.kt)("span",{parentName:"span"}))))),(0,r.kt)("span",{parentName:"span",className:"mclose nulldelimiter"})),(0,r.kt)("span",{parentName:"span",className:"mclose"},"\u2309"))))),"\nwhere  ",(0,r.kt)("inlineCode",{parentName:"p"},"period"),"  is the length of the ",(0,r.kt)("inlineCode",{parentName:"p"},"epoch")," in seconds.\n",(0,r.kt)("inlineCode",{parentName:"p"},"Network_Delay")," and ",(0,r.kt)("inlineCode",{parentName:"p"},"Clock_Asynchrony")," MUST have the same resolution as  ",(0,r.kt)("inlineCode",{parentName:"p"},"period"),".\nBy this formulation, ",(0,r.kt)("inlineCode",{parentName:"p"},"max_epoch_gap")," indeed measures the maximum number of ",(0,r.kt)("inlineCode",{parentName:"p"},"epoch"),"s\nthat can elapse since a message gets routed from its origin\nto all the other peers in the network."),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"acceptable_root_window_size")," depends upon the underlying chain's average blocktime,\n",(0,r.kt)("inlineCode",{parentName:"p"},"block_time")),(0,r.kt)("p",null,"The lower bound for the ",(0,r.kt)("inlineCode",{parentName:"p"},"acceptable_root_window_size")," SHOULD be set as ",(0,r.kt)("span",{parentName:"p",className:"math math-inline"},(0,r.kt)("span",{parentName:"span",className:"katex"},(0,r.kt)("span",{parentName:"span",className:"katex-mathml"},(0,r.kt)("math",{parentName:"span",xmlns:"http://www.w3.org/1998/Math/MathML"},(0,r.kt)("semantics",{parentName:"math"},(0,r.kt)("mrow",{parentName:"semantics"},(0,r.kt)("mi",{parentName:"mrow"},"a"),(0,r.kt)("mi",{parentName:"mrow"},"c"),(0,r.kt)("mi",{parentName:"mrow"},"c"),(0,r.kt)("mi",{parentName:"mrow"},"e"),(0,r.kt)("mi",{parentName:"mrow"},"p"),(0,r.kt)("mi",{parentName:"mrow"},"t"),(0,r.kt)("mi",{parentName:"mrow"},"a"),(0,r.kt)("mi",{parentName:"mrow"},"b"),(0,r.kt)("mi",{parentName:"mrow"},"l"),(0,r.kt)("msub",{parentName:"mrow"},(0,r.kt)("mi",{parentName:"msub"},"e"),(0,r.kt)("mi",{parentName:"msub"},"r")),(0,r.kt)("mi",{parentName:"mrow"},"o"),(0,r.kt)("mi",{parentName:"mrow"},"o"),(0,r.kt)("msub",{parentName:"mrow"},(0,r.kt)("mi",{parentName:"msub"},"t"),(0,r.kt)("mi",{parentName:"msub"},"w")),(0,r.kt)("mi",{parentName:"mrow"},"i"),(0,r.kt)("mi",{parentName:"mrow"},"n"),(0,r.kt)("mi",{parentName:"mrow"},"d"),(0,r.kt)("mi",{parentName:"mrow"},"o"),(0,r.kt)("msub",{parentName:"mrow"},(0,r.kt)("mi",{parentName:"msub"},"w"),(0,r.kt)("mi",{parentName:"msub"},"s")),(0,r.kt)("mi",{parentName:"mrow"},"i"),(0,r.kt)("mi",{parentName:"mrow"},"z"),(0,r.kt)("mi",{parentName:"mrow"},"e"),(0,r.kt)("mo",{parentName:"mrow"},"="),(0,r.kt)("mo",{parentName:"mrow",stretchy:"false"},"("),(0,r.kt)("mi",{parentName:"mrow"},"N"),(0,r.kt)("mi",{parentName:"mrow"},"e"),(0,r.kt)("mi",{parentName:"mrow"},"t"),(0,r.kt)("mi",{parentName:"mrow"},"w"),(0,r.kt)("mi",{parentName:"mrow"},"o"),(0,r.kt)("mi",{parentName:"mrow"},"r"),(0,r.kt)("msub",{parentName:"mrow"},(0,r.kt)("mi",{parentName:"msub"},"k"),(0,r.kt)("mi",{parentName:"msub"},"D")),(0,r.kt)("mi",{parentName:"mrow"},"e"),(0,r.kt)("mi",{parentName:"mrow"},"l"),(0,r.kt)("mi",{parentName:"mrow"},"a"),(0,r.kt)("mi",{parentName:"mrow"},"y"),(0,r.kt)("mo",{parentName:"mrow",stretchy:"false"},")"),(0,r.kt)("mi",{parentName:"mrow",mathvariant:"normal"},"/"),(0,r.kt)("mi",{parentName:"mrow"},"b"),(0,r.kt)("mi",{parentName:"mrow"},"l"),(0,r.kt)("mi",{parentName:"mrow"},"o"),(0,r.kt)("mi",{parentName:"mrow"},"c"),(0,r.kt)("msub",{parentName:"mrow"},(0,r.kt)("mi",{parentName:"msub"},"k"),(0,r.kt)("mi",{parentName:"msub"},"t")),(0,r.kt)("mi",{parentName:"mrow"},"i"),(0,r.kt)("mi",{parentName:"mrow"},"m"),(0,r.kt)("mi",{parentName:"mrow"},"e")),(0,r.kt)("annotation",{parentName:"semantics",encoding:"application/x-tex"},"acceptable_root_window_size=(Network_Delay)/block_time")))),(0,r.kt)("span",{parentName:"span",className:"katex-html","aria-hidden":"true"},(0,r.kt)("span",{parentName:"span",className:"base"},(0,r.kt)("span",{parentName:"span",className:"strut",style:{height:"0.8889em",verticalAlign:"-0.1944em"}}),(0,r.kt)("span",{parentName:"span",className:"mord mathnormal"},"a"),(0,r.kt)("span",{parentName:"span",className:"mord mathnormal"},"cce"),(0,r.kt)("span",{parentName:"span",className:"mord mathnormal"},"pt"),(0,r.kt)("span",{parentName:"span",className:"mord mathnormal"},"ab"),(0,r.kt)("span",{parentName:"span",className:"mord mathnormal",style:{marginRight:"0.01968em"}},"l"),(0,r.kt)("span",{parentName:"span",className:"mord"},(0,r.kt)("span",{parentName:"span",className:"mord mathnormal"},"e"),(0,r.kt)("span",{parentName:"span",className:"msupsub"},(0,r.kt)("span",{parentName:"span",className:"vlist-t vlist-t2"},(0,r.kt)("span",{parentName:"span",className:"vlist-r"},(0,r.kt)("span",{parentName:"span",className:"vlist",style:{height:"0.1514em"}},(0,r.kt)("span",{parentName:"span",style:{top:"-2.55em",marginLeft:"0em",marginRight:"0.05em"}},(0,r.kt)("span",{parentName:"span",className:"pstrut",style:{height:"2.7em"}}),(0,r.kt)("span",{parentName:"span",className:"sizing reset-size6 size3 mtight"},(0,r.kt)("span",{parentName:"span",className:"mord mathnormal mtight",style:{marginRight:"0.02778em"}},"r")))),(0,r.kt)("span",{parentName:"span",className:"vlist-s"},"\u200b")),(0,r.kt)("span",{parentName:"span",className:"vlist-r"},(0,r.kt)("span",{parentName:"span",className:"vlist",style:{height:"0.15em"}},(0,r.kt)("span",{parentName:"span"})))))),(0,r.kt)("span",{parentName:"span",className:"mord mathnormal"},"oo"),(0,r.kt)("span",{parentName:"span",className:"mord"},(0,r.kt)("span",{parentName:"span",className:"mord mathnormal"},"t"),(0,r.kt)("span",{parentName:"span",className:"msupsub"},(0,r.kt)("span",{parentName:"span",className:"vlist-t vlist-t2"},(0,r.kt)("span",{parentName:"span",className:"vlist-r"},(0,r.kt)("span",{parentName:"span",className:"vlist",style:{height:"0.1514em"}},(0,r.kt)("span",{parentName:"span",style:{top:"-2.55em",marginLeft:"0em",marginRight:"0.05em"}},(0,r.kt)("span",{parentName:"span",className:"pstrut",style:{height:"2.7em"}}),(0,r.kt)("span",{parentName:"span",className:"sizing reset-size6 size3 mtight"},(0,r.kt)("span",{parentName:"span",className:"mord mathnormal mtight",style:{marginRight:"0.02691em"}},"w")))),(0,r.kt)("span",{parentName:"span",className:"vlist-s"},"\u200b")),(0,r.kt)("span",{parentName:"span",className:"vlist-r"},(0,r.kt)("span",{parentName:"span",className:"vlist",style:{height:"0.15em"}},(0,r.kt)("span",{parentName:"span"})))))),(0,r.kt)("span",{parentName:"span",className:"mord mathnormal"},"in"),(0,r.kt)("span",{parentName:"span",className:"mord mathnormal"},"d"),(0,r.kt)("span",{parentName:"span",className:"mord mathnormal"},"o"),(0,r.kt)("span",{parentName:"span",className:"mord"},(0,r.kt)("span",{parentName:"span",className:"mord mathnormal",style:{marginRight:"0.02691em"}},"w"),(0,r.kt)("span",{parentName:"span",className:"msupsub"},(0,r.kt)("span",{parentName:"span",className:"vlist-t vlist-t2"},(0,r.kt)("span",{parentName:"span",className:"vlist-r"},(0,r.kt)("span",{parentName:"span",className:"vlist",style:{height:"0.1514em"}},(0,r.kt)("span",{parentName:"span",style:{top:"-2.55em",marginLeft:"-0.0269em",marginRight:"0.05em"}},(0,r.kt)("span",{parentName:"span",className:"pstrut",style:{height:"2.7em"}}),(0,r.kt)("span",{parentName:"span",className:"sizing reset-size6 size3 mtight"},(0,r.kt)("span",{parentName:"span",className:"mord mathnormal mtight"},"s")))),(0,r.kt)("span",{parentName:"span",className:"vlist-s"},"\u200b")),(0,r.kt)("span",{parentName:"span",className:"vlist-r"},(0,r.kt)("span",{parentName:"span",className:"vlist",style:{height:"0.15em"}},(0,r.kt)("span",{parentName:"span"})))))),(0,r.kt)("span",{parentName:"span",className:"mord mathnormal"},"i"),(0,r.kt)("span",{parentName:"span",className:"mord mathnormal"},"ze"),(0,r.kt)("span",{parentName:"span",className:"mspace",style:{marginRight:"0.2778em"}}),(0,r.kt)("span",{parentName:"span",className:"mrel"},"="),(0,r.kt)("span",{parentName:"span",className:"mspace",style:{marginRight:"0.2778em"}})),(0,r.kt)("span",{parentName:"span",className:"base"},(0,r.kt)("span",{parentName:"span",className:"strut",style:{height:"1em",verticalAlign:"-0.25em"}}),(0,r.kt)("span",{parentName:"span",className:"mopen"},"("),(0,r.kt)("span",{parentName:"span",className:"mord mathnormal",style:{marginRight:"0.10903em"}},"N"),(0,r.kt)("span",{parentName:"span",className:"mord mathnormal"},"e"),(0,r.kt)("span",{parentName:"span",className:"mord mathnormal",style:{marginRight:"0.02691em"}},"tw"),(0,r.kt)("span",{parentName:"span",className:"mord mathnormal",style:{marginRight:"0.02778em"}},"or"),(0,r.kt)("span",{parentName:"span",className:"mord"},(0,r.kt)("span",{parentName:"span",className:"mord mathnormal",style:{marginRight:"0.03148em"}},"k"),(0,r.kt)("span",{parentName:"span",className:"msupsub"},(0,r.kt)("span",{parentName:"span",className:"vlist-t vlist-t2"},(0,r.kt)("span",{parentName:"span",className:"vlist-r"},(0,r.kt)("span",{parentName:"span",className:"vlist",style:{height:"0.3283em"}},(0,r.kt)("span",{parentName:"span",style:{top:"-2.55em",marginLeft:"-0.0315em",marginRight:"0.05em"}},(0,r.kt)("span",{parentName:"span",className:"pstrut",style:{height:"2.7em"}}),(0,r.kt)("span",{parentName:"span",className:"sizing reset-size6 size3 mtight"},(0,r.kt)("span",{parentName:"span",className:"mord mathnormal mtight",style:{marginRight:"0.02778em"}},"D")))),(0,r.kt)("span",{parentName:"span",className:"vlist-s"},"\u200b")),(0,r.kt)("span",{parentName:"span",className:"vlist-r"},(0,r.kt)("span",{parentName:"span",className:"vlist",style:{height:"0.15em"}},(0,r.kt)("span",{parentName:"span"})))))),(0,r.kt)("span",{parentName:"span",className:"mord mathnormal"},"e"),(0,r.kt)("span",{parentName:"span",className:"mord mathnormal",style:{marginRight:"0.01968em"}},"l"),(0,r.kt)("span",{parentName:"span",className:"mord mathnormal"},"a"),(0,r.kt)("span",{parentName:"span",className:"mord mathnormal",style:{marginRight:"0.03588em"}},"y"),(0,r.kt)("span",{parentName:"span",className:"mclose"},")"),(0,r.kt)("span",{parentName:"span",className:"mord"},"/"),(0,r.kt)("span",{parentName:"span",className:"mord mathnormal"},"b"),(0,r.kt)("span",{parentName:"span",className:"mord mathnormal",style:{marginRight:"0.01968em"}},"l"),(0,r.kt)("span",{parentName:"span",className:"mord mathnormal"},"oc"),(0,r.kt)("span",{parentName:"span",className:"mord"},(0,r.kt)("span",{parentName:"span",className:"mord mathnormal",style:{marginRight:"0.03148em"}},"k"),(0,r.kt)("span",{parentName:"span",className:"msupsub"},(0,r.kt)("span",{parentName:"span",className:"vlist-t vlist-t2"},(0,r.kt)("span",{parentName:"span",className:"vlist-r"},(0,r.kt)("span",{parentName:"span",className:"vlist",style:{height:"0.2806em"}},(0,r.kt)("span",{parentName:"span",style:{top:"-2.55em",marginLeft:"-0.0315em",marginRight:"0.05em"}},(0,r.kt)("span",{parentName:"span",className:"pstrut",style:{height:"2.7em"}}),(0,r.kt)("span",{parentName:"span",className:"sizing reset-size6 size3 mtight"},(0,r.kt)("span",{parentName:"span",className:"mord mathnormal mtight"},"t")))),(0,r.kt)("span",{parentName:"span",className:"vlist-s"},"\u200b")),(0,r.kt)("span",{parentName:"span",className:"vlist-r"},(0,r.kt)("span",{parentName:"span",className:"vlist",style:{height:"0.15em"}},(0,r.kt)("span",{parentName:"span"})))))),(0,r.kt)("span",{parentName:"span",className:"mord mathnormal"},"im"),(0,r.kt)("span",{parentName:"span",className:"mord mathnormal"},"e")))))),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"Network_Delay")," MUST have the same resolution as ",(0,r.kt)("inlineCode",{parentName:"p"},"block_time"),"."),(0,r.kt)("p",null,"By this formulation,\n",(0,r.kt)("inlineCode",{parentName:"p"},"acceptable_root_window_size")," will provide a lower bound\nof how many roots can be acceptable by a routing peer."),(0,r.kt)("p",null,"The ",(0,r.kt)("inlineCode",{parentName:"p"},"acceptable_root_window_size")," should indicate how many blocks may have been mined\nduring the time it takes for a peer to receive a message.\nThis formula represents a lower bound of the number of acceptable roots."),(0,r.kt)("h2",{id:"copyright"},"Copyright"),(0,r.kt)("p",null,"Copyright and related rights waived via ",(0,r.kt)("a",{parentName:"p",href:"https://creativecommons.org/publicdomain/zero/1.0/"},"CC0"),"."),(0,r.kt)("h2",{id:"references"},"References"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("a",{parentName:"li",href:"../11/relay"},(0,r.kt)("inlineCode",{parentName:"a"},"11/WAKU2-RELAY"))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("a",{parentName:"li",href:"//vac/32/rln-v1"},"RLN")),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("a",{parentName:"li",href:"../14/message"},"14/WAKU2-MESSAGE")),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("a",{parentName:"li",href:"https://hackmd.io/tMTLMYmTR5eynw2lwK9n1w?view"},"RLN documentation")),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("a",{parentName:"li",href:"https://hackmd.io/tMTLMYmTR5eynw2lwK9n1w?view#Public-Inputs"},"Public inputs to the RLN circuit")),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("a",{parentName:"li",href:"https://hackmd.io/tMTLMYmTR5eynw2lwK9n1w?view#Linear-Equation-amp-SSS"},"Shamir secret sharing scheme used in RLN")),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("a",{parentName:"li",href:"https://hackmd.io/tMTLMYmTR5eynw2lwK9n1w?view#Nullifiers"},"RLN internal nullifier"))))}h.isMDXComponent=!0},3905:(e,a,t)=>{t.d(a,{Zo:()=>l,kt:()=>k});var n=t(67294);function r(e,a,t){return a in e?Object.defineProperty(e,a,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[a]=t,e}function s(e,a){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);a&&(n=n.filter((function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable}))),t.push.apply(t,n)}return t}function i(e){for(var a=1;a<arguments.length;a++){var t=null!=arguments[a]?arguments[a]:{};a%2?s(Object(t),!0).forEach((function(a){r(e,a,t[a])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):s(Object(t)).forEach((function(a){Object.defineProperty(e,a,Object.getOwnPropertyDescriptor(t,a))}))}return e}function p(e,a){if(null==e)return{};var t,n,r=function(e,a){if(null==e)return{};var t,n,r={},s=Object.keys(e);for(n=0;n<s.length;n++)t=s[n],a.indexOf(t)>=0||(r[t]=e[t]);return r}(e,a);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(n=0;n<s.length;n++)t=s[n],a.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(r[t]=e[t])}return r}var m=n.createContext({}),o=function(e){var a=n.useContext(m),t=a;return e&&(t="function"==typeof e?e(a):i(i({},a),e)),t},l=function(e){var a=o(e.components);return n.createElement(m.Provider,{value:a},e.children)},h={inlineCode:"code",wrapper:function(e){var a=e.children;return n.createElement(n.Fragment,{},a)}},d=n.forwardRef((function(e,a){var t=e.components,r=e.mdxType,s=e.originalType,m=e.parentName,l=p(e,["components","mdxType","originalType","parentName"]),d=o(t),k=r,c=d["".concat(m,".").concat(k)]||d[k]||h[k]||s;return t?n.createElement(c,i(i({ref:a},l),{},{components:t})):n.createElement(c,i({ref:a},l))}));function k(e,a){var t=arguments,r=a&&a.mdxType;if("string"==typeof e||r){var s=t.length,i=new Array(s);i[0]=d;var p={};for(var m in a)hasOwnProperty.call(a,m)&&(p[m]=a[m]);p.originalType=e,p.mdxType="string"==typeof e?e:r,i[1]=p;for(var o=2;o<s;o++)i[o]=t[o];return n.createElement.apply(null,i)}return n.createElement.apply(null,t)}d.displayName="MDXCreateElement"},13974:(e,a,t)=>{t.d(a,{Z:()=>n});const n=t.p+"assets/images/rln-message-verification-ea3125bbb52d4fff31cb9bfae38668d1.png"},95926:(e,a,t)=>{t.d(a,{Z:()=>n});const n=t.p+"assets/images/rln-relay-af494cc4acf699838cd97378b416b105.png"}}]);