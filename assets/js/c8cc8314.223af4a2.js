"use strict";(self.webpackChunklogos_docs_template=self.webpackChunklogos_docs_template||[]).push([[9789],{83277:(e,t,r)=>{r.r(t),r.d(t,{assets:()=>l,contentTitle:()=>s,default:()=>c,frontMatter:()=>i,metadata:()=>o,toc:()=>p});var n=r(87462),a=(r(67294),r(3905));const i={title:"WHISPER-MAILSERVER",name:"Whisper mailserver",status:"deprecated",description:"Whisper Mailserver is a Whisper extension that allows to store messages permanently and deliver them to the clients even though they are already not available in the network and expired.",editor:"Filip Dimitrijevic &lt;filip@status.im&gt;",contributors:["Adam Babik &lt;adam@status.im&gt;","Oskar Thor\xe9n &lt;oskar@status.im&gt;"]},s=void 0,o={unversionedId:"deprecated/whisper-mailserver",id:"deprecated/whisper-mailserver",title:"WHISPER-MAILSERVER",description:"Whisper Mailserver is a Whisper extension that allows to store messages permanently and deliver them to the clients even though they are already not available in the network and expired.",source:"@site/status/deprecated/whisper-mailserver.md",sourceDirName:"deprecated",slug:"/deprecated/whisper-mailserver",permalink:"/status/deprecated/whisper-mailserver",draft:!1,tags:[],version:"current",frontMatter:{title:"WHISPER-MAILSERVER",name:"Whisper mailserver",status:"deprecated",description:"Whisper Mailserver is a Whisper extension that allows to store messages permanently and deliver them to the clients even though they are already not available in the network and expired.",editor:"Filip Dimitrijevic &lt;filip@status.im&gt;",contributors:["Adam Babik &lt;adam@status.im&gt;","Oskar Thor\xe9n &lt;oskar@status.im&gt;"]},sidebar:"defaultSidebar",previous:{title:"WAKU-USAGE",permalink:"/status/deprecated/waku-usage"},next:{title:"WHISPER-USAGE",permalink:"/status/deprecated/whisper-usage"}},l={},p=[{value:"Abstract",id:"abstract",level:2},{value:"<code>Mailserver</code>",id:"mailserver",level:2},{value:"Archiving messages",id:"archiving-messages",level:3},{value:"Requesting messages",id:"requesting-messages",level:3},{value:"Receiving historic messages",id:"receiving-historic-messages",level:3},{value:"Security considerations",id:"security-considerations",level:2},{value:"Confidentiality",id:"confidentiality",level:3},{value:"Altruistic and centralized operator risk",id:"altruistic-and-centralized-operator-risk",level:3},{value:"Privacy concerns",id:"privacy-concerns",level:3},{value:"Denial-of-service",id:"denial-of-service",level:3},{value:"Changelog",id:"changelog",level:2},{value:"Version 0.3",id:"version-03",level:3},{value:"Copyright",id:"copyright",level:2},{value:"References",id:"references",level:2}],d={toc:p};function c(e){let{components:t,...r}=e;return(0,a.kt)("wrapper",(0,n.Z)({},d,r,{components:t,mdxType:"MDXLayout"}),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"Status: deprecated"),(0,a.kt)("li",{parentName:"ul"},"Editor: Filip Dimitrijevic ","<",(0,a.kt)("a",{parentName:"li",href:"mailto:filip@status.im"},"filip@status.im"),">"),(0,a.kt)("li",{parentName:"ul"},"Contributors:",(0,a.kt)("ul",{parentName:"li"},(0,a.kt)("li",{parentName:"ul"},"Adam Babik ","<",(0,a.kt)("a",{parentName:"li",href:"mailto:adam@status.im"},"adam@status.im"),">"),(0,a.kt)("li",{parentName:"ul"},"Oskar Thor\xe9n ","<",(0,a.kt)("a",{parentName:"li",href:"mailto:oskar@status.im"},"oskar@status.im"),">")))),(0,a.kt)("h2",{id:"abstract"},"Abstract"),(0,a.kt)("p",null,"Being mostly offline is an intrinsic property of mobile clients.\nThey need to save network transfer and battery consumption\nto avoid spending too much money or constant charging.\nWhisper protocol, on the other hand, is an online protocol.\nMessages are available in the Whisper network only for short period of time calculate in seconds."),(0,a.kt)("p",null,"Whisper ",(0,a.kt)("inlineCode",{parentName:"p"},"Mailserver")," is a Whisper extension that allows to store messages permanently\nand deliver them to the clients even though they are already not available in the network and expired."),(0,a.kt)("h2",{id:"mailserver"},(0,a.kt)("inlineCode",{parentName:"h2"},"Mailserver")),(0,a.kt)("p",null,"From the network perspective, ",(0,a.kt)("inlineCode",{parentName:"p"},"Mailserver")," is just like any other Whisper node.\nThe only difference is that it has a capability of archiving messages and delivering them to its peers on-demand."),(0,a.kt)("p",null,"It is important to notice that ",(0,a.kt)("inlineCode",{parentName:"p"},"Mailserver")," will only handle requests from its direct peers\nand exchanged packets between ",(0,a.kt)("inlineCode",{parentName:"p"},"Mailserver")," and a peer are p2p messages."),(0,a.kt)("h3",{id:"archiving-messages"},"Archiving messages"),(0,a.kt)("p",null,"A node which wants to provide ",(0,a.kt)("inlineCode",{parentName:"p"},"Mailserver")," functionality MUST store envelopes\nfrom incoming message packets (Whisper packet-code ",(0,a.kt)("inlineCode",{parentName:"p"},"0x01"),").\nThe envelopes can be stored in any format,\nhowever they MUST be serialized and deserialized to the Whisper envelope format."),(0,a.kt)("p",null,"A ",(0,a.kt)("inlineCode",{parentName:"p"},"Mailserver")," SHOULD store envelopes for all topics to be generally useful for any peer,\nhowever for specific use cases it MAY store envelopes for a subset of topics."),(0,a.kt)("h3",{id:"requesting-messages"},"Requesting messages"),(0,a.kt)("p",null,"In order to request historic messages, a node MUST send a packet P2P Request (",(0,a.kt)("inlineCode",{parentName:"p"},"0x7e"),") to a peer providing ",(0,a.kt)("inlineCode",{parentName:"p"},"Mailserver")," functionality.\nThis packet requires one argument which MUST be a Whisper envelope."),(0,a.kt)("p",null,"In the Whisper envelope's payload section, there MUST be RLP-encoded information about the details of the request:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-golang"},"[ Lower, Upper, Bloom, Limit, Cursor ]\n")),(0,a.kt)("p",null,(0,a.kt)("inlineCode",{parentName:"p"},"Lower"),": 4-byte wide unsigned integer (UNIX time in seconds; oldest requested envelope's creation time)",(0,a.kt)("br",{parentName:"p"}),"\n",(0,a.kt)("inlineCode",{parentName:"p"},"Upper"),": 4-byte wide unsigned integer (UNIX time in seconds; newest requested envelope's creation time)",(0,a.kt)("br",{parentName:"p"}),"\n",(0,a.kt)("inlineCode",{parentName:"p"},"Bloom"),": 64-byte wide array of Whisper topics encoded in a bloom filter to filter envelopes",(0,a.kt)("br",{parentName:"p"}),"\n",(0,a.kt)("inlineCode",{parentName:"p"},"Limit"),": 4-byte wide unsigned integer limiting the number of returned envelopes",(0,a.kt)("br",{parentName:"p"}),"\n",(0,a.kt)("inlineCode",{parentName:"p"},"Cursor"),": an array of a cursor returned from the previous request (optional)"),(0,a.kt)("p",null,"The ",(0,a.kt)("inlineCode",{parentName:"p"},"Cursor")," field SHOULD be filled in\nif a number of envelopes between ",(0,a.kt)("inlineCode",{parentName:"p"},"Lower")," and ",(0,a.kt)("inlineCode",{parentName:"p"},"Upper")," is greater than ",(0,a.kt)("inlineCode",{parentName:"p"},"Limit"),"\nso that the requester can send another request using the obtained ",(0,a.kt)("inlineCode",{parentName:"p"},"Cursor")," value.\nWhat exactly is in the ",(0,a.kt)("inlineCode",{parentName:"p"},"Cursor")," is up to the implementation.\nThe requester SHOULD NOT use a ",(0,a.kt)("inlineCode",{parentName:"p"},"Cursor")," obtained from one ",(0,a.kt)("inlineCode",{parentName:"p"},"Mailserver")," in a request to another ",(0,a.kt)("inlineCode",{parentName:"p"},"Mailserver"),"\nbecause the format or the result MAY be different."),(0,a.kt)("p",null,"The envelope MUST be encrypted with a symmetric key agreed between the requester and ",(0,a.kt)("inlineCode",{parentName:"p"},"Mailserver"),"."),(0,a.kt)("h3",{id:"receiving-historic-messages"},"Receiving historic messages"),(0,a.kt)("p",null,"Historic messages MUST be sent to a peer as a packet with a P2P Message code (",(0,a.kt)("inlineCode",{parentName:"p"},"0x7f"),")\nfollowed by an array of Whisper envelopes.\nIt is incompatible with the original Whisper spec (EIP-627) because it allows only a single envelope,\nhowever, an array of envelopes is much more performant.\nIn order to stay compatible with EIP-627, a peer receiving historic message MUST handle both cases."),(0,a.kt)("p",null,"In order to receive historic messages from a ",(0,a.kt)("inlineCode",{parentName:"p"},"Mailserver"),", a node MUST trust the selected ",(0,a.kt)("inlineCode",{parentName:"p"},"Mailserver"),",\nthat is allowed to send packets with the P2P Message code. By default, the node discards such packets."),(0,a.kt)("p",null,"Received envelopes MUST be passed through the Whisper envelope pipelines\nso that they are picked up by registered filters and passed to subscribers."),(0,a.kt)("p",null,"For a requester, to know that all messages have been sent by ",(0,a.kt)("inlineCode",{parentName:"p"},"Mailserver"),",\nit SHOULD handle P2P Request Complete code (",(0,a.kt)("inlineCode",{parentName:"p"},"0x7d"),"). This code is followed by the following parameters:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-golang"},"[ RequestID, LastEnvelopeHash, Cursor ]\n")),(0,a.kt)("p",null,(0,a.kt)("inlineCode",{parentName:"p"},"RequestID"),": 32-byte wide array with a Keccak-256 hash of the envelope containing the original request",(0,a.kt)("br",{parentName:"p"}),"\n",(0,a.kt)("inlineCode",{parentName:"p"},"LastEnvelopeHash"),": 32-byte wide array with a Keccak-256 hash of the last sent envelope for the request",(0,a.kt)("br",{parentName:"p"}),"\n",(0,a.kt)("inlineCode",{parentName:"p"},"Cursor"),": an array of a cursor returned from the previous request (optional)"),(0,a.kt)("p",null,"If ",(0,a.kt)("inlineCode",{parentName:"p"},"Cursor")," is not empty, it means that not all messages were sent due to the set ",(0,a.kt)("inlineCode",{parentName:"p"},"Limit")," in the request.\nOne or more consecutive requests MAY be sent with ",(0,a.kt)("inlineCode",{parentName:"p"},"Cursor")," field filled in order to receive the rest of the messages."),(0,a.kt)("h2",{id:"security-considerations"},"Security considerations"),(0,a.kt)("h3",{id:"confidentiality"},"Confidentiality"),(0,a.kt)("p",null,"The node encrypts all Whisper envelopes. A ",(0,a.kt)("inlineCode",{parentName:"p"},"Mailserver")," node can not inspect their contents."),(0,a.kt)("h3",{id:"altruistic-and-centralized-operator-risk"},"Altruistic and centralized operator risk"),(0,a.kt)("p",null,"In order to be useful, a ",(0,a.kt)("inlineCode",{parentName:"p"},"Mailserver")," SHOULD be online most of the time. That means\nusers either have to be a bit tech-savvy to run their own node, or rely on someone\nelse to run it for them."),(0,a.kt)("p",null,"Currently, one of Status's legal entities provides ",(0,a.kt)("inlineCode",{parentName:"p"},"Mailservers")," in an altruistic manner, but this is\nsuboptimal from a decentralization, continuance and risk point of view. Coming\nup with a better system for this is ongoing research."),(0,a.kt)("p",null,"A Status client SHOULD allow the ",(0,a.kt)("inlineCode",{parentName:"p"},"Mailserver")," selection to be customizable."),(0,a.kt)("h3",{id:"privacy-concerns"},"Privacy concerns"),(0,a.kt)("p",null,"In order to use a ",(0,a.kt)("inlineCode",{parentName:"p"},"Mailserver"),", a given node needs to connect to it directly,\ni.e. add the ",(0,a.kt)("inlineCode",{parentName:"p"},"Mailserver")," as its peer and mark it as trusted.\nThis means that the ",(0,a.kt)("inlineCode",{parentName:"p"},"Mailserver")," is able to send direct p2p messages to the node instead of broadcasting them.\nEffectively, it will have access to the bloom filter of topics\nthat the user is interested in,\nwhen it is online as well as many metadata like IP address."),(0,a.kt)("h3",{id:"denial-of-service"},"Denial-of-service"),(0,a.kt)("p",null,"Since a ",(0,a.kt)("inlineCode",{parentName:"p"},"Mailserver")," is delivering expired envelopes and has a direct TCP connection with the recipient,\nthe recipient is vulnerable to DoS attacks from a malicious ",(0,a.kt)("inlineCode",{parentName:"p"},"Mailserver")," node."),(0,a.kt)("h2",{id:"changelog"},"Changelog"),(0,a.kt)("h3",{id:"version-03"},"Version 0.3"),(0,a.kt)("p",null,"Released ",(0,a.kt)("a",{parentName:"p",href:"https://github.com/status-im/specs/commit/664dd1c9df6ad409e4c007fefc8c8945b8d324e8"},"May 22, 2020")),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"Change to keep ",(0,a.kt)("inlineCode",{parentName:"li"},"Mailserver")," term consistent")),(0,a.kt)("h2",{id:"copyright"},"Copyright"),(0,a.kt)("p",null,"Copyright and related rights waived via ",(0,a.kt)("a",{parentName:"p",href:"https://creativecommons.org/publicdomain/zero/1.0/"},"CC0"),"."),(0,a.kt)("h2",{id:"references"},"References"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("a",{parentName:"li",href:"https://eips.ethereum.org/EIPS/eip-627"},"Whisper")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("a",{parentName:"li",href:"https://github.com/ethereum/EIPs/blob/master/EIPS/eip-627.md"},"EIP-627")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("a",{parentName:"li",href:"/status/deprecated/secure-transport"},"SECURE-TRANSPORT")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("a",{parentName:"li",href:"https://github.com/ethereum/go-ethereum/wiki/Whisper-v6-RPC-API#shh_generatesymkeyfrompassword"},(0,a.kt)("inlineCode",{parentName:"a"},"shh_generateSymKeyFromPassword"))),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("a",{parentName:"li",href:"https://eips.ethereum.org/EIPS/eip-627"},"Whisper v6")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("a",{parentName:"li",href:"/waku/deprecated/5/waku0"},"Waku V0")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("a",{parentName:"li",href:"/waku/standards/legacy/6/waku1"},"Waku V1")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("a",{parentName:"li",href:"https://github.com/status-im/specs/commit/664dd1c9df6ad409e4c007fefc8c8945b8d324e8"},"May 22, 2020 change commit"))))}c.isMDXComponent=!0},3905:(e,t,r)=>{r.d(t,{Zo:()=>d,kt:()=>u});var n=r(67294);function a(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function i(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function s(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?i(Object(r),!0).forEach((function(t){a(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):i(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function o(e,t){if(null==e)return{};var r,n,a=function(e,t){if(null==e)return{};var r,n,a={},i=Object.keys(e);for(n=0;n<i.length;n++)r=i[n],t.indexOf(r)>=0||(a[r]=e[r]);return a}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(n=0;n<i.length;n++)r=i[n],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(a[r]=e[r])}return a}var l=n.createContext({}),p=function(e){var t=n.useContext(l),r=t;return e&&(r="function"==typeof e?e(t):s(s({},t),e)),r},d=function(e){var t=p(e.components);return n.createElement(l.Provider,{value:t},e.children)},c={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},m=n.forwardRef((function(e,t){var r=e.components,a=e.mdxType,i=e.originalType,l=e.parentName,d=o(e,["components","mdxType","originalType","parentName"]),m=p(r),u=a,h=m["".concat(l,".").concat(u)]||m[u]||c[u]||i;return r?n.createElement(h,s(s({ref:t},d),{},{components:r})):n.createElement(h,s({ref:t},d))}));function u(e,t){var r=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var i=r.length,s=new Array(i);s[0]=m;var o={};for(var l in t)hasOwnProperty.call(t,l)&&(o[l]=t[l]);o.originalType=e,o.mdxType="string"==typeof e?e:a,s[1]=o;for(var p=2;p<i;p++)s[p]=r[p];return n.createElement.apply(null,s)}return n.createElement.apply(null,r)}m.displayName="MDXCreateElement"}}]);