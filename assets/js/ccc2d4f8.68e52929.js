"use strict";(self.webpackChunklogos_docs_template=self.webpackChunklogos_docs_template||[]).push([[3442],{78410:(e,t,a)=>{a.r(t),a.d(t,{assets:()=>l,contentTitle:()=>o,default:()=>p,frontMatter:()=>i,metadata:()=>s,toc:()=>d});var r=a(87462),n=(a(67294),a(3905));const i={title:"66/WAKU2-METADATA",name:"Waku Metadata Protocol",status:"draft",editor:"Franck Royer &lt;franck@status.im&gt;",contributors:["Filip Dimitrijevic &lt;filip@status.im&gt;","Alvaro Revuelta &lt;alrevuelta@status.im&gt;"]},o=void 0,s={unversionedId:"standards/core/66/metadata",id:"standards/core/66/metadata",title:"66/WAKU2-METADATA",description:"- Status: draft",source:"@site/waku/standards/core/66/metadata.md",sourceDirName:"standards/core/66",slug:"/standards/core/66/metadata",permalink:"/waku/standards/core/66/metadata",draft:!1,tags:[],version:"current",frontMatter:{title:"66/WAKU2-METADATA",name:"Waku Metadata Protocol",status:"draft",editor:"Franck Royer &lt;franck@status.im&gt;",contributors:["Filip Dimitrijevic &lt;filip@status.im&gt;","Alvaro Revuelta &lt;alrevuelta@status.im&gt;"]},sidebar:"defaultSidebar",previous:{title:"64/WAKU2-NETWORK",permalink:"/waku/standards/core/64/network"},next:{title:"6/WAKU1",permalink:"/waku/standards/legacy/6/waku1"}},l={},d=[{value:"Abstract",id:"abstract",level:2},{value:"Metadata Protocol",id:"metadata-protocol",level:2},{value:"Request",id:"request",level:3},{value:"Response",id:"response",level:3},{value:"Implementation Suggestions",id:"implementation-suggestions",level:2},{value:"Triggering Metadata Request",id:"triggering-metadata-request",level:3},{value:"Providing Cluster Id",id:"providing-cluster-id",level:3},{value:"Providing Shard Information",id:"providing-shard-information",level:3},{value:"Using Cluster Id",id:"using-cluster-id",level:3},{value:"Using Shard Information",id:"using-shard-information",level:3},{value:"Copyright",id:"copyright",level:2},{value:"References",id:"references",level:2}],u={toc:d};function p(e){let{components:t,...a}=e;return(0,n.kt)("wrapper",(0,r.Z)({},u,a,{components:t,mdxType:"MDXLayout"}),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},"Status: draft"),(0,n.kt)("li",{parentName:"ul"},"Editor: Franck Royer ","<",(0,n.kt)("a",{parentName:"li",href:"mailto:franck@status.im"},"franck@status.im"),">"),(0,n.kt)("li",{parentName:"ul"},"Contributors:",(0,n.kt)("ul",{parentName:"li"},(0,n.kt)("li",{parentName:"ul"},"Filip Dimitrijevic ","<",(0,n.kt)("a",{parentName:"li",href:"mailto:filip@status.im"},"filip@status.im"),">"),(0,n.kt)("li",{parentName:"ul"},"Alvaro Revuelta ","<",(0,n.kt)("a",{parentName:"li",href:"mailto:alrevuelta@status.im"},"alrevuelta@status.im"),">")))),(0,n.kt)("h2",{id:"abstract"},"Abstract"),(0,n.kt)("p",null,"This specification describes the metadata\nthat can be associated with a ",(0,n.kt)("a",{parentName:"p",href:"/waku/standards/core/10/waku2"},"10/WAKU2")," node."),(0,n.kt)("h2",{id:"metadata-protocol"},"Metadata Protocol"),(0,n.kt)("p",null,"The keywords \u201cMUST\u201d, // List style \u201cMUST NOT\u201d, \u201cREQUIRED\u201d, \u201cSHALL\u201d, \u201cSHALL NOT\u201d, \u201cSHOULD\u201d, \u201cSHOULD NOT\u201d, \u201cRECOMMENDED\u201d,\n\u201cNOT RECOMMENDED\u201d, \u201cMAY\u201d, and \u201cOPTIONAL\u201d in this document are to be interpreted as described in ",(0,n.kt)("a",{parentName:"p",href:"https://www.ietf.org/rfc/rfc2119.txt"},"RFC 2119"),"."),(0,n.kt)("p",null,"Waku specifies a req/resp protocol that provides information about the node's capabilities.\nSuch metadata MAY be used by other peers for subsequent actions such as light protocol requests or disconnection."),(0,n.kt)("p",null,"The node that makes the request,\nincludes its metadata so that the receiver is aware of it,\nwithout requiring another round trip.\nThe parameters are the following:"),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("inlineCode",{parentName:"li"},"clusterId"),": Unique identifier of the cluster that the node is running in."),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("inlineCode",{parentName:"li"},"shards"),": Shard indexes that the node is subscribed to via ",(0,n.kt)("a",{parentName:"li",href:"/waku/standards/core/11/relay"},(0,n.kt)("inlineCode",{parentName:"a"},"11/WAKU2-RELAY")),".")),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},(0,n.kt)("em",{parentName:"strong"},"Protocol Identifier"))),(0,n.kt)("p",null,">"," /vac/waku/metadata/1.0.0"),(0,n.kt)("h3",{id:"request"},"Request"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-protobuf"},"message WakuMetadataRequest {\n  optional uint32 cluster_id = 1;\n  repeated uint32 shards = 2;\n}\n")),(0,n.kt)("h3",{id:"response"},"Response"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-protobuf"},"message WakuMetadataResponse {\n  optional uint32 cluster_id = 1;\n  repeated uint32 shards = 2;\n}\n")),(0,n.kt)("h2",{id:"implementation-suggestions"},"Implementation Suggestions"),(0,n.kt)("h3",{id:"triggering-metadata-request"},"Triggering Metadata Request"),(0,n.kt)("p",null,"A node SHOULD proceed with metadata request upon first connection to a remote node.\nA node SHOULD use the remote node's libp2p peer id as identifier for this heuristic."),(0,n.kt)("p",null,"A node MAY proceed with metadata request upon reconnection to a remote peer."),(0,n.kt)("p",null,"A node SHOULD store the remote peer's metadata information for future reference.\nA node MAY implement a TTL regarding a remote peer's metadata, and refresh it upon expiry by initiating another metadata request.\nIt is RECOMMENDED to set the TTL to 6 hours."),(0,n.kt)("p",null,"A node MAY trigger a metadata request after receiving an error response from a remote note\nstating they do not support a specific cluster or shard.\nFor example, when using a request-response service such as ",(0,n.kt)("a",{parentName:"p",href:"/waku/standards/core/19/lightpush"},(0,n.kt)("inlineCode",{parentName:"a"},"19/WAKU2-LIGHTPUSH")),"."),(0,n.kt)("h3",{id:"providing-cluster-id"},"Providing Cluster Id"),(0,n.kt)("p",null,"A node MUST include their cluster id into their metadata payload.\nIt is RECOMMENDED for a node to operate on a single cluster id."),(0,n.kt)("h3",{id:"providing-shard-information"},"Providing Shard Information"),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},"Nodes that mount ",(0,n.kt)("a",{parentName:"li",href:"/waku/standards/core/11/relay"},(0,n.kt)("inlineCode",{parentName:"a"},"11/WAKU2-RELAY"))," MAY include the shards they are subscribed to in their metadata payload."),(0,n.kt)("li",{parentName:"ul"},"Shard-relevant services are message related services,\nsuch as ",(0,n.kt)("a",{parentName:"li",href:"/waku/standards/core/13/store"},(0,n.kt)("inlineCode",{parentName:"a"},"13/WAKU2-STORE")),", ",(0,n.kt)("a",{parentName:"li",href:"/waku/standards/core/12/filter"},"12/WAKU2-FILTER"),"\nand ",(0,n.kt)("a",{parentName:"li",href:"/waku/standards/core/19/lightpush"},(0,n.kt)("inlineCode",{parentName:"a"},"19/WAKU2-LIGHTPUSH")),"\nbut not ",(0,n.kt)("a",{parentName:"li",href:"/waku/standards/core/34/peer-exchange"},(0,n.kt)("inlineCode",{parentName:"a"},"34/WAKU2-PEER-EXCHANGE"))),(0,n.kt)("li",{parentName:"ul"},"Nodes that mount ",(0,n.kt)("a",{parentName:"li",href:"/waku/standards/core/11/relay"},(0,n.kt)("inlineCode",{parentName:"a"},"11/WAKU2-RELAY"))," and a shard-relevant service SHOULD include the shards they are subscribed to in their metadata payload."),(0,n.kt)("li",{parentName:"ul"},"Nodes that do not mount ",(0,n.kt)("a",{parentName:"li",href:"/waku/standards/core/11/relay"},(0,n.kt)("inlineCode",{parentName:"a"},"11/WAKU2-RELAY"))," SHOULD NOT include any shard information")),(0,n.kt)("h3",{id:"using-cluster-id"},"Using Cluster Id"),(0,n.kt)("p",null,"When reading the cluster id of a remote peer, the local node MAY disconnect if their cluster id is different from the remote peer."),(0,n.kt)("h3",{id:"using-shard-information"},"Using Shard Information"),(0,n.kt)("p",null,"It is NOT RECOMMENDED to disconnect from a peer based on the fact that their shard information is different from the local node."),(0,n.kt)("p",null,"Ahead of doing a shard-relevant request,\na node MAY use the previously received metadata shard information to select a peer that support the targeted shard."),(0,n.kt)("p",null,"For non-shard-relevant requests, a node SHOULD NOT discriminate a peer based on medata shard information."),(0,n.kt)("h2",{id:"copyright"},"Copyright"),(0,n.kt)("p",null,"Copyright and related rights waived via\n",(0,n.kt)("a",{parentName:"p",href:"https://creativecommons.org/publicdomain/zero/1.0/"},"CC0"),"."),(0,n.kt)("h2",{id:"references"},"References"),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("a",{parentName:"li",href:"/waku/standards/core/10/waku2"},"10/WAKU2"))))}p.isMDXComponent=!0},3905:(e,t,a)=>{a.d(t,{Zo:()=>u,kt:()=>m});var r=a(67294);function n(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function i(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,r)}return a}function o(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?i(Object(a),!0).forEach((function(t){n(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):i(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function s(e,t){if(null==e)return{};var a,r,n=function(e,t){if(null==e)return{};var a,r,n={},i=Object.keys(e);for(r=0;r<i.length;r++)a=i[r],t.indexOf(a)>=0||(n[a]=e[a]);return n}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)a=i[r],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(n[a]=e[a])}return n}var l=r.createContext({}),d=function(e){var t=r.useContext(l),a=t;return e&&(a="function"==typeof e?e(t):o(o({},t),e)),a},u=function(e){var t=d(e.components);return r.createElement(l.Provider,{value:t},e.children)},p={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},c=r.forwardRef((function(e,t){var a=e.components,n=e.mdxType,i=e.originalType,l=e.parentName,u=s(e,["components","mdxType","originalType","parentName"]),c=d(a),m=n,h=c["".concat(l,".").concat(m)]||c[m]||p[m]||i;return a?r.createElement(h,o(o({ref:t},u),{},{components:a})):r.createElement(h,o({ref:t},u))}));function m(e,t){var a=arguments,n=t&&t.mdxType;if("string"==typeof e||n){var i=a.length,o=new Array(i);o[0]=c;var s={};for(var l in t)hasOwnProperty.call(t,l)&&(s[l]=t[l]);s.originalType=e,s.mdxType="string"==typeof e?e:n,o[1]=s;for(var d=2;d<i;d++)o[d]=a[d];return r.createElement.apply(null,o)}return r.createElement.apply(null,a)}c.displayName="MDXCreateElement"}}]);