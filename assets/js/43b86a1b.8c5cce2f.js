"use strict";(self.webpackChunklogos_docs_template=self.webpackChunklogos_docs_template||[]).push([[8274],{10555:(e,t,a)=>{a.r(t),a.d(t,{assets:()=>l,contentTitle:()=>s,default:()=>m,frontMatter:()=>i,metadata:()=>o,toc:()=>p});var n=a(87462),r=(a(67294),a(3905));const i={title:"4/MVDS-META",name:"MVDS Metadata Field",status:"draft",editor:"Sanaz Taheri &lt;sanaz@status.im&gt;",contributors:["Dean Eigenmann &lt;dean@status.im&gt;","Andrea Maria Piana &lt;andreap@status.im&gt;","Oskar Thor\xe9n &lt;oskarth@titanproxy.com&gt;"]},s=void 0,o={unversionedId:"4/mvds-meta",id:"4/mvds-meta",title:"4/MVDS-META",description:"- Status: draft",source:"@site/vac/4/mvds-meta.md",sourceDirName:"4",slug:"/4/mvds-meta",permalink:"/vac/4/mvds-meta",draft:!1,tags:[],version:"current",frontMatter:{title:"4/MVDS-META",name:"MVDS Metadata Field",status:"draft",editor:"Sanaz Taheri &lt;sanaz@status.im&gt;",contributors:["Dean Eigenmann &lt;dean@status.im&gt;","Andrea Maria Piana &lt;andreap@status.im&gt;","Oskar Thor\xe9n &lt;oskarth@titanproxy.com&gt;"]},sidebar:"defaultSidebar",previous:{title:"3/REMOTE-LOG",permalink:"/vac/3/remote-log"},next:{title:"25/LIBP2P-DNS-DISCOVERY",permalink:"/vac/25/libp2p-dns-discovery"}},l={},p=[{value:"Motivation",id:"motivation",level:2},{value:"Format",id:"format",level:2},{value:"Fields",id:"fields",level:3},{value:"Usage",id:"usage",level:2},{value:"<code>parents</code>",id:"parents",level:3},{value:"<code>ephemeral</code>",id:"ephemeral",level:3},{value:"Copyright",id:"copyright",level:2},{value:"Footnotes",id:"footnotes",level:2}],d={toc:p};function m(e){let{components:t,...a}=e;return(0,r.kt)("wrapper",(0,n.Z)({},d,a,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Status: draft"),(0,r.kt)("li",{parentName:"ul"},"Editor: Sanaz Taheri ","<",(0,r.kt)("a",{parentName:"li",href:"mailto:sanaz@status.im"},"sanaz@status.im"),">"),(0,r.kt)("li",{parentName:"ul"},"Contributors:",(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"Dean Eigenmann ","<",(0,r.kt)("a",{parentName:"li",href:"mailto:dean@status.im"},"dean@status.im"),">"),(0,r.kt)("li",{parentName:"ul"},"Andrea Maria Piana ","<",(0,r.kt)("a",{parentName:"li",href:"mailto:andreap@status.im"},"andreap@status.im"),">"),(0,r.kt)("li",{parentName:"ul"},"Oskar Thor\xe9n ","<",(0,r.kt)("a",{parentName:"li",href:"mailto:oskarth@titanproxy.com"},"oskarth@titanproxy.com"),">")))),(0,r.kt)("p",null,"In this specification, we describe a method to construct message history that\nwill aid the consistency guarantees of ",(0,r.kt)("a",{parentName:"p",href:"../2/mvds"},"2/MVDS"),".\nAdditionally,\nwe explain how data sync can be used for more lightweight messages that\ndo not require full synchronization."),(0,r.kt)("h2",{id:"motivation"},"Motivation"),(0,r.kt)("p",null,"In order for more efficient synchronization of conversational messages,\ninformation should be provided allowing a node to more effectively synchronize\nthe dependencies for any given message."),(0,r.kt)("h2",{id:"format"},"Format"),(0,r.kt)("p",null,"We introduce the metadata message which is used to convey information about a message\nand how it SHOULD be handled."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-protobuf"},"package vac.mvds;\n\nmessage Metadata {\n  repeated bytes parents = 1;\n  bool ephemeral = 2;\n}\n")),(0,r.kt)("p",null,"Nodes MAY transmit a ",(0,r.kt)("inlineCode",{parentName:"p"},"Metadata")," message by extending the MVDS ",(0,r.kt)("a",{parentName:"p",href:"../2/mvds#payloads"},"message"),"\nwith a ",(0,r.kt)("inlineCode",{parentName:"p"},"metadata")," field."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-diff"},"message Message {\n  bytes group_id = 6001;\n  int64 timestamp = 6002;\n  bytes body = 6003;\n+ Metadata metadata = 6004;\n}\n")),(0,r.kt)("h3",{id:"fields"},"Fields"),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:null},"Name"),(0,r.kt)("th",{parentName:"tr",align:null},"Description"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"parents")),(0,r.kt)("td",{parentName:"tr",align:null},"list of parent ",(0,r.kt)("a",{parentName:"td",href:"../2/mvds#payloads"},(0,r.kt)("inlineCode",{parentName:"a"},"message identifier"),"s")," for the specific message.")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"ephemeral")),(0,r.kt)("td",{parentName:"tr",align:null},"indicates whether a message is ephemeral or not.")))),(0,r.kt)("h2",{id:"usage"},"Usage"),(0,r.kt)("h3",{id:"parents"},(0,r.kt)("inlineCode",{parentName:"h3"},"parents")),(0,r.kt)("p",null,"This field contains a list of parent ",(0,r.kt)("a",{parentName:"p",href:"../2/mvds#payloads"},(0,r.kt)("inlineCode",{parentName:"a"},"message identifier"),"s"),"\nfor the specific message.\nIt MUST NOT contain any messages as parent whose ",(0,r.kt)("inlineCode",{parentName:"p"},"ack")," flag was set to ",(0,r.kt)("inlineCode",{parentName:"p"},"false"),".\nThis establishes a directed acyclic graph (DAG)",(0,r.kt)("sup",{parentName:"p",id:"fnref-2"},(0,r.kt)("a",{parentName:"sup",href:"#fn-2",className:"footnote-ref"},"2"))," of persistent messages."),(0,r.kt)("p",null,"Nodes MAY buffer messages until dependencies are satisfied for causal consistency",(0,r.kt)("sup",{parentName:"p",id:"fnref-3"},(0,r.kt)("a",{parentName:"sup",href:"#fn-3",className:"footnote-ref"},"3")),",\nthey MAY also pass the messages straight away for eventual consistency",(0,r.kt)("sup",{parentName:"p",id:"fnref-4"},(0,r.kt)("a",{parentName:"sup",href:"#fn-4",className:"footnote-ref"},"4")),"."),(0,r.kt)("p",null,"A parent is any message before a new message that\na node is aware of that has no children."),(0,r.kt)("p",null,"The number of parents for a given message is bound by ","[0, N]",",\nwhere N is the number of nodes participating in the conversation,\ntherefore the space requirements for the ",(0,r.kt)("inlineCode",{parentName:"p"},"parents")," field is O(N)."),(0,r.kt)("p",null,"If a message has no parents it is considered a root.\nThere can be multiple roots, which might be disconnected,\ngiving rise to multiple DAGs."),(0,r.kt)("h3",{id:"ephemeral"},(0,r.kt)("inlineCode",{parentName:"h3"},"ephemeral")),(0,r.kt)("p",null,"When the ",(0,r.kt)("inlineCode",{parentName:"p"},"ephemeral")," flag is set to ",(0,r.kt)("inlineCode",{parentName:"p"},"false"),",\na node MUST send an acknowledgment when they have received and processed a message.\nIf it is set to ",(0,r.kt)("inlineCode",{parentName:"p"},"true"),", it SHOULD NOT send any acknowledgment.\nThe flag is ",(0,r.kt)("inlineCode",{parentName:"p"},"false")," by default."),(0,r.kt)("p",null,"Nodes MAY decide to not persist ephemeral messages,\nhowever they MUST NOT be shared as part of the message history."),(0,r.kt)("p",null,"Nodes SHOULD send ephemeral messages in batch mode.\nAs their delivery is not needed to be guaranteed."),(0,r.kt)("h2",{id:"copyright"},"Copyright"),(0,r.kt)("p",null,"Copyright and related rights waived via ",(0,r.kt)("a",{parentName:"p",href:"https://creativecommons.org/publicdomain/zero/1.0/"},"CC0"),"."),(0,r.kt)("h2",{id:"footnotes"},"Footnotes"),(0,r.kt)("p",null,"1: ",(0,r.kt)("a",{parentName:"p",href:"../2/mvds"},"2/MVDS"),"\n2: ",(0,r.kt)("a",{parentName:"p",href:"https://en.wikipedia.org/wiki/Directed_acyclic_graph"},"directed_acyclic_graph"),"\n3: Jepsen. ",(0,r.kt)("a",{parentName:"p",href:"https://jepsen.io/consistency/models/causal"},"Causal Consistency"),"\nJepsen, LLC.\n4: ","<",(0,r.kt)("a",{parentName:"p",href:"https://en.wikipedia.org/wiki/Eventual_consistency"},"https://en.wikipedia.org/wiki/Eventual_consistency"),">"))}m.isMDXComponent=!0},3905:(e,t,a)=>{a.d(t,{Zo:()=>d,kt:()=>u});var n=a(67294);function r(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function i(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function s(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?i(Object(a),!0).forEach((function(t){r(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):i(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function o(e,t){if(null==e)return{};var a,n,r=function(e,t){if(null==e)return{};var a,n,r={},i=Object.keys(e);for(n=0;n<i.length;n++)a=i[n],t.indexOf(a)>=0||(r[a]=e[a]);return r}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(n=0;n<i.length;n++)a=i[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(r[a]=e[a])}return r}var l=n.createContext({}),p=function(e){var t=n.useContext(l),a=t;return e&&(a="function"==typeof e?e(t):s(s({},t),e)),a},d=function(e){var t=p(e.components);return n.createElement(l.Provider,{value:t},e.children)},m={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},c=n.forwardRef((function(e,t){var a=e.components,r=e.mdxType,i=e.originalType,l=e.parentName,d=o(e,["components","mdxType","originalType","parentName"]),c=p(a),u=r,f=c["".concat(l,".").concat(u)]||c[u]||m[u]||i;return a?n.createElement(f,s(s({ref:t},d),{},{components:a})):n.createElement(f,s({ref:t},d))}));function u(e,t){var a=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var i=a.length,s=new Array(i);s[0]=c;var o={};for(var l in t)hasOwnProperty.call(t,l)&&(o[l]=t[l]);o.originalType=e,o.mdxType="string"==typeof e?e:r,s[1]=o;for(var p=2;p<i;p++)s[p]=a[p];return n.createElement.apply(null,s)}return n.createElement.apply(null,a)}c.displayName="MDXCreateElement"}}]);