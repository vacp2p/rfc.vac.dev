"use strict";(self.webpackChunklogos_docs_template=self.webpackChunklogos_docs_template||[]).push([[7378],{27604:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>l,contentTitle:()=>o,default:()=>p,frontMatter:()=>r,metadata:()=>s,toc:()=>d});var i=n(87462),a=(n(67294),n(3905));const r={title:"13/WAKU2-STORE",name:"Waku v2 Store",status:"draft",editor:"Simon-Pierre Vivier &lt;simvivier@status.im&gt;",contributors:["Dean Eigenmann &lt;dean@status.im&gt;","Oskar Thor\xe9n &lt;oskarth@titanproxy.com&gt;","Aaryamann Challani &lt;aaryamann@status.im&gt;","Sanaz Taheri &lt;sanaz@status.im&gt;","Hanno Cornelius &lt;hanno@status.im&gt;"]},o=void 0,s={unversionedId:"standards/core/13/store",id:"standards/core/13/store",title:"13/WAKU2-STORE",description:"- Status: draft",source:"@site/waku/standards/core/13/store.md",sourceDirName:"standards/core/13",slug:"/standards/core/13/store",permalink:"/waku/standards/core/13/store",draft:!1,tags:[],version:"current",frontMatter:{title:"13/WAKU2-STORE",name:"Waku v2 Store",status:"draft",editor:"Simon-Pierre Vivier &lt;simvivier@status.im&gt;",contributors:["Dean Eigenmann &lt;dean@status.im&gt;","Oskar Thor\xe9n &lt;oskarth@titanproxy.com&gt;","Aaryamann Challani &lt;aaryamann@status.im&gt;","Sanaz Taheri &lt;sanaz@status.im&gt;","Hanno Cornelius &lt;hanno@status.im&gt;"]},sidebar:"defaultSidebar",previous:{title:"12/WAKU2-FILTER",permalink:"/waku/standards/core/12/previous-versions00/filter"},next:{title:"14/WAKU2-MESSAGE",permalink:"/waku/standards/core/14/message"}},l={},d=[{value:"Abstract",id:"abstract",level:2},{value:"Terminology",id:"terminology",level:2},{value:"Design Requirements",id:"design-requirements",level:2},{value:"Adversarial Model",id:"adversarial-model",level:2},{value:"Wire Specification",id:"wire-specification",level:2},{value:"Payloads",id:"payloads",level:3},{value:"Index",id:"index",level:4},{value:"PagingInfo",id:"paginginfo",level:4},{value:"ContentFilter",id:"contentfilter",level:4},{value:"HistoryQuery",id:"historyquery",level:4},{value:"Sorting Messages",id:"sorting-messages",level:4},{value:"HistoryResponse",id:"historyresponse",level:4},{value:"Security Consideration",id:"security-consideration",level:2},{value:"Future Work",id:"future-work",level:2},{value:"Copyright",id:"copyright",level:2},{value:"References",id:"references",level:2}],m={toc:d};function p(e){let{components:t,...n}=e;return(0,a.kt)("wrapper",(0,i.Z)({},m,n,{components:t,mdxType:"MDXLayout"}),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"Status: draft"),(0,a.kt)("li",{parentName:"ul"},"Editor: Simon-Pierre Vivier ","<",(0,a.kt)("a",{parentName:"li",href:"mailto:simvivier@status.im"},"simvivier@status.im"),">"),(0,a.kt)("li",{parentName:"ul"},"Contributors:",(0,a.kt)("ul",{parentName:"li"},(0,a.kt)("li",{parentName:"ul"},"Dean Eigenmann ","<",(0,a.kt)("a",{parentName:"li",href:"mailto:dean@status.im"},"dean@status.im"),">"),(0,a.kt)("li",{parentName:"ul"},"Oskar Thor\xe9n ","<",(0,a.kt)("a",{parentName:"li",href:"mailto:oskarth@titanproxy.com"},"oskarth@titanproxy.com"),">"),(0,a.kt)("li",{parentName:"ul"},"Aaryamann Challani ","<",(0,a.kt)("a",{parentName:"li",href:"mailto:aaryamann@status.im"},"aaryamann@status.im"),">"),(0,a.kt)("li",{parentName:"ul"},"Sanaz Taheri ","<",(0,a.kt)("a",{parentName:"li",href:"mailto:sanaz@status.im"},"sanaz@status.im"),">"),(0,a.kt)("li",{parentName:"ul"},"Hanno Cornelius ","<",(0,a.kt)("a",{parentName:"li",href:"mailto:hanno@status.im"},"hanno@status.im"),">")))),(0,a.kt)("h2",{id:"abstract"},"Abstract"),(0,a.kt)("p",null,"This specification explains the ",(0,a.kt)("inlineCode",{parentName:"p"},"13/WAKU2-STORE")," protocol which enables querying of messages received through the relay protocol and\nstored by other nodes.\nIt also supports pagination for more efficient querying of historical messages. "),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Protocol identifier*"),": ",(0,a.kt)("inlineCode",{parentName:"p"},"/vac/waku/store/2.0.0-beta4")),(0,a.kt)("h2",{id:"terminology"},"Terminology"),(0,a.kt)("p",null,"The term PII, Personally Identifiable Information,\nrefers to any piece of data that can be used to uniquely identify a user.\nFor example, the signature verification key, and\nthe hash of one's static IP address are unique for each user and hence count as PII."),(0,a.kt)("h2",{id:"design-requirements"},"Design Requirements"),(0,a.kt)("p",null,"The key words \u201cMUST\u201d, \u201cMUST NOT\u201d, \u201cREQUIRED\u201d, \u201cSHALL\u201d, \u201cSHALL NOT\u201d, \u201cSHOULD\u201d, \u201cSHOULD NOT\u201d,\n\u201cRECOMMENDED\u201d, \u201cMAY\u201d, and \u201cOPTIONAL\u201d in this document are to be interpreted as described in ",(0,a.kt)("a",{parentName:"p",href:"https://www.ietf.org/rfc/rfc2119.txt"},"RFC2119"),"."),(0,a.kt)("p",null,"Nodes willing to provide the storage service using ",(0,a.kt)("inlineCode",{parentName:"p"},"13/WAKU2-STORE")," protocol,\nSHOULD provide a complete and full view of message history.\nAs such, they are required to be ",(0,a.kt)("em",{parentName:"p"},"highly available")," and\nspecifically have a ",(0,a.kt)("em",{parentName:"p"},"high uptime")," to consistently receive and store network messages.\nThe high uptime requirement makes sure that no message is missed out hence a complete and\nintact view of the message history is delivered to the querying nodes.\nNevertheless, in case storage provider nodes cannot afford high availability,\nthe querying nodes may retrieve the historical messages from multiple sources to achieve a full and intact view of the past."),(0,a.kt)("p",null,"The concept of ",(0,a.kt)("inlineCode",{parentName:"p"},"ephemeral")," messages introduced in ",(0,a.kt)("a",{parentName:"p",href:"../14/message"},(0,a.kt)("inlineCode",{parentName:"a"},"14/WAKU2-MESSAGE"))," affects ",(0,a.kt)("inlineCode",{parentName:"p"},"13/WAKU2-STORE")," as well.\nNodes running ",(0,a.kt)("inlineCode",{parentName:"p"},"13/WAKU2-STORE")," SHOULD support ",(0,a.kt)("inlineCode",{parentName:"p"},"ephemeral")," messages as specified in ",(0,a.kt)("a",{parentName:"p",href:"../14/message"},"14/WAKU2-MESSAGE"),".\nNodes running ",(0,a.kt)("inlineCode",{parentName:"p"},"13/WAKU2-STORE")," SHOULD NOT store messages with the ",(0,a.kt)("inlineCode",{parentName:"p"},"ephemeral")," flag set to ",(0,a.kt)("inlineCode",{parentName:"p"},"true"),"."),(0,a.kt)("h2",{id:"adversarial-model"},"Adversarial Model"),(0,a.kt)("p",null,"Any peer running the ",(0,a.kt)("inlineCode",{parentName:"p"},"13/WAKU2-STORE")," protocol, i.e.\nboth the querying node and the queried node, are considered as an adversary.\nFurthermore,\nwe currently consider the adversary as a passive entity that attempts to collect information from other peers to conduct an attack but\nit does so without violating protocol definitions and instructions.\nAs we evolve the protocol,\nfurther adversarial models will be considered.\nFor example, under the passive adversarial model,\nno malicious node hides or\nlies about the history of messages as it is against the description of the ",(0,a.kt)("inlineCode",{parentName:"p"},"13/WAKU2-STORE")," protocol. "),(0,a.kt)("p",null,"The following are not considered as part of the adversarial model:"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"An adversary with a global view of all the peers and their connections."),(0,a.kt)("li",{parentName:"ul"},"An adversary that can eavesdrop on communication links between arbitrary pairs of peers (unless the adversary is one end of the communication).\nIn specific, the communication channels are assumed to be secure.")),(0,a.kt)("h2",{id:"wire-specification"},"Wire Specification"),(0,a.kt)("p",null,"Peers communicate with each other using a request / response API.\nThe messages sent are Protobuf RPC messages which are implemented using ",(0,a.kt)("a",{parentName:"p",href:"https://developers.google.com/protocol-buffers/"},"protocol buffers v3"),".\nThe following are the specifications of the Protobuf messages."),(0,a.kt)("h3",{id:"payloads"},"Payloads"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-protobuf"},'syntax = "proto3";\n\nmessage Index {\n  bytes digest = 1;\n  sint64 receiverTime = 2;\n  sint64 senderTime = 3;\n  string pubsubTopic = 4;\n}\n\nmessage PagingInfo {\n  uint64 pageSize = 1;\n  Index cursor = 2;\n  enum Direction {\n    BACKWARD = 0;\n    FORWARD = 1;\n  }\n  Direction direction = 3;\n}\n\nmessage ContentFilter {\n  string contentTopic = 1;\n}\n\nmessage HistoryQuery {\n  // the first field is reserved for future use\n  string pubsubtopic = 2;\n  repeated ContentFilter contentFilters = 3;\n  PagingInfo pagingInfo = 4;\n}\n\nmessage HistoryResponse {\n  // the first field is reserved for future use\n  repeated WakuMessage messages = 2;\n  PagingInfo pagingInfo = 3;\n  enum Error {\n    NONE = 0;\n    INVALID_CURSOR = 1;\n  }\n  Error error = 4;\n}\n\nmessage HistoryRPC {\n  string request_id = 1;\n  HistoryQuery query = 2;\n  HistoryResponse response = 3;\n}\n')),(0,a.kt)("h4",{id:"index"},"Index"),(0,a.kt)("p",null,"To perform pagination,\neach ",(0,a.kt)("inlineCode",{parentName:"p"},"WakuMessage")," stored at a node running the ",(0,a.kt)("inlineCode",{parentName:"p"},"13/WAKU2-STORE")," protocol is associated with a unique ",(0,a.kt)("inlineCode",{parentName:"p"},"Index")," that encapsulates the following parts. "),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"digest"),":  a sequence of bytes representing the SHA256 hash of a ",(0,a.kt)("inlineCode",{parentName:"li"},"WakuMessage"),".\nThe hash is computed over the concatenation of ",(0,a.kt)("inlineCode",{parentName:"li"},"contentTopic")," and ",(0,a.kt)("inlineCode",{parentName:"li"},"payload")," fields of a ",(0,a.kt)("inlineCode",{parentName:"li"},"WakuMessage")," (see ",(0,a.kt)("a",{parentName:"li",href:"../14/message"},"14/WAKU2-MESSAGE"),")."),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"receiverTime"),": the UNIX time in nanoseconds at which the ",(0,a.kt)("inlineCode",{parentName:"li"},"WakuMessage")," is received by the receiving node."),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"senderTime"),": the UNIX time in nanoseconds at which the ",(0,a.kt)("inlineCode",{parentName:"li"},"WakuMessage")," is generated by its sender."),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"pubsubTopic"),": the pubsub topic on which the ",(0,a.kt)("inlineCode",{parentName:"li"},"WakuMessage")," is received.")),(0,a.kt)("h4",{id:"paginginfo"},"PagingInfo"),(0,a.kt)("p",null,(0,a.kt)("inlineCode",{parentName:"p"},"PagingInfo")," holds the information required for pagination. It consists of the following components."),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"pageSize"),": A positive integer indicating the number of queried ",(0,a.kt)("inlineCode",{parentName:"li"},"WakuMessage"),"s in a ",(0,a.kt)("inlineCode",{parentName:"li"},"HistoryQuery"),"\n(or retrieved  ",(0,a.kt)("inlineCode",{parentName:"li"},"WakuMessage"),"s in a ",(0,a.kt)("inlineCode",{parentName:"li"},"HistoryResponse"),")."),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"cursor"),": holds the ",(0,a.kt)("inlineCode",{parentName:"li"},"Index")," of a ",(0,a.kt)("inlineCode",{parentName:"li"},"WakuMessage"),"."),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"direction"),": indicates the direction of paging which can be either ",(0,a.kt)("inlineCode",{parentName:"li"},"FORWARD")," or ",(0,a.kt)("inlineCode",{parentName:"li"},"BACKWARD"),".")),(0,a.kt)("h4",{id:"contentfilter"},"ContentFilter"),(0,a.kt)("p",null,(0,a.kt)("inlineCode",{parentName:"p"},"ContentFilter")," carries the information required for filtering historical messages. "),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"contentTopic")," represents the content topic of the queried historical ",(0,a.kt)("inlineCode",{parentName:"li"},"WakuMessage"),".\nThis field maps to the ",(0,a.kt)("inlineCode",{parentName:"li"},"contentTopic")," field of the ",(0,a.kt)("a",{parentName:"li",href:"../14/message"},"14/WAKU2-MESSAGE"),".")),(0,a.kt)("h4",{id:"historyquery"},"HistoryQuery"),(0,a.kt)("p",null,"RPC call to query historical messages."),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"The ",(0,a.kt)("inlineCode",{parentName:"li"},"pubsubTopic")," field MUST indicate the pubsub topic of the historical messages to be retrieved.\nThis field denotes the pubsub topic on which ",(0,a.kt)("inlineCode",{parentName:"li"},"WakuMessage"),"s are published.\nThis field maps to ",(0,a.kt)("inlineCode",{parentName:"li"},"topicIDs")," field of ",(0,a.kt)("inlineCode",{parentName:"li"},"Message")," in ",(0,a.kt)("a",{parentName:"li",href:"../11/relay"},(0,a.kt)("inlineCode",{parentName:"a"},"11/WAKU2-RELAY")),".\nLeaving this field empty means no filter on the pubsub topic of message history is requested.\nThis field SHOULD be left empty in order to retrieve the historical ",(0,a.kt)("inlineCode",{parentName:"li"},"WakuMessage")," regardless of the pubsub topics on which they are published."),(0,a.kt)("li",{parentName:"ul"},"The ",(0,a.kt)("inlineCode",{parentName:"li"},"contentFilters")," field MUST indicate the list of content filters based on which the historical messages are to be retrieved.\nLeaving this field empty means no filter on the content topic of message history is required.\nThis field SHOULD be left empty in order to retrieve historical ",(0,a.kt)("inlineCode",{parentName:"li"},"WakuMessage")," regardless of their content topics."),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"PagingInfo")," holds the information required for pagination.",(0,a.kt)("br",{parentName:"li"}),"Its ",(0,a.kt)("inlineCode",{parentName:"li"},"pageSize")," field indicates the number of  ",(0,a.kt)("inlineCode",{parentName:"li"},"WakuMessage"),"s to be included in the corresponding ",(0,a.kt)("inlineCode",{parentName:"li"},"HistoryResponse"),".\nIt is RECOMMENDED that the queried node defines a maximum page size internally.\nIf the querying node leaves the ",(0,a.kt)("inlineCode",{parentName:"li"},"pageSize")," unspecified,\nor if the ",(0,a.kt)("inlineCode",{parentName:"li"},"pageSize")," exceeds the maximum page size,\nthe queried node SHOULD auto-paginate the ",(0,a.kt)("inlineCode",{parentName:"li"},"HistoryResponse")," to no more than the configured maximum page size.\nThis allows mitigation of long response time for ",(0,a.kt)("inlineCode",{parentName:"li"},"HistoryQuery"),".\nIn the forward pagination request,\nthe ",(0,a.kt)("inlineCode",{parentName:"li"},"messages")," field of the ",(0,a.kt)("inlineCode",{parentName:"li"},"HistoryResponse")," SHALL contain, at maximum,\nthe ",(0,a.kt)("inlineCode",{parentName:"li"},"pageSize")," amount of ",(0,a.kt)("inlineCode",{parentName:"li"},"WakuMessage")," whose ",(0,a.kt)("inlineCode",{parentName:"li"},"Index")," values are larger than the given ",(0,a.kt)("inlineCode",{parentName:"li"},"cursor"),"\n(and vise versa for the backward pagination).\nNote that the ",(0,a.kt)("inlineCode",{parentName:"li"},"cursor")," of a ",(0,a.kt)("inlineCode",{parentName:"li"},"HistoryQuery")," MAY be empty (e.g., for the initial query), as such, and\ndepending on whether the  ",(0,a.kt)("inlineCode",{parentName:"li"},"direction")," is ",(0,a.kt)("inlineCode",{parentName:"li"},"BACKWARD")," or ",(0,a.kt)("inlineCode",{parentName:"li"},"FORWARD"),"  the last or the first ",(0,a.kt)("inlineCode",{parentName:"li"},"pageSize")," ",(0,a.kt)("inlineCode",{parentName:"li"},"WakuMessage")," SHALL be returned, respectively.")),(0,a.kt)("h4",{id:"sorting-messages"},"Sorting Messages"),(0,a.kt)("p",null,"The queried node MUST sort the ",(0,a.kt)("inlineCode",{parentName:"p"},"WakuMessage")," based on their ",(0,a.kt)("inlineCode",{parentName:"p"},"Index"),",\nwhere the ",(0,a.kt)("inlineCode",{parentName:"p"},"senderTime")," constitutes the most significant part and the ",(0,a.kt)("inlineCode",{parentName:"p"},"digest")," comes next, and\nthen perform pagination on the sorted result.\nAs such, the retrieved page contains an ordered list of ",(0,a.kt)("inlineCode",{parentName:"p"},"WakuMessage")," from the oldest messages to the most recent one.\nAlternatively, the ",(0,a.kt)("inlineCode",{parentName:"p"},"receiverTime")," (instead of ",(0,a.kt)("inlineCode",{parentName:"p"},"senderTime")," ) MAY be used to sort messages during the paging process.\nHowever, it is RECOMMENDED the use of the ",(0,a.kt)("inlineCode",{parentName:"p"},"senderTime")," for sorting as it is invariant and\nconsistent across all the nodes.\nThis has the benefit of ",(0,a.kt)("inlineCode",{parentName:"p"},"cursor")," reusability i.e.,\na ",(0,a.kt)("inlineCode",{parentName:"p"},"cursor")," obtained from one node can be consistently used to query from another node.\nHowever, this ",(0,a.kt)("inlineCode",{parentName:"p"},"cursor")," reusability does not hold when the ",(0,a.kt)("inlineCode",{parentName:"p"},"receiverTime")," is utilized as the receiver time is affected by the network delay and\nnodes' clock asynchrony."),(0,a.kt)("h4",{id:"historyresponse"},"HistoryResponse"),(0,a.kt)("p",null,"RPC call to respond to a HistoryQuery call."),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"The ",(0,a.kt)("inlineCode",{parentName:"li"},"messages")," field MUST contain the messages found,\nthese are ",(0,a.kt)("a",{parentName:"li",href:"../14/message"},"14/WAKU2-MESSAGE")," types."),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"PagingInfo"),"  holds the paging information based on which the querying node can resume its further history queries.\nThe ",(0,a.kt)("inlineCode",{parentName:"li"},"pageSize")," indicates the number of returned Waku messages (i.e., the number of messages included in the ",(0,a.kt)("inlineCode",{parentName:"li"},"messages")," field of ",(0,a.kt)("inlineCode",{parentName:"li"},"HistoryResponse"),").\nThe ",(0,a.kt)("inlineCode",{parentName:"li"},"direction")," is the same direction as in the corresponding ",(0,a.kt)("inlineCode",{parentName:"li"},"HistoryQuery"),".\nIn the forward pagination, the ",(0,a.kt)("inlineCode",{parentName:"li"},"cursor")," holds the ",(0,a.kt)("inlineCode",{parentName:"li"},"Index")," of the last message in the ",(0,a.kt)("inlineCode",{parentName:"li"},"HistoryResponse")," ",(0,a.kt)("inlineCode",{parentName:"li"},"messages")," (and the first message in the backward paging).\nRegardless of the paging direction, the retrieved ",(0,a.kt)("inlineCode",{parentName:"li"},"messages")," are always sorted in ascending order based on their timestamp as explained in the ",(0,a.kt)("a",{parentName:"li",href:"#sorting-messages"},"sorting messages")," section, that is, from the oldest to the most recent.\nThe requester SHALL embed the returned ",(0,a.kt)("inlineCode",{parentName:"li"},"cursor")," inside its next ",(0,a.kt)("inlineCode",{parentName:"li"},"HistoryQuery")," to retrieve the next page of the ",(0,a.kt)("a",{parentName:"li",href:"../14/message"},"14/WAKU2-MESSAGE"),".",(0,a.kt)("br",{parentName:"li"}),"The ",(0,a.kt)("inlineCode",{parentName:"li"},"cursor")," obtained from one node SHOULD NOT be used in a request to another node because the result may be different."),(0,a.kt)("li",{parentName:"ul"},"The ",(0,a.kt)("inlineCode",{parentName:"li"},"error")," field contains information about any error that has occurred while processing the corresponding ",(0,a.kt)("inlineCode",{parentName:"li"},"HistoryQuery"),".\n",(0,a.kt)("inlineCode",{parentName:"li"},"NONE")," stands for no error.\nThis is also the default value.\n",(0,a.kt)("inlineCode",{parentName:"li"},"INVALID_CURSOR")," means that the ",(0,a.kt)("inlineCode",{parentName:"li"},"cursor")," field of ",(0,a.kt)("inlineCode",{parentName:"li"},"HistoryQuery")," does not match with the ",(0,a.kt)("inlineCode",{parentName:"li"},"Index")," of any of the ",(0,a.kt)("inlineCode",{parentName:"li"},"WakuMessage")," persisted by the queried node.")),(0,a.kt)("h2",{id:"security-consideration"},"Security Consideration"),(0,a.kt)("p",null,"The main security consideration to take into account while using this protocol is that a querying node have to reveal their content filters of interest to the queried node, hence potentially compromising their privacy."),(0,a.kt)("h2",{id:"future-work"},"Future Work"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("strong",{parentName:"li"},"Anonymous query"),": This feature guarantees that nodes can anonymously query historical messages from other nodes i.e.,\nwithout disclosing the exact topics of ",(0,a.kt)("a",{parentName:"li",href:"../14/message"},"14/WAKU2-MESSAGE")," they are interested in.",(0,a.kt)("br",{parentName:"li"}),"As such, no adversary in the ",(0,a.kt)("inlineCode",{parentName:"li"},"13/WAKU2-STORE")," protocol would be able to learn which peer is interested in which content filters i.e.,\ncontent topics of ",(0,a.kt)("a",{parentName:"li",href:"../14/message"},"14/WAKU2-MESSAGE"),".\nThe current version of the ",(0,a.kt)("inlineCode",{parentName:"li"},"13/WAKU2-STORE")," protocol does not provide anonymity for historical queries,\nas the querying node needs to directly connect to another node in the ",(0,a.kt)("inlineCode",{parentName:"li"},"13/WAKU2-STORE")," protocol and\nexplicitly disclose the content filters of its interest to retrieve the corresponding messages.\nHowever, one can consider preserving anonymity through one of the following ways: ",(0,a.kt)("ul",{parentName:"li"},(0,a.kt)("li",{parentName:"ul"},"By hiding the source of the request i.e., anonymous communication.\nThat is the querying node shall hide all its PII in its history request e.g., its IP address.\nThis can happen by the utilization of a proxy server or by using Tor.\nNote that the current structure of historical requests does not embody any piece of PII, otherwise,\nsuch data fields must be treated carefully to achieve query anonymity. ")))),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"By deploying secure 2-party computations in which the querying node obtains the historical messages of a certain topic,\nthe queried node learns nothing about the query.\nExamples of such 2PC protocols are secure one-way Private Set Intersections (PSI). ")),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("strong",{parentName:"li"},"Robust and verifiable timestamps"),": Messages timestamp is a way to show that the message existed prior to some point in time.\nHowever, the lack of timestamp verifiability can create room for a range of attacks,\nincluding injecting messages with invalid timestamps pointing to the far future.",(0,a.kt)("br",{parentName:"li"}),"To better understand the attack,\nconsider a store node whose current clock shows ",(0,a.kt)("inlineCode",{parentName:"li"},"2021-01-01 00:00:30")," (and assume all the other nodes have a synchronized clocks +-20seconds).\nThe store node already has a list of messages,\n",(0,a.kt)("inlineCode",{parentName:"li"},"(m1,2021-01-01 00:00:00), (m2,2021-01-01 00:00:01), ..., (m10:2021-01-01 00:00:20)"),",\nthat are sorted based on their timestamp.",(0,a.kt)("br",{parentName:"li"}),"An attacker sends a message with an arbitrary large timestamp e.g.,\n10 hours ahead of the correct clock ",(0,a.kt)("inlineCode",{parentName:"li"},"(m',2021-01-01 10:00:30)"),".\nThe store node places ",(0,a.kt)("inlineCode",{parentName:"li"},"m'")," at the end of the list,\n",(0,a.kt)("inlineCode",{parentName:"li"},"(m1,2021-01-01 00:00:00), (m2,2021-01-01 00:00:01), ..., (m10:2021-01-01 00:00:20), (m',2021-01-01 10:00:30)"),".\nNow another message arrives with a valid timestamp e.g.,\n",(0,a.kt)("inlineCode",{parentName:"li"},"(m11, 2021-01-01 00:00:45)"),".\nHowever, since its timestamp precedes the malicious message ",(0,a.kt)("inlineCode",{parentName:"li"},"m'"),",\nit gets placed before ",(0,a.kt)("inlineCode",{parentName:"li"},"m'")," in the list i.e.,\n",(0,a.kt)("inlineCode",{parentName:"li"},"(m1,2021-01-01 00:00:00), (m2,2021-01-01 00:00:01), ..., (m10:2021-01-01 00:00:20), (m11, 2021-01-01 00:00:45), (m',2021-01-01 10:00:30)"),".\nIn fact, for the next 10 hours,\n",(0,a.kt)("inlineCode",{parentName:"li"},"m'")," will always be considered as the most recent message and\nserved as the last message to the querying nodes irrespective of how many other messages arrive afterward. ")),(0,a.kt)("p",null,"A robust and verifiable timestamp allows the receiver of a message to verify that a message has been generated prior to the claimed timestamp.\nOne solution is the use of ",(0,a.kt)("a",{parentName:"p",href:"https://opentimestamps.org/"},"open timestamps")," e.g.,\nblock height in Blockchain-based timestamps.\nThat is, messages contain the most recent block height perceived by their senders at the time of message generation.\nThis proves accuracy within a range of minutes (e.g., in Bitcoin blockchain) or\nseconds (e.g., in Ethereum 2.0) from the time of origination. "),(0,a.kt)("h2",{id:"copyright"},"Copyright"),(0,a.kt)("p",null,"Copyright and related rights waived via\n",(0,a.kt)("a",{parentName:"p",href:"https://creativecommons.org/publicdomain/zero/1.0/"},"CC0"),"."),(0,a.kt)("h2",{id:"references"},"References"),(0,a.kt)("ol",null,(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("a",{parentName:"li",href:"../14/message"},"14/WAKU2-MESSAGE")),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("a",{parentName:"li",href:"https://developers.google.com/protocol-buffers/"},"protocol buffers v3")),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("a",{parentName:"li",href:"../11/relay"},"11/WAKU2-RELAY")),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("a",{parentName:"li",href:"https://opentimestamps.org/"},"Open timestamps"))))}p.isMDXComponent=!0},3905:(e,t,n)=>{n.d(t,{Zo:()=>m,kt:()=>u});var i=n(67294);function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function r(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function o(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?r(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,i,a=function(e,t){if(null==e)return{};var n,i,a={},r=Object.keys(e);for(i=0;i<r.length;i++)n=r[i],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(i=0;i<r.length;i++)n=r[i],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var l=i.createContext({}),d=function(e){var t=i.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):o(o({},t),e)),n},m=function(e){var t=d(e.components);return i.createElement(l.Provider,{value:t},e.children)},p={inlineCode:"code",wrapper:function(e){var t=e.children;return i.createElement(i.Fragment,{},t)}},h=i.forwardRef((function(e,t){var n=e.components,a=e.mdxType,r=e.originalType,l=e.parentName,m=s(e,["components","mdxType","originalType","parentName"]),h=d(n),u=a,c=h["".concat(l,".").concat(u)]||h[u]||p[u]||r;return n?i.createElement(c,o(o({ref:t},m),{},{components:n})):i.createElement(c,o({ref:t},m))}));function u(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var r=n.length,o=new Array(r);o[0]=h;var s={};for(var l in t)hasOwnProperty.call(t,l)&&(s[l]=t[l]);s.originalType=e,s.mdxType="string"==typeof e?e:a,o[1]=s;for(var d=2;d<r;d++)o[d]=n[d];return i.createElement.apply(null,o)}return i.createElement.apply(null,n)}h.displayName="MDXCreateElement"}}]);