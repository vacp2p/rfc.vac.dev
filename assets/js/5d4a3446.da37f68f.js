"use strict";(self.webpackChunklogos_docs_template=self.webpackChunklogos_docs_template||[]).push([[3204],{18204:(e,t,a)=>{a.r(t),a.d(t,{assets:()=>s,contentTitle:()=>r,default:()=>c,frontMatter:()=>o,metadata:()=>l,toc:()=>p});var n=a(87462),i=(a(67294),a(3905));const o={title:"6/WAKU1",name:"Waku v1",status:"stable",editor:"Oskar Thor\xe9n <oskarth@titanproxy.com>",contributors:["Adam Babik <adam@status.im>","Andrea Maria Piana <andreap@status.im>","Dean Eigenmann <dean@status.im>","Kim De Mey <kimdemey@status.im>"]},r=void 0,l={unversionedId:"standards/legacy/6/waku1",id:"standards/legacy/6/waku1",title:"6/WAKU1",description:"- Status: stable",source:"@site/waku/standards/legacy/6/waku1.md",sourceDirName:"standards/legacy/6",slug:"/standards/legacy/6/waku1",permalink:"/waku/standards/legacy/6/waku1",draft:!1,tags:[],version:"current",frontMatter:{title:"6/WAKU1",name:"Waku v1",status:"stable",editor:"Oskar Thor\xe9n \\<oskarth@titanproxy.com\\>",contributors:["Adam Babik \\<adam@status.im\\>","Andrea Maria Piana \\<andreap@status.im\\>","Dean Eigenmann \\<dean@status.im\\>","Kim De Mey \\<kimdemey@status.im\\>"]},sidebar:"defaultSidebar",previous:{title:"66/WAKU2-METADATA",permalink:"/waku/standards/core/66/metadata"},next:{title:"7/WAKU-DATA",permalink:"/waku/standards/legacy/7/data"}},s={},p=[{value:"Motivation",id:"motivation",level:2},{value:"Definitions",id:"definitions",level:2},{value:"Underlying Transports and Prerequisites",id:"underlying-transports-and-prerequisites",level:2},{value:"Use of DevP2P",id:"use-of-devp2p",level:3},{value:"Gossip based routing",id:"gossip-based-routing",level:3},{value:"Maximum Packet Size",id:"maximum-packet-size",level:3},{value:"Wire Specification",id:"wire-specification",level:2},{value:"Use of RLPx transport protocol",id:"use-of-rlpx-transport-protocol",level:3},{value:"ABNF specification",id:"abnf-specification",level:3},{value:"Packet Codes",id:"packet-codes",level:3},{value:"Packet usage",id:"packet-usage",level:3},{value:"Status",id:"status",level:4},{value:"Messages",id:"messages",level:4},{value:"Status Update",id:"status-update",level:4},{value:"PoW Requirement Field",id:"pow-requirement-field",level:5},{value:"Bloom Filter Field",id:"bloom-filter-field",level:5},{value:"Topic Interest Field",id:"topic-interest-field",level:5},{value:"Rate Limits Field",id:"rate-limits-field",level:5},{value:"Light Node Field",id:"light-node-field",level:5},{value:"Confirmations Enabled Field",id:"confirmations-enabled-field",level:5},{value:"Batch Ack and Message Response",id:"batch-ack-and-message-response",level:4},{value:"P2P Request",id:"p2p-request",level:4},{value:"P2P Message",id:"p2p-message",level:4},{value:"P2P Request Complete",id:"p2p-request-complete",level:4},{value:"Payload Encryption",id:"payload-encryption",level:3},{value:"Packet code Rationale",id:"packet-code-rationale",level:3},{value:"Additional capabilities",id:"additional-capabilities",level:2},{value:"Light node",id:"light-node",level:3},{value:"Accounting for resources (experimental)",id:"accounting-for-resources-experimental",level:3},{value:"Upgradability and Compatibility",id:"upgradability-and-compatibility",level:2},{value:"General principles and policy",id:"general-principles-and-policy",level:3},{value:"Backwards Compatibility",id:"backwards-compatibility",level:3},{value:"Waku-Whisper bridging",id:"waku-whisper-bridging",level:3},{value:"Forward Compatibility",id:"forward-compatibility",level:3},{value:"Appendix A: Security considerations",id:"appendix-a-security-considerations",level:2},{value:"Scalability and UX",id:"scalability-and-ux",level:3},{value:"Bandwidth usage:",id:"bandwidth-usage",level:4},{value:"Gossip-based routing:",id:"gossip-based-routing-1",level:4},{value:"Lack of incentives:",id:"lack-of-incentives",level:4},{value:"Privacy",id:"privacy",level:3},{value:"Light node privacy:",id:"light-node-privacy",level:4},{value:"Mailserver client privacy:",id:"mailserver-client-privacy",level:4},{value:"Bloom filter privacy:",id:"bloom-filter-privacy",level:4},{value:"Privacy guarantees not rigorous:",id:"privacy-guarantees-not-rigorous",level:4},{value:"Topic hygiene:",id:"topic-hygiene",level:4},{value:"Spam resistance",id:"spam-resistance",level:3},{value:"Censorship resistance",id:"censorship-resistance",level:3},{value:"Appendix B: Implementation Notes",id:"appendix-b-implementation-notes",level:2},{value:"Implementation Matrix",id:"implementation-matrix",level:3},{value:"Recommendations for clients",id:"recommendations-for-clients",level:3},{value:"Node discovery",id:"node-discovery",level:3},{value:"Changelog",id:"changelog",level:2},{value:"Initial Release",id:"initial-release",level:3},{value:"Version 1.1",id:"version-11",level:3},{value:"Version 1.0",id:"version-10",level:3},{value:"Version 0.6",id:"version-06",level:3},{value:"Version 0.5",id:"version-05",level:3},{value:"Version 0.4",id:"version-04",level:3},{value:"Version 0.3",id:"version-03",level:3},{value:"Version 0.2",id:"version-02",level:3},{value:"Version 0.1",id:"version-01",level:3},{value:"Differences between shh/6 and waku/1",id:"differences-between-shh6-and-waku1",level:3},{value:"Copyright",id:"copyright",level:2},{value:"Footnotes",id:"footnotes",level:2}],d={toc:p};function c(e){let{components:t,...a}=e;return(0,i.kt)("wrapper",(0,n.Z)({},d,a,{components:t,mdxType:"MDXLayout"}),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"Status: stable"),(0,i.kt)("li",{parentName:"ul"},"Editor: Oskar Thor\xe9n \\",(0,i.kt)("a",{parentName:"li",href:"mailto:oskarth@titanproxy.com%5C"},"oskarth@titanproxy.com\\")),(0,i.kt)("li",{parentName:"ul"},"Contributors::",(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},"Adam Babik \\",(0,i.kt)("a",{parentName:"li",href:"mailto:adam@status.im%5C"},"adam@status.im\\")),(0,i.kt)("li",{parentName:"ul"},"Andrea Maria Piana \\",(0,i.kt)("a",{parentName:"li",href:"mailto:andreap@status.im%5C"},"andreap@status.im\\")),(0,i.kt)("li",{parentName:"ul"},"Dean Eigenmann \\",(0,i.kt)("a",{parentName:"li",href:"mailto:dean@status.im%5C"},"dean@status.im\\")),(0,i.kt)("li",{parentName:"ul"},"Kim De Mey \\",(0,i.kt)("a",{parentName:"li",href:"mailto:kimdemey@status.im%5C"},"kimdemey@status.im\\"))))),(0,i.kt)("p",null,"This specification describes the format of Waku packets within the \xd0\u039eVp2p Wire Protocol. This spec substitutes ",(0,i.kt)("a",{parentName:"p",href:"https://eips.ethereum.org/EIPS/eip-627"},"EIP-627"),". Waku is a fork of the original Whisper protocol that enables better usability for resource restricted devices, such as mostly-offline bandwidth-constrained smartphones. It does this through (a) light node support, (b) historic envelopes (with a mailserver) (c) expressing topic interest for better bandwidth usage and (d) basic rate limiting."),(0,i.kt)("h2",{id:"motivation"},"Motivation"),(0,i.kt)("p",null,"Waku was created to incrementally improve in areas that Whisper is lacking in, with special attention to resource restricted devices. We specify the standard for Waku packets in order to ensure forward compatibility of different Waku clients, backwards compatibility with Whisper clients, as well as to allow multiple implementations of Waku and its capabilities. We also modify the language to be more unambiguous, concise and consistent."),(0,i.kt)("h2",{id:"definitions"},"Definitions"),(0,i.kt)("table",null,(0,i.kt)("thead",{parentName:"table"},(0,i.kt)("tr",{parentName:"thead"},(0,i.kt)("th",{parentName:"tr",align:null},"Term"),(0,i.kt)("th",{parentName:"tr",align:null},"Definition"))),(0,i.kt)("tbody",{parentName:"table"},(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("strong",{parentName:"td"},"Batch Ack")),(0,i.kt)("td",{parentName:"tr",align:null},"An abbreviated term for Batch Acknowledgment")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("strong",{parentName:"td"},"Light node")),(0,i.kt)("td",{parentName:"tr",align:null},"A Waku node that does not forward any envelopes through the Messages packet.")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("strong",{parentName:"td"},"Envelope")),(0,i.kt)("td",{parentName:"tr",align:null},"Messages sent and received by Waku nodes. Described in ",(0,i.kt)("a",{parentName:"td",href:"#abnf-specification"},"ABNF spec ",(0,i.kt)("inlineCode",{parentName:"a"},"waku-envelope")))),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("strong",{parentName:"td"},"Node")),(0,i.kt)("td",{parentName:"tr",align:null},"Some process that is able to communicate for Waku.")))),(0,i.kt)("h2",{id:"underlying-transports-and-prerequisites"},"Underlying Transports and Prerequisites"),(0,i.kt)("h3",{id:"use-of-devp2p"},"Use of DevP2P"),(0,i.kt)("p",null,"For nodes to communicate, they MUST implement devp2p and run RLPx. They MUST have some way of connecting to other nodes. Node discovery is largely out of scope for this spec, but see the appendix for some suggestions on how to do this."),(0,i.kt)("p",null,"This protocol needs to advertise the ",(0,i.kt)("inlineCode",{parentName:"p"},"waku/1")," ",(0,i.kt)("a",{parentName:"p",href:"https://ethereum.gitbooks.io/frontier-guide/devp2p.html"},"capability"),"."),(0,i.kt)("h3",{id:"gossip-based-routing"},"Gossip based routing"),(0,i.kt)("p",null,"In Whisper, envelopes are gossiped between peers. Whisper is a form of rumor-mongering protocol that works by flooding to its connected peers based on some factors. Envelopes are eligible for retransmission until their TTL expires. A node SHOULD relay envelopes to all connected nodes if an envelope matches their PoW and bloom filter settings. If a node works in light mode, it MAY choose not to forward envelopes. A node MUST NOT send expired envelopes, unless the envelopes are sent as a ",(0,i.kt)("a",{parentName:"p",href:"../8/mail"},"8/WAKU-MAIL")," response. A node SHOULD NOT send an envelope to a peer that it has already sent before."),(0,i.kt)("h3",{id:"maximum-packet-size"},"Maximum Packet Size"),(0,i.kt)("p",null,"Nodes SHOULD limit the maximum size of both packets and envelopes. If a packet or envelope exceeds its limit, it MUST be dropped."),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("strong",{parentName:"li"},"RLPx Packet Size")," - This size MUST be checked before a message is decoded."),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("strong",{parentName:"li"},"Waku Envelope Size")," - Each envelope contained in an RLPx packet MUST then separately be checked against the maximum envelope size.")),(0,i.kt)("p",null,"Clients MAY use their own maximum packet and envelope sizes. The default values are ",(0,i.kt)("inlineCode",{parentName:"p"},"1.5mb")," for the RLPx Packet and ",(0,i.kt)("inlineCode",{parentName:"p"},"1mb")," for a Waku envelope."),(0,i.kt)("h2",{id:"wire-specification"},"Wire Specification"),(0,i.kt)("h3",{id:"use-of-rlpx-transport-protocol"},"Use of RLPx transport protocol"),(0,i.kt)("p",null,"All Waku packets are sent as devp2p RLPx transport protocol, version 5",(0,i.kt)("sup",{parentName:"p",id:"fnref-1"},(0,i.kt)("a",{parentName:"sup",href:"#fn-1",className:"footnote-ref"},"1"))," packets. These packets MUST be RLP-encoded arrays of data containing two objects: packet code followed by another object (whose type depends on the packet code).  See ",(0,i.kt)("a",{parentName:"p",href:"https://github.com/ethereum/wiki/wiki/RLP"},"informal RLP spec")," and the ",(0,i.kt)("a",{parentName:"p",href:"https://ethereum.github.io/yellowpaper/paper.pdf"},"Ethereum Yellow Paper, appendix B")," for more details on RLP."),(0,i.kt)("p",null,"Waku is a RLPx subprotocol called ",(0,i.kt)("inlineCode",{parentName:"p"},"waku")," with version ",(0,i.kt)("inlineCode",{parentName:"p"},"0"),". The version number corresponds to the major version in the header spec. Minor versions should not break compatibility of ",(0,i.kt)("inlineCode",{parentName:"p"},"waku"),", this would result in a new major. (Some exceptions to this apply in the Draft stage of where client implementation is rapidly change)."),(0,i.kt)("h3",{id:"abnf-specification"},"ABNF specification"),(0,i.kt)("p",null,"Using ",(0,i.kt)("a",{parentName:"p",href:"https://tools.ietf.org/html/rfc5234"},"Augmented Backus-Naur form (ABNF)")," we have the following format:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-abnf"},'; Packet codes 0 - 127 are reserved for Waku protocol\npacket-code = 1*3DIGIT\n\n; rate limits per packet\npacket-limit-ip     = 1*DIGIT\npacket-limit-peerid = 1*DIGIT\npacket-limit-topic  = 1*DIGIT\n\n; rate limits by size in bytes\nbytes-limit-ip     = 1*DIGIT\nbytes-limit-peerid = 1*DIGIT\nbytes-limit-topic  = 1*DIGIT\n\npacket-rate-limits = "[" packet-limit-ip packet-limit-peerid packet-limit-topic "]"\nbytes-rate-limits = "[" bytes-limit-ip bytes-limit-peerid bytes-limit-topic "]"\n\npow-requirement-key = 0\nbloom-filter-key = 1\nlight-node-key = 2\nconfirmations-enabled-key = 3\npacket-rate-limits-key = 4\ntopic-interest-key = 5\nbytes-rate-limits-key = 6\n\nstatus-options = "["\n  [ pow-requirement-key pow-requirement ]\n  [ bloom-filter-key bloom-filter ]\n  [ light-node-key light-node ]\n  [ confirmations-enabled-key confirmations-enabled ]\n  [ packet-rate-limits-key packet-rate-limits ]\n  [ topic-interest-key topic-interest ]\n  [ bytes-limits-key bytes-rate-limits ]\n"]"\n\nstatus = status-options\n\nstatus-update = status-options\n\nconfirmations-enabled = BIT\n\nlight-node = BIT\n\n; pow is "a single floating point value of PoW.\n; This value is the IEEE 754 binary representation\n; of a 64-bit floating point number packed as a uint64.\n; Values of qNAN, sNAN, INF and -INF are not allowed.\n; Negative values are also not allowed."\npow             = 1*DIGIT "." 1*DIGIT\npow-requirement = pow\n\n; bloom filter is "a byte array"\nbloom-filter = *OCTET\n\nwaku-envelope = "[" expiry ttl topic data nonce "]"\n\n; List of topics interested in\ntopic-interest = "[" *10000topic "]"\n\n; 4 bytes (UNIX time in seconds)\nexpiry = 4OCTET\n\n; 4 bytes (time-to-live in seconds)\nttl = 4OCTET\n\n; 4 bytes of arbitrary data\ntopic = 4OCTET\n\n; byte array of arbitrary size\n; (contains encrypted payload)\ndata = *OCTET\n\n; 8 bytes of arbitrary data\n; (used for PoW calculation)\nnonce = 8OCTET\n\nmessages = 1*waku-envelope\n\n; version of the confirmation packet\nversion = 1*DIGIT\n\n; keccak256 hash of the envelopes batch data (raw bytes)\n; for which the confirmation is sent\nhash = *OCTET\n\nhasherror = *OCTET\n\n; error code\ncode = 1*DIGIT\n\n; a descriptive error message\ndescription = *ALPHA\n\nerror  = "[" hasherror code description "]"\nerrors = *error\n\nresponse = "[" hash errors "]"\n\nconfirmation = "[" version response "]"\n\n; message confirmation packet types\nbatch-ack = confirmation\nmessage-response = confirmation\n\n; mail server / client specific\np2p-request = waku-envelope\np2p-message = 1*waku-envelope\np2p-request-complete = *OCTET\n\n; packet-format needs to be paired with its\n; corresponding packet-format\npacket-format = "[" packet-code packet-format "]"\n\nrequired-packet = 0 status /\n                  1 messages /\n                  22 status-update /\n\noptional-packet = 11 batch-ack /\n                  12 message-response /\n                  126 p2p-request-complete /\n                  126 p2p-request /\n                  127 p2p-message\n\npacket = "[" required-packet [ optional-packet ] "]"\n')),(0,i.kt)("p",null,"All primitive types are RLP encoded. Note that, per RLP specification, integers are encoded starting from ",(0,i.kt)("inlineCode",{parentName:"p"},"0x00"),"."),(0,i.kt)("h3",{id:"packet-codes"},"Packet Codes"),(0,i.kt)("p",null,"The packet codes reserved for Waku protocol: 0 - 127."),(0,i.kt)("p",null,"Packets with unknown codes MUST be ignored without generating any error, for forward compatibility of future versions."),(0,i.kt)("p",null,"The Waku sub-protocol MUST support the following packet codes:"),(0,i.kt)("table",null,(0,i.kt)("thead",{parentName:"table"},(0,i.kt)("tr",{parentName:"thead"},(0,i.kt)("th",{parentName:"tr",align:null},"Name"),(0,i.kt)("th",{parentName:"tr",align:null},"Int Value"))),(0,i.kt)("tbody",{parentName:"table"},(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"Status"),(0,i.kt)("td",{parentName:"tr",align:null},"0")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"Messages"),(0,i.kt)("td",{parentName:"tr",align:null},"1")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"Status Update"),(0,i.kt)("td",{parentName:"tr",align:null},"22")))),(0,i.kt)("p",null,"The following message codes are optional, but they are reserved for specific purpose."),(0,i.kt)("table",null,(0,i.kt)("thead",{parentName:"table"},(0,i.kt)("tr",{parentName:"thead"},(0,i.kt)("th",{parentName:"tr",align:null},"Name"),(0,i.kt)("th",{parentName:"tr",align:null},"Int Value"),(0,i.kt)("th",{parentName:"tr",align:null},"Comment"))),(0,i.kt)("tbody",{parentName:"table"},(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"Batch Ack"),(0,i.kt)("td",{parentName:"tr",align:null},"11"),(0,i.kt)("td",{parentName:"tr",align:null})),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"Message Response"),(0,i.kt)("td",{parentName:"tr",align:null},"12"),(0,i.kt)("td",{parentName:"tr",align:null})),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"P2P Request Complete"),(0,i.kt)("td",{parentName:"tr",align:null},"125"),(0,i.kt)("td",{parentName:"tr",align:null})),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"P2P Request"),(0,i.kt)("td",{parentName:"tr",align:null},"126"),(0,i.kt)("td",{parentName:"tr",align:null})),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"P2P Message"),(0,i.kt)("td",{parentName:"tr",align:null},"127"),(0,i.kt)("td",{parentName:"tr",align:null})))),(0,i.kt)("h3",{id:"packet-usage"},"Packet usage"),(0,i.kt)("h4",{id:"status"},"Status"),(0,i.kt)("p",null,"The Status packet serves as a Waku handshake and peers MUST exchange this\npacket upon connection. It MUST be sent after the RLPx handshake and prior to\nany other Waku packets."),(0,i.kt)("p",null,"A Waku node MUST await the Status packet from a peer before engaging in other Waku protocol activity with that peer.\nWhen a node does not receive the Status packet from a peer, before a configurable timeout, it SHOULD disconnect from that peer."),(0,i.kt)("p",null,"Upon retrieval of the Status packet, the node SHOULD validate the packet\nreceived and validated the Status packet. Note that its peer might not be in\nthe same state."),(0,i.kt)("p",null,"When a node is receiving other Waku packets from a peer before a Status\npacket is received, the node MUST ignore these packets and SHOULD disconnect from that peer. Status packets received after the handshake is completed MUST also be ignored."),(0,i.kt)("p",null,"The Status packet MUST contain an association list containing various options. All options within this association list are OPTIONAL, ordering of the key-value pairs is not guaranteed and therefore MUST NOT be relied on. Unknown keys in the association list SHOULD be ignored."),(0,i.kt)("h4",{id:"messages"},"Messages"),(0,i.kt)("p",null,"This packet is used for sending the standard Waku envelopes."),(0,i.kt)("h4",{id:"status-update"},"Status Update"),(0,i.kt)("p",null,"The Status Update packet is used to communicate an update of the settings of the node.\nThe format is the same as the Status packet, all fields are optional.\nIf none of the options are specified the packet MUST be ignored and considered a noop.\nFields that are omitted are considered unchanged, fields that haven't changed SHOULD not\nbe transmitted."),(0,i.kt)("h5",{id:"pow-requirement-field"},"PoW Requirement Field"),(0,i.kt)("p",null,"When PoW Requirement is updated, peers MUST NOT deliver envelopes with PoW lower than the PoW Requirement specified."),(0,i.kt)("p",null,"PoW is defined as average number of iterations, required to find the current BestBit (the number of leading zero bits in the hash), divided by envelope size and TTL:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"PoW = (2**BestBit) / (size * TTL)\n")),(0,i.kt)("p",null,"PoW calculation:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"fn short_rlp(envelope) = rlp of envelope, excluding env_nonce field.\nfn pow_hash(envelope, env_nonce) = sha3(short_rlp(envelope) ++ env_nonce)\nfn pow(pow_hash, size, ttl) = 2**leading_zeros(pow_hash) / (size * ttl)\n")),(0,i.kt)("p",null,"where size is the size of the RLP-encoded envelope, excluding ",(0,i.kt)("inlineCode",{parentName:"p"},"env_nonce")," field (size of ",(0,i.kt)("inlineCode",{parentName:"p"},"short_rlp(envelope)"),")."),(0,i.kt)("h5",{id:"bloom-filter-field"},"Bloom Filter Field"),(0,i.kt)("p",null,"The bloom filter is used to identify a number of topics to a peer without compromising (too much) privacy over precisely what topics are of interest. Precise control over the information content (and thus efficiency of the filter) may be maintained through the addition of bits."),(0,i.kt)("p",null,"Blooms are formed by the bitwise OR operation on a number of bloomed topics. The bloom function takes the topic and projects them onto a 512-bit slice. At most, three bits are marked for each bloomed topic."),(0,i.kt)("p",null,"The projection function is defined as a mapping from a 4-byte slice S to a 512-bit slice D; for ease of explanation, S will dereference to bytes, whereas D will dereference to bits."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"LET D[*] = 0\nFOREACH i IN { 0, 1, 2 } DO\nLET n = S[i]\nIF S[3] & (2 ** i) THEN n += 256\nD[n] = 1\nEND FOR\n")),(0,i.kt)("p",null,"A full bloom filter (all the bits set to 1) means that the node is to be considered a ",(0,i.kt)("inlineCode",{parentName:"p"},"Full Node")," and it will accept any topic."),(0,i.kt)("p",null,"If both topic interest and bloom filter are specified, topic interest always takes precedence and bloom filter MUST be ignored."),(0,i.kt)("p",null,"If only bloom filter is specified, the current topic interest MUST be discarded and only the updated bloom filter MUST be used when forwarding or posting envelopes."),(0,i.kt)("p",null,"A bloom filter with all bits set to 0 signals that the node is not currently interested in receiving any envelope."),(0,i.kt)("h5",{id:"topic-interest-field"},"Topic Interest Field"),(0,i.kt)("p",null,"Topic interest is used to share a node's interest in envelopes with specific topics. It does this in a more bandwidth considerate way, at the expense of some metadata protection. Peers MUST only send envelopes with specified topics."),(0,i.kt)("p",null,"It is currently bounded to a maximum of 10000 topics. If you are interested in more topics than that, this is currently underspecified and likely requires updating it. The constant is subject to change."),(0,i.kt)("p",null,"If only topic interest is specified, the current bloom filter MUST be discarded and only the updated topic interest MUST be used when forwarding or posting envelopes."),(0,i.kt)("p",null,"An empty array signals that the node is not currently interested in receiving any envelope."),(0,i.kt)("h5",{id:"rate-limits-field"},"Rate Limits Field"),(0,i.kt)("p",null,"Rate limits is used to inform other nodes of their self defined rate limits."),(0,i.kt)("p",null,"In order to provide basic Denial-of-Service attack protection, each node SHOULD define its own rate limits. The rate limits SHOULD be applied on IPs, peer IDs, and envelope topics."),(0,i.kt)("p",null,"Each node MAY decide to whitelist, i.e. do not rate limit, selected IPs or peer IDs."),(0,i.kt)("p",null,"If a peer exceeds node's rate limits, the connection between them MAY be dropped."),(0,i.kt)("p",null,"Each node SHOULD broadcast its rate limits to its peers using the ",(0,i.kt)("inlineCode",{parentName:"p"},"status-update")," packet. The rate limits MAY also be sent as an optional parameter in the handshake."),(0,i.kt)("p",null,"Each node SHOULD respect rate limits advertised by its peers. The number of packets SHOULD be throttled in order not to exceed peer's rate limits. If the limit gets exceeded, the connection MAY be dropped by the peer."),(0,i.kt)("p",null,"Two rate limits strategies are applied:"),(0,i.kt)("p",null,"1) Number of packets per second\n2) Size of packets (in bytes) per second"),(0,i.kt)("p",null,"Both strategies SHOULD be applied per IP address, peer id and topic."),(0,i.kt)("p",null,"The size limit SHOULD be greater or equal than the maximum packet size."),(0,i.kt)("h5",{id:"light-node-field"},"Light Node Field"),(0,i.kt)("p",null,"When the node's ",(0,i.kt)("inlineCode",{parentName:"p"},"light-node")," field is set to true, the node SHOULD NOT forward Envelopes from its peers."),(0,i.kt)("p",null,"A node connected to a peer with the ",(0,i.kt)("inlineCode",{parentName:"p"},"light-node")," field set to true MUST NOT depend on the peer for forwarding Envelopes."),(0,i.kt)("h5",{id:"confirmations-enabled-field"},"Confirmations Enabled Field"),(0,i.kt)("p",null,"When the node's ",(0,i.kt)("inlineCode",{parentName:"p"},"confirmations-enabled")," field is set to true, the node SHOULD send ",(0,i.kt)("a",{parentName:"p",href:"#batch-ack-and-message-response"},"message confirmations")," to its peers."),(0,i.kt)("h4",{id:"batch-ack-and-message-response"},"Batch Ack and Message Response"),(0,i.kt)("p",null,"Message confirmations tell a node that an envelope originating from it has been received by its peers, allowing a node to know whether an envelope has or has not been received."),(0,i.kt)("p",null,"A node MAY send a message confirmation for any batch of envelopes received with a Messages packet (",(0,i.kt)("inlineCode",{parentName:"p"},"0x01"),")."),(0,i.kt)("p",null,"A message confirmation is sent using Batch Ack packet (",(0,i.kt)("inlineCode",{parentName:"p"},"0x0B"),") or Message Response packet (",(0,i.kt)("inlineCode",{parentName:"p"},"0x0C"),"). The message confirmation is specified in the ",(0,i.kt)("a",{parentName:"p",href:"#abnf-specification"},"ABNF specification"),"."),(0,i.kt)("p",null,"The current ",(0,i.kt)("inlineCode",{parentName:"p"},"version")," in the ",(0,i.kt)("inlineCode",{parentName:"p"},"confirmation")," is ",(0,i.kt)("inlineCode",{parentName:"p"},"1"),"."),(0,i.kt)("p",null,"The supported error codes:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"1"),": time sync error which happens when an envelope is too old or was created in the future (typically because of an unsynchronized clock of a node).")),(0,i.kt)("p",null,"The drawback of sending message confirmations is that it increases the noise in the network because for each sent envelope, a corresponding confirmation is broadcast by one or more peers."),(0,i.kt)("h4",{id:"p2p-request"},"P2P Request"),(0,i.kt)("p",null,"This packet is used for sending Dapp-level peer-to-peer requests, e.g. Waku Mail Client requesting historic (expired) envelopes from the ",(0,i.kt)("a",{parentName:"p",href:"../8/mail"},"Waku Mail Server"),"."),(0,i.kt)("h4",{id:"p2p-message"},"P2P Message"),(0,i.kt)("p",null,"This packet is used for sending the peer-to-peer envelopes, which are not supposed to be forwarded any further. E.g. it might be used by the Waku Mail Server for delivery of historic (expired) envelopes, which is otherwise not allowed."),(0,i.kt)("h4",{id:"p2p-request-complete"},"P2P Request Complete"),(0,i.kt)("p",null,"This packet is used to indicate that all envelopes, requested earlier with a P2P Request packet (",(0,i.kt)("inlineCode",{parentName:"p"},"0x7E"),"), have been sent via one or more P2P Message packets (",(0,i.kt)("inlineCode",{parentName:"p"},"0x7F"),")."),(0,i.kt)("p",null,"The content of the packet is explained in the ",(0,i.kt)("a",{parentName:"p",href:"../8/mail"},"Waku Mail Server")," specification."),(0,i.kt)("h3",{id:"payload-encryption"},"Payload Encryption"),(0,i.kt)("p",null,"Asymmetric encryption uses the standard Elliptic Curve Integrated Encryption Scheme with SECP-256k1 public key."),(0,i.kt)("p",null,"Symmetric encryption uses AES GCM algorithm with random 96-bit nonce."),(0,i.kt)("h3",{id:"packet-code-rationale"},"Packet code Rationale"),(0,i.kt)("p",null,"Packet codes ",(0,i.kt)("inlineCode",{parentName:"p"},"0x00")," and ",(0,i.kt)("inlineCode",{parentName:"p"},"0x01")," are already used in all Waku / Whisper versions. Packet code ",(0,i.kt)("inlineCode",{parentName:"p"},"0x02")," and ",(0,i.kt)("inlineCode",{parentName:"p"},"0x03")," were previously used in Whisper but are deprecated as of Waku v0.4"),(0,i.kt)("p",null,"Packet code ",(0,i.kt)("inlineCode",{parentName:"p"},"0x22")," is used to dynamically change the settings of a node."),(0,i.kt)("p",null,"Packet codes ",(0,i.kt)("inlineCode",{parentName:"p"},"0x7E")," and ",(0,i.kt)("inlineCode",{parentName:"p"},"0x7F")," may be used to implement Waku Mail Server and Client. Without the P2P Message packet it would be impossible to deliver the historic envelopes, since they will be recognized as expired, and the peer will be disconnected for violating the Waku protocol. They might be useful for other purposes when it is not possible to spend time on PoW, e.g. if a stock exchange will want to provide live feed about the latest trades."),(0,i.kt)("h2",{id:"additional-capabilities"},"Additional capabilities"),(0,i.kt)("p",null,"Waku supports multiple capabilities. These include light node, rate limiting and bridging of traffic. Here we list these capabilities, how they are identified, what properties they have and what invariants they must maintain."),(0,i.kt)("p",null,"Additionally there is the capability of a mailserver which is documented in its on ",(0,i.kt)("a",{parentName:"p",href:"../8/mail"},"specification"),"."),(0,i.kt)("h3",{id:"light-node"},"Light node"),(0,i.kt)("p",null,"The rationale for light nodes is to allow for interaction with waku on resource restricted devices as bandwidth can often be an issue."),(0,i.kt)("p",null,"Light nodes MUST NOT forward any incoming envelopes, they MUST only send their own envelopes. When light nodes happen to connect to each other, they SHOULD disconnect. As this would result in envelopes being dropped between the two."),(0,i.kt)("p",null,"Light nodes are identified by the ",(0,i.kt)("inlineCode",{parentName:"p"},"light_node")," value in the Status packet."),(0,i.kt)("h3",{id:"accounting-for-resources-experimental"},"Accounting for resources (experimental)"),(0,i.kt)("p",null,"Nodes MAY implement accounting, keeping track of resource usage. It is heavily inspired by Swarm's ",(0,i.kt)("a",{parentName:"p",href:"https://www.bokconsulting.com.au/wp-content/uploads/2016/09/tron-fischer-sw3.pdf"},"SWAP protocol"),", and works by doing pairwise accounting for resources."),(0,i.kt)("p",null,"Each node keeps track of resource usage with all other nodes. Whenever an envelope is received from a node that is expected (fits bloom filter or topic interest, is legal, etc) this is tracked."),(0,i.kt)("p",null,"Every epoch (say, every minute or every time an event happens) statistics SHOULD be aggregated and saved by the client:"),(0,i.kt)("table",null,(0,i.kt)("thead",{parentName:"table"},(0,i.kt)("tr",{parentName:"thead"},(0,i.kt)("th",{parentName:"tr",align:null},"peer"),(0,i.kt)("th",{parentName:"tr",align:null},"sent"),(0,i.kt)("th",{parentName:"tr",align:null},"received"))),(0,i.kt)("tbody",{parentName:"table"},(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"peer1"),(0,i.kt)("td",{parentName:"tr",align:null},"0"),(0,i.kt)("td",{parentName:"tr",align:null},"123")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"peer2"),(0,i.kt)("td",{parentName:"tr",align:null},"10"),(0,i.kt)("td",{parentName:"tr",align:null},"40")))),(0,i.kt)("p",null,"In later versions this will be amended by nodes communication thresholds, settlements and disconnect logic."),(0,i.kt)("h2",{id:"upgradability-and-compatibility"},"Upgradability and Compatibility"),(0,i.kt)("h3",{id:"general-principles-and-policy"},"General principles and policy"),(0,i.kt)("p",null,"The currently advertised capability is ",(0,i.kt)("inlineCode",{parentName:"p"},"waku/1"),". This needs to be advertised in the ",(0,i.kt)("inlineCode",{parentName:"p"},"hello")," ",(0,i.kt)("inlineCode",{parentName:"p"},"\xd0\u039eVp2p")," ",(0,i.kt)("a",{parentName:"p",href:"https://ethereum.gitbooks.io/frontier-guide/devp2p.html"},"packet"),".\nIf a node supports multiple versions of ",(0,i.kt)("inlineCode",{parentName:"p"},"waku"),", those needs to be explicitly advertised. For example if both ",(0,i.kt)("inlineCode",{parentName:"p"},"waku/0")," and ",(0,i.kt)("inlineCode",{parentName:"p"},"waku/1")," are supported, both ",(0,i.kt)("inlineCode",{parentName:"p"},"waku/0")," and ",(0,i.kt)("inlineCode",{parentName:"p"},"waku/1")," MUST be advertised."),(0,i.kt)("p",null,"These are policies that guide how we make decisions when it comes to upgradability, compatibility, and extensibility:"),(0,i.kt)("ol",null,(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},"Waku aims to be compatible with previous and future versions.")),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},"In cases where we want to break this compatibility, we do so gracefully and as a single decision point.")),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},"To achieve this, we employ the following two general strategies:"))),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"a) Accretion (including protocol negotiation) over changing data"),(0,i.kt)("li",{parentName:"ul"},"b) When we want to change things, we give it a new name (for example, a version number).")),(0,i.kt)("p",null,"Examples:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"We enable bridging between ",(0,i.kt)("inlineCode",{parentName:"li"},"shh/6")," and ",(0,i.kt)("inlineCode",{parentName:"li"},"waku/1")," until such a time as when we are ready to gracefully drop support for ",(0,i.kt)("inlineCode",{parentName:"li"},"shh/6")," (1, 2, 3)."),(0,i.kt)("li",{parentName:"ul"},"When we add parameter fields, we (currently) do so by accreting them in a list, so old clients can ignore new fields (dynamic list) and new clients can use new capabilities (1, 3)."),(0,i.kt)("li",{parentName:"ul"},"To better support (2) and (3) in the future, we will likely release a new version that gives better support for open, growable maps (association lists or native map type) (3)"),(0,i.kt)("li",{parentName:"ul"},"When we we want to provide a new set of packets that have different requirements, we do so under a new protocol version and employ protocol versioning. This is a form of accretion at a level above - it ensures a client can support both protocols at once and drop support for legacy versions gracefully. (1,2,3)")),(0,i.kt)("h3",{id:"backwards-compatibility"},"Backwards Compatibility"),(0,i.kt)("p",null,"Waku is a different subprotocol from Whisper so it isn't directly compatible. However, the data format is the same, so compatibility can be achieved by the use of a bridging mode as described below. Any client which does not implement certain packet codes should gracefully ignore the packets with those codes. This will ensure the forward compatibility."),(0,i.kt)("h3",{id:"waku-whisper-bridging"},"Waku-Whisper bridging"),(0,i.kt)("p",null,(0,i.kt)("inlineCode",{parentName:"p"},"waku/1")," and ",(0,i.kt)("inlineCode",{parentName:"p"},"shh/6")," are different DevP2P subprotocols, however they share the same data format making their envelopes compatible. This means we can bridge the protocols naively, this works as follows."),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"Roles:")),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"Waku client A, only Waku capability"),(0,i.kt)("li",{parentName:"ul"},"Whisper client B, only Whisper capability"),(0,i.kt)("li",{parentName:"ul"},"WakuWhisper bridge C, both Waku and Whisper capability")),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"Flow:")),(0,i.kt)("ol",null,(0,i.kt)("li",{parentName:"ol"},"A posts envelope; B posts envelope."),(0,i.kt)("li",{parentName:"ol"},"C picks up envelope from A and B and relays them both to Waku and Whisper."),(0,i.kt)("li",{parentName:"ol"},"A receives envelope on Waku; B on Whisper.")),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"Note"),": This flow means if another bridge C1 is active, we might get duplicate relaying for a envelope between C1 and C2. I.e. Whisper(\\<",">","Waku\\<",">","Whisper)\\<",">","Waku, A-C1-C2-B. Theoretically this bridging chain can get as long as TTL permits."),(0,i.kt)("h3",{id:"forward-compatibility"},"Forward Compatibility"),(0,i.kt)("p",null,"It is desirable to have a strategy for maintaining forward compatibility between ",(0,i.kt)("inlineCode",{parentName:"p"},"waku/1")," and future version of waku. Here we outline some concerns and strategy for this."),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("strong",{parentName:"li"},"Connecting to nodes with multiple versions:")," The way this SHOULD be accomplished is by negotiating the versions of subprotocols, within the ",(0,i.kt)("inlineCode",{parentName:"li"},"hello")," packet nodes transmit their capabilities along with a version. The highest common version should then be used."),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("strong",{parentName:"li"},"Adding new packet codes:")," New packet codes can be added easily due to the available packet codes. Unknown packet codes SHOULD be ignored. Upgrades that add new packet codes SHOULD implement some fallback mechanism if no response was received for nodes that do not yet understand this packet."),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("strong",{parentName:"li"},"Adding new options in ",(0,i.kt)("inlineCode",{parentName:"strong"},"status-options"),":")," New options can be added to the ",(0,i.kt)("inlineCode",{parentName:"li"},"status-options")," association list in the ",(0,i.kt)("inlineCode",{parentName:"li"},"status")," and ",(0,i.kt)("inlineCode",{parentName:"li"},"status-update")," packet as options are OPTIONAL and unknown option keys SHOULD be ignored. A node SHOULD NOT disconnect from a peer when receiving ",(0,i.kt)("inlineCode",{parentName:"li"},"status-options")," with unknown option keys.")),(0,i.kt)("h2",{id:"appendix-a-security-considerations"},"Appendix A: Security considerations"),(0,i.kt)("p",null,"There are several security considerations to take into account when running Waku. Chief among them are: scalability, DDoS-resistance and privacy. These also vary depending on what capabilities are used. The security considerations for extra capabilities such as ",(0,i.kt)("a",{parentName:"p",href:"../8/mail##security-considerations"},"mailservers")," can be found in their respective specifications."),(0,i.kt)("h3",{id:"scalability-and-ux"},"Scalability and UX"),(0,i.kt)("h4",{id:"bandwidth-usage"},"Bandwidth usage:"),(0,i.kt)("p",null,"In version 0 of Waku, bandwidth usage is likely to be an issue. For more investigation into this, see the theoretical scaling model described ",(0,i.kt)("a",{parentName:"p",href:"https://github.com/vacp2p/research/tree/dcc71f4779be832d3b5ece9c4e11f1f7ec24aac2/whisper_scalability"},"here"),"."),(0,i.kt)("h4",{id:"gossip-based-routing-1"},"Gossip-based routing:"),(0,i.kt)("p",null,"Use of gossip-based routing doesn't necessarily scale. It means each node can see an envelope multiple times, and having too many light nodes can cause propagation probability that is too low. See ",(0,i.kt)("a",{parentName:"p",href:"https://our.status.im/whisper-pss-comparison/"},"Whisper vs PSS")," for more and a possible Kademlia based alternative."),(0,i.kt)("h4",{id:"lack-of-incentives"},"Lack of incentives:"),(0,i.kt)("p",null,"Waku currently lacks incentives to run nodes, which means node operators are more likely to create centralized choke points."),(0,i.kt)("h3",{id:"privacy"},"Privacy"),(0,i.kt)("h4",{id:"light-node-privacy"},"Light node privacy:"),(0,i.kt)("p",null,"The main privacy concern with a light node is that it has to reveal its topic interests (in addition to its IP/ID) to its directed peers. This is because when a light node publishes an envelope, its directed peers will know that the light node owns that envelope (as light nodes do not relay other envelopes). Therefore, the directed peers of a light node can make assumptions about what envelopes (topics) the light node is interested in."),(0,i.kt)("h4",{id:"mailserver-client-privacy"},"Mailserver client privacy:"),(0,i.kt)("p",null,"A mailserver client fetches archival envelopes from a mailserver through a direct connection.\nIn this direct connection, the client discloses its IP/ID as well as the topics/ bloom filter it is interested in to the mailserver.\nThe collection of such information allows the mailserver to link clients' IP/IDs to their topic interests and build a profile for each client over time.\nAs such, the mailserver client has to trust the mailserver with this level of information. "),(0,i.kt)("h4",{id:"bloom-filter-privacy"},"Bloom filter privacy:"),(0,i.kt)("p",null,"By having a bloom filter where only the topics you are interested in are set, you reveal which envelopes you are interested in. This is a fundamental tradeoff between bandwidth usage and privacy, though the tradeoff space is likely suboptimal in terms of the ",(0,i.kt)("a",{parentName:"p",href:"https://eprint.iacr.org/2017/954.pdf"},"Anonymity")," ",(0,i.kt)("a",{parentName:"p",href:"https://petsymposium.org/2019/files/hotpets/slides/coordination-helps-anonymity-slides.pdf"},"trilemma"),"."),(0,i.kt)("h4",{id:"privacy-guarantees-not-rigorous"},"Privacy guarantees not rigorous:"),(0,i.kt)("p",null,"Privacy for Whisper / Waku haven't been studied rigorously for various threat models like global passive adversary, local active attacker, etc. This is unlike e.g. Tor and mixnets."),(0,i.kt)("h4",{id:"topic-hygiene"},"Topic hygiene:"),(0,i.kt)("p",null,"Similar to bloom filter privacy, if you use a very specific topic you reveal more information. See scalability model linked above."),(0,i.kt)("h3",{id:"spam-resistance"},"Spam resistance"),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"PoW bad for heterogeneous devices:")),(0,i.kt)("p",null,"Proof of work is a poor spam prevention mechanism. A mobile device can only have a very low PoW in order not to use too much CPU / burn up its phone battery. This means someone can spin up a powerful node and overwhelm the network."),(0,i.kt)("h3",{id:"censorship-resistance"},"Censorship resistance"),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"Devp2p TCP port blockable:")),(0,i.kt)("p",null,"By default Devp2p runs on port ",(0,i.kt)("inlineCode",{parentName:"p"},"30303"),", which is not commonly used for any other service. This means it is easy to censor, e.g. airport WiFi. This can be mitigated somewhat by running on e.g. port ",(0,i.kt)("inlineCode",{parentName:"p"},"80")," or ",(0,i.kt)("inlineCode",{parentName:"p"},"443"),", but there are still outstanding issues. See libp2p and Tor's Pluggable Transport for how this can be improved."),(0,i.kt)("h2",{id:"appendix-b-implementation-notes"},"Appendix B: Implementation Notes"),(0,i.kt)("h3",{id:"implementation-matrix"},"Implementation Matrix"),(0,i.kt)("table",null,(0,i.kt)("thead",{parentName:"table"},(0,i.kt)("tr",{parentName:"thead"},(0,i.kt)("th",{parentName:"tr",align:null},"Client"),(0,i.kt)("th",{parentName:"tr",align:null},"Spec supported"),(0,i.kt)("th",{parentName:"tr",align:null},"Details"))),(0,i.kt)("tbody",{parentName:"table"},(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("strong",{parentName:"td"},"Status-go")),(0,i.kt)("td",{parentName:"tr",align:null},"0.5"),(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("a",{parentName:"td",href:"https://github.com/status-im/status-go/blob/develop/WAKU"},"details"))),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("strong",{parentName:"td"},"Nim-waku")),(0,i.kt)("td",{parentName:"tr",align:null},"1.0"),(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("a",{parentName:"td",href:"https://github.com/status-im/nim-waku/blob/master/README"},"details"))))),(0,i.kt)("h3",{id:"recommendations-for-clients"},"Recommendations for clients"),(0,i.kt)("p",null,"Notes useful for implementing Waku mode."),(0,i.kt)("ol",null,(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},"Avoid duplicate envelopes"),(0,i.kt)("p",{parentName:"li"},"To avoid duplicate envelopes, only connect to one Waku node. Benign duplicate envelopes is an intrinsic property of Whisper which often leads to a N factor increase in traffic, where N is the number of peers you are connected to.")),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},"Topic specific recommendations"),(0,i.kt)("p",{parentName:"li"},"Consider partition topics based on some usage, to avoid too much traffic on a single topic."))),(0,i.kt)("h3",{id:"node-discovery"},"Node discovery"),(0,i.kt)("p",null,"Resource restricted devices SHOULD use ",(0,i.kt)("a",{parentName:"p",href:"https://eips.ethereum.org/EIPS/eip-1459"},"EIP-1459")," to discover nodes."),(0,i.kt)("p",null,"Known static nodes MAY also be used."),(0,i.kt)("h2",{id:"changelog"},"Changelog"),(0,i.kt)("h3",{id:"initial-release"},(0,i.kt)("a",{parentName:"h3",href:"https://github.com/vacp2p/specs/commit/bc7e75ebb2e45d2cbf6ab27352c113e666df37c8"},"Initial Release")),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"Add section on P2P Request Complete packet and update packet code table."),(0,i.kt)("li",{parentName:"ul"},"Correct the header hierarchy for the status-options fields."),(0,i.kt)("li",{parentName:"ul"},"Consistent use of the words packet, message and envelope."),(0,i.kt)("li",{parentName:"ul"},"Added section on max packet size"),(0,i.kt)("li",{parentName:"ul"},"Complete the ABNF specification and minor ABNF fixes.")),(0,i.kt)("h3",{id:"version-11"},"Version 1.1"),(0,i.kt)("p",null,"Released ",(0,i.kt)("a",{parentName:"p",href:"https://github.com/vacp2p/specs/commit/33b8d7304c9ebece90ea94e601f11080a8ac2c4d"},"June 09, 2020")),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"Add rate limit per bytes")),(0,i.kt)("h3",{id:"version-10"},"Version 1.0"),(0,i.kt)("p",null,"Released ",(0,i.kt)("a",{parentName:"p",href:"https://github.com/vacp2p/specs/commit/9e650995f24179844857520c68fa3e8f6018b125"},"April 21,2020")),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"Removed ",(0,i.kt)("inlineCode",{parentName:"li"},"version")," from handshake"),(0,i.kt)("li",{parentName:"ul"},"Changed ",(0,i.kt)("inlineCode",{parentName:"li"},"RLP")," keys from 48,49.. to 0,1.."),(0,i.kt)("li",{parentName:"ul"},"Upgraded to ",(0,i.kt)("inlineCode",{parentName:"li"},"waku/1"))),(0,i.kt)("h3",{id:"version-06"},"Version 0.6"),(0,i.kt)("p",null,"Released ",(0,i.kt)("a",{parentName:"p",href:"https://github.com/vacp2p/specs/commit/9e650995f24179844857520c68fa3e8f6018b125"},"April 21,2020")),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"Mark spec as Deprecated mode in terms of its lifecycle.")),(0,i.kt)("h3",{id:"version-05"},"Version 0.5"),(0,i.kt)("p",null,"Released ",(0,i.kt)("a",{parentName:"p",href:"https://github.com/vacp2p/specs/commit/7b9dc562bc50c6bb844ac575cb221ec9cda2530a"},"March 17,2020")),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"Clarify the preferred way of handling unknown keys in the ",(0,i.kt)("inlineCode",{parentName:"li"},"status-options")," association list."),(0,i.kt)("li",{parentName:"ul"},"Correct spec/implementation mismatch: Change RLP keys to be the their int values in order to reflect production behavior")),(0,i.kt)("h3",{id:"version-04"},"Version 0.4"),(0,i.kt)("p",null,"Released ",(0,i.kt)("a",{parentName:"p",href:"https://github.com/vacp2p/specs/commit/17bd066e317bbe33af07146b721d73f24de47e88"},"February 21, 2020"),"."),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"Simplify implementation matrix with latest state"),(0,i.kt)("li",{parentName:"ul"},"Introduces a new required packet code Status Code (",(0,i.kt)("inlineCode",{parentName:"li"},"0x22"),") for communicating option changes"),(0,i.kt)("li",{parentName:"ul"},"Deprecates the following packet codes: PoW Requirement (",(0,i.kt)("inlineCode",{parentName:"li"},"0x02"),"), Bloom Filter (",(0,i.kt)("inlineCode",{parentName:"li"},"0x03"),"), Rate limits (",(0,i.kt)("inlineCode",{parentName:"li"},"0x20"),"), Topic interest (",(0,i.kt)("inlineCode",{parentName:"li"},"0x21"),") - all superseded by the new Status Code (",(0,i.kt)("inlineCode",{parentName:"li"},"0x22"),")"),(0,i.kt)("li",{parentName:"ul"},"Increased ",(0,i.kt)("inlineCode",{parentName:"li"},"topic-interest")," capacity from 1000 to 10000")),(0,i.kt)("h3",{id:"version-03"},"Version 0.3"),(0,i.kt)("p",null,"Released ",(0,i.kt)("a",{parentName:"p",href:"https://github.com/vacp2p/specs/commit/73138d6ba954ab4c315e1b8d210ac7631b6d1428"},"February 13, 2020"),"."),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"Recommend DNS based node discovery over other Discovery methods."),(0,i.kt)("li",{parentName:"ul"},"Mark spec as Draft mode in terms of its lifecycle."),(0,i.kt)("li",{parentName:"ul"},"Simplify Changelog and misc formatting."),(0,i.kt)("li",{parentName:"ul"},"Handshake/Status packet not compatible with shh/6 nodes; specifying options as association list."),(0,i.kt)("li",{parentName:"ul"},"Include topic-interest in Status handshake."),(0,i.kt)("li",{parentName:"ul"},"Upgradability policy."),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"topic-interest")," packet code.")),(0,i.kt)("h3",{id:"version-02"},"Version 0.2"),(0,i.kt)("p",null,"Released ",(0,i.kt)("a",{parentName:"p",href:"https://github.com/vacp2p/specs/blob/waku-0.2.0/waku"},"December 10, 2019"),"."),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"General style improvements."),(0,i.kt)("li",{parentName:"ul"},"Fix ABNF grammar."),(0,i.kt)("li",{parentName:"ul"},"Mailserver requesting/receiving."),(0,i.kt)("li",{parentName:"ul"},"New packet codes: topic-interest (experimental), rate limits (experimental)."),(0,i.kt)("li",{parentName:"ul"},"More details on handshake modifications."),(0,i.kt)("li",{parentName:"ul"},"Accounting for resources mode (experimental)"),(0,i.kt)("li",{parentName:"ul"},"Appendix with security considerations: scalability and UX, privacy, and spam resistance."),(0,i.kt)("li",{parentName:"ul"},"Appendix with implementation notes and implementation matrix across various clients with breakdown per capability."),(0,i.kt)("li",{parentName:"ul"},"More details on handshake and parameters."),(0,i.kt)("li",{parentName:"ul"},"Describe rate limits in more detail."),(0,i.kt)("li",{parentName:"ul"},"More details on mailserver and mail client API."),(0,i.kt)("li",{parentName:"ul"},"Accounting for resources mode (very experimental)."),(0,i.kt)("li",{parentName:"ul"},"Clarify differences with Whisper.")),(0,i.kt)("h3",{id:"version-01"},"Version 0.1"),(0,i.kt)("p",null,"Initial version. Released ",(0,i.kt)("a",{parentName:"p",href:"https://github.com/vacp2p/specs/blob/b59b9247f2ac1bf45c75bd3227a2e5dd87b6d7b0/waku"},"November 21, 2019"),"."),(0,i.kt)("h3",{id:"differences-between-shh6-and-waku1"},"Differences between shh/6 and waku/1"),(0,i.kt)("p",null,"Summary of main differences between this spec and Whisper v6, as described in ",(0,i.kt)("a",{parentName:"p",href:"https://eips.ethereum.org/EIPS/eip-627"},"EIP-627"),":"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"RLPx subprotocol is changed from ",(0,i.kt)("inlineCode",{parentName:"li"},"shh/6")," to ",(0,i.kt)("inlineCode",{parentName:"li"},"waku/1"),"."),(0,i.kt)("li",{parentName:"ul"},"Light node capability is added."),(0,i.kt)("li",{parentName:"ul"},"Optional rate limiting is added."),(0,i.kt)("li",{parentName:"ul"},"Status packet has following additional parameters: light-node,\nconfirmations-enabled and rate-limits"),(0,i.kt)("li",{parentName:"ul"},"Mail Server and Mail Client functionality is now part of the specification."),(0,i.kt)("li",{parentName:"ul"},"P2P Message packet contains a list of envelopes instead of a single envelope.")),(0,i.kt)("h2",{id:"copyright"},"Copyright"),(0,i.kt)("p",null,"Copyright and related rights waived via ",(0,i.kt)("a",{parentName:"p",href:"https://creativecommons.org/publicdomain/zero/1.0/"},"CC0"),"."),(0,i.kt)("h2",{id:"footnotes"},"Footnotes"),(0,i.kt)("div",{className:"footnotes"},(0,i.kt)("hr",{parentName:"div"}),(0,i.kt)("ol",{parentName:"div"},(0,i.kt)("li",{parentName:"ol",id:"fn-1"},"Felix Lange et al. ",(0,i.kt)("a",{parentName:"li",href:"https://github.com/ethereum/devp2p/blob/master/rlpx"},"The RLPx Transport Protocol"),". Ethereum.",(0,i.kt)("a",{parentName:"li",href:"#fnref-1",className:"footnote-backref"},"\u21a9")))))}c.isMDXComponent=!0},3905:(e,t,a)=>{a.d(t,{Zo:()=>d,kt:()=>u});var n=a(67294);function i(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function o(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function r(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?o(Object(a),!0).forEach((function(t){i(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):o(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function l(e,t){if(null==e)return{};var a,n,i=function(e,t){if(null==e)return{};var a,n,i={},o=Object.keys(e);for(n=0;n<o.length;n++)a=o[n],t.indexOf(a)>=0||(i[a]=e[a]);return i}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(n=0;n<o.length;n++)a=o[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(i[a]=e[a])}return i}var s=n.createContext({}),p=function(e){var t=n.useContext(s),a=t;return e&&(a="function"==typeof e?e(t):r(r({},t),e)),a},d=function(e){var t=p(e.components);return n.createElement(s.Provider,{value:t},e.children)},c={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},m=n.forwardRef((function(e,t){var a=e.components,i=e.mdxType,o=e.originalType,s=e.parentName,d=l(e,["components","mdxType","originalType","parentName"]),m=p(a),u=i,h=m["".concat(s,".").concat(u)]||m[u]||c[u]||o;return a?n.createElement(h,r(r({ref:t},d),{},{components:a})):n.createElement(h,r({ref:t},d))}));function u(e,t){var a=arguments,i=t&&t.mdxType;if("string"==typeof e||i){var o=a.length,r=new Array(o);r[0]=m;var l={};for(var s in t)hasOwnProperty.call(t,s)&&(l[s]=t[s]);l.originalType=e,l.mdxType="string"==typeof e?e:i,r[1]=l;for(var p=2;p<o;p++)r[p]=a[p];return n.createElement.apply(null,r)}return n.createElement.apply(null,a)}m.displayName="MDXCreateElement"}}]);