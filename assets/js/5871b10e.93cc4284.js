"use strict";(self.webpackChunklogos_docs_template=self.webpackChunklogos_docs_template||[]).push([[4667],{83561:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>s,contentTitle:()=>o,default:()=>m,frontMatter:()=>i,metadata:()=>l,toc:()=>p});var a=n(87462),r=(n(67294),n(3905));const i={title:"2/MVDS",name:"Minimum Viable Data Synchronization",status:"stable",editor:"Sanaz Taheri &lt;sanaz@status.im&gt;",contributors:["Dean Eigenmann &lt;dean@status.im&gt;","Oskar Thor\xe9n &lt;oskarth@titanproxy.com&gt;"]},o=void 0,l={unversionedId:"2/mvds",id:"2/mvds",title:"2/MVDS",description:"- Status: stable",source:"@site/vac/2/mvds.md",sourceDirName:"2",slug:"/2/mvds",permalink:"/vac/2/mvds",draft:!1,tags:[],version:"current",frontMatter:{title:"2/MVDS",name:"Minimum Viable Data Synchronization",status:"stable",editor:"Sanaz Taheri &lt;sanaz@status.im&gt;",contributors:["Dean Eigenmann &lt;dean@status.im&gt;","Oskar Thor\xe9n &lt;oskarth@titanproxy.com&gt;"]},sidebar:"defaultSidebar",previous:{title:"1/COSS",permalink:"/vac/1/coss"},next:{title:"3/REMOTE-LOG",permalink:"/vac/3/remote-log"}},s={},p=[{value:"Definitions",id:"definitions",level:2},{value:"Wire Protocol",id:"wire-protocol",level:2},{value:"Secure Transport",id:"secure-transport",level:3},{value:"Payloads",id:"payloads",level:3},{value:"Synchronization",id:"synchronization",level:2},{value:"State",id:"state",level:3},{value:"Flow",id:"flow",level:3},{value:"Interactive Mode",id:"interactive-mode",level:4},{value:"Batch Mode",id:"batch-mode",level:4},{value:"Retransmission",id:"retransmission",level:3},{value:"Formal Specification",id:"formal-specification",level:2},{value:"Acknowledgments",id:"acknowledgments",level:2},{value:"Copyright",id:"copyright",level:2},{value:"Footnotes",id:"footnotes",level:2}],d={toc:p};function m(e){let{components:t,...i}=e;return(0,r.kt)("wrapper",(0,a.Z)({},d,i,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Status: stable"),(0,r.kt)("li",{parentName:"ul"},"Editor: Sanaz Taheri ","<",(0,r.kt)("a",{parentName:"li",href:"mailto:sanaz@status.im"},"sanaz@status.im"),">"),(0,r.kt)("li",{parentName:"ul"},"Contributors:",(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"Dean Eigenmann ","<",(0,r.kt)("a",{parentName:"li",href:"mailto:dean@status.im"},"dean@status.im"),">"),(0,r.kt)("li",{parentName:"ul"},"Oskar Thor\xe9n ","<",(0,r.kt)("a",{parentName:"li",href:"mailto:oskarth@titanproxy.com"},"oskarth@titanproxy.com"),">")))),(0,r.kt)("p",null,"In this specification, we describe a minimum viable protocol for\ndata synchronization inspired by the Bramble Synchronization Protocol",(0,r.kt)("sup",{parentName:"p",id:"fnref-1"},(0,r.kt)("a",{parentName:"sup",href:"#fn-1",className:"footnote-ref"},"1")),".\nThis protocol is designed to ensure reliable messaging\nbetween peers across an unreliable peer-to-peer (P2P) network where\nthey may be unreachable or unresponsive."),(0,r.kt)("p",null,"We present a reference implementation",(0,r.kt)("sup",{parentName:"p",id:"fnref-2"},(0,r.kt)("a",{parentName:"sup",href:"#fn-2",className:"footnote-ref"},"2")),"\nincluding a simulation to demonstrate its performance."),(0,r.kt)("h2",{id:"definitions"},"Definitions"),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:null},"Term"),(0,r.kt)("th",{parentName:"tr",align:null},"Description"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("strong",{parentName:"td"},"Peer")),(0,r.kt)("td",{parentName:"tr",align:null},"The other nodes that a node is connected to.")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("strong",{parentName:"td"},"Record")),(0,r.kt)("td",{parentName:"tr",align:null},"Defines a payload element of either the type ",(0,r.kt)("inlineCode",{parentName:"td"},"OFFER"),", ",(0,r.kt)("inlineCode",{parentName:"td"},"REQUEST"),", ",(0,r.kt)("inlineCode",{parentName:"td"},"MESSAGE")," or ",(0,r.kt)("inlineCode",{parentName:"td"},"ACK"))),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("strong",{parentName:"td"},"Node")),(0,r.kt)("td",{parentName:"tr",align:null},"Some process that is able to store data, do processing and communicate for MVDS.")))),(0,r.kt)("h2",{id:"wire-protocol"},"Wire Protocol"),(0,r.kt)("h3",{id:"secure-transport"},"Secure Transport"),(0,r.kt)("p",null,"This specification does not define anything related to the transport of packets.\nIt is assumed that this is abstracted in such a way that\nany secure transport protocol could be easily implemented.\nLikewise, properties such as confidentiality, integrity, authenticity and\nforward secrecy are assumed to be provided by a layer below."),(0,r.kt)("h3",{id:"payloads"},"Payloads"),(0,r.kt)("p",null,"Payloads are implemented using ",(0,r.kt)("a",{parentName:"p",href:"https://developers.google.com/protocol-buffers/"},"protocol buffers v3"),"."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-protobuf"},'syntax = "proto3";\n\npackage vac.mvds;\n\nmessage Payload {\n  repeated bytes acks = 5001;\n  repeated bytes offers = 5002;\n  repeated bytes requests = 5003;\n  repeated Message messages = 5004;\n}\n\nmessage Message {\n  bytes group_id = 6001;\n  int64 timestamp = 6002;\n  bytes body = 6003;\n}\n')),(0,r.kt)("p",null,(0,r.kt)("em",{parentName:"p"},'The payload field numbers are kept more "unique" to'),"\n",(0,r.kt)("em",{parentName:"p"},"ensure no overlap with other protocol buffers.")),(0,r.kt)("p",null,"Each payload contains the following fields:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"Acks:")," This field contains a list (can be empty)\nof ",(0,r.kt)("inlineCode",{parentName:"li"},"message identifiers")," informing the recipient that sender holds a specific message."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"Offers:")," This field contains a list (can be empty)\nof ",(0,r.kt)("inlineCode",{parentName:"li"},"message identifiers")," that the sender would like to give to the recipient."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"Requests:")," This field contains a list (can be empty)\nof ",(0,r.kt)("inlineCode",{parentName:"li"},"message identifiers")," that the sender would like to receive from the recipient."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"Messages:")," This field contains a list of messages (can be empty).")),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Message Identifiers:")," Each ",(0,r.kt)("inlineCode",{parentName:"p"},"message")," has a message identifier calculated by\nhashing the ",(0,r.kt)("inlineCode",{parentName:"p"},"group_id"),", ",(0,r.kt)("inlineCode",{parentName:"p"},"timestamp")," and ",(0,r.kt)("inlineCode",{parentName:"p"},"body")," fields as follows:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},'HASH("MESSAGE_ID", group_id, timestamp, body);\n')),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Group Identifiers:")," Each ",(0,r.kt)("inlineCode",{parentName:"p"},"message")," is assigned into a ",(0,r.kt)("strong",{parentName:"p"},"group"),"\nusing the ",(0,r.kt)("inlineCode",{parentName:"p"},"group_id")," field,\ngroups are independent synchronization contexts between peers."),(0,r.kt)("p",null,"The current ",(0,r.kt)("inlineCode",{parentName:"p"},"HASH")," function used is ",(0,r.kt)("inlineCode",{parentName:"p"},"sha256"),"."),(0,r.kt)("h2",{id:"synchronization"},"Synchronization"),(0,r.kt)("h3",{id:"state"},"State"),(0,r.kt)("p",null,"We refer to ",(0,r.kt)("inlineCode",{parentName:"p"},"state")," as set of records for the types ",(0,r.kt)("inlineCode",{parentName:"p"},"OFFER"),", ",(0,r.kt)("inlineCode",{parentName:"p"},"REQUEST")," and\n",(0,r.kt)("inlineCode",{parentName:"p"},"MESSAGE")," that every node SHOULD store per peer.\n",(0,r.kt)("inlineCode",{parentName:"p"},"state")," MUST NOT contain ",(0,r.kt)("inlineCode",{parentName:"p"},"ACK")," records as we do not retransmit those periodically.\nThe following information is stored for records:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"Type")," - Either ",(0,r.kt)("inlineCode",{parentName:"li"},"OFFER"),", ",(0,r.kt)("inlineCode",{parentName:"li"},"REQUEST")," or ",(0,r.kt)("inlineCode",{parentName:"li"},"MESSAGE")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"Send Count")," - The amount of times a record has been sent to a peer."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"Send Epoch")," - The next epoch at which a record can be sent to a peer.")),(0,r.kt)("h3",{id:"flow"},"Flow"),(0,r.kt)("p",null,"A maximum of one payload SHOULD be sent to peers per epoch,\nthis payload contains all ",(0,r.kt)("inlineCode",{parentName:"p"},"ACK"),", ",(0,r.kt)("inlineCode",{parentName:"p"},"OFFER"),", ",(0,r.kt)("inlineCode",{parentName:"p"},"REQUEST")," and\n",(0,r.kt)("inlineCode",{parentName:"p"},"MESSAGE")," records for the specific peer.\nPayloads are created every epoch,\ncontaining reactions to previously received records by peers or\nnew records being sent out by nodes."),(0,r.kt)("p",null,"Nodes MAY have two modes with which they can send records:\n",(0,r.kt)("inlineCode",{parentName:"p"},"BATCH")," and ",(0,r.kt)("inlineCode",{parentName:"p"},"INTERACTIVE")," mode.\nThe following rules dictate how nodes construct payloads\nevery epoch for any given peer for both modes."),(0,r.kt)("p",null,">"," ",(0,r.kt)("strong",{parentName:"p"},"*NOTE:")," A node may send messages both in interactive and in batch mode.*"),(0,r.kt)("h4",{id:"interactive-mode"},"Interactive Mode"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"A node initially offers a ",(0,r.kt)("inlineCode",{parentName:"li"},"MESSAGE")," when attempting to send it to a peer.\nThis means an ",(0,r.kt)("inlineCode",{parentName:"li"},"OFFER")," is added to the next payload and state for the given peer."),(0,r.kt)("li",{parentName:"ul"},"When a node receives an ",(0,r.kt)("inlineCode",{parentName:"li"},"OFFER"),", a ",(0,r.kt)("inlineCode",{parentName:"li"},"REQUEST")," is added to the next payload and\nstate for the given peer."),(0,r.kt)("li",{parentName:"ul"},"When a node receives a ",(0,r.kt)("inlineCode",{parentName:"li"},"REQUEST")," for a previously sent ",(0,r.kt)("inlineCode",{parentName:"li"},"OFFER"),",\nthe ",(0,r.kt)("inlineCode",{parentName:"li"},"OFFER")," is removed from the state and\nthe corresponding ",(0,r.kt)("inlineCode",{parentName:"li"},"MESSAGE")," is added to the next payload and\nstate for the given peer."),(0,r.kt)("li",{parentName:"ul"},"When a node receives a ",(0,r.kt)("inlineCode",{parentName:"li"},"MESSAGE"),", the ",(0,r.kt)("inlineCode",{parentName:"li"},"REQUEST")," is removed from the state and\nan ",(0,r.kt)("inlineCode",{parentName:"li"},"ACK")," is added to the next payload for the given peer."),(0,r.kt)("li",{parentName:"ul"},"When a node receives an ",(0,r.kt)("inlineCode",{parentName:"li"},"ACK"),",\nthe ",(0,r.kt)("inlineCode",{parentName:"li"},"MESSAGE")," is removed from the state for the given peer."),(0,r.kt)("li",{parentName:"ul"},"All records that require retransmission are added to the payload,\ngiven ",(0,r.kt)("inlineCode",{parentName:"li"},"Send Epoch")," has been reached.")),(0,r.kt)("p",null,(0,r.kt)("img",{alt:"notification",src:n(48712).Z,width:"656",height:"436"})),(0,r.kt)("p",null,"Figure 1: Delivery without retransmissions in interactive mode."),(0,r.kt)("h4",{id:"batch-mode"},"Batch Mode"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"When a node sends a ",(0,r.kt)("inlineCode",{parentName:"li"},"MESSAGE"),",\nit is added to the next payload and the state for the given peer."),(0,r.kt)("li",{parentName:"ol"},"When a node receives a ",(0,r.kt)("inlineCode",{parentName:"li"},"MESSAGE"),",\nan ",(0,r.kt)("inlineCode",{parentName:"li"},"ACK")," is added to the next payload for the corresponding peer."),(0,r.kt)("li",{parentName:"ol"},"When a node receives an ",(0,r.kt)("inlineCode",{parentName:"li"},"ACK"),",\nthe ",(0,r.kt)("inlineCode",{parentName:"li"},"MESSAGE")," is removed from the state for the given peer."),(0,r.kt)("li",{parentName:"ol"},"All records that require retransmission are added to the payload,\ngiven ",(0,r.kt)("inlineCode",{parentName:"li"},"Send Epoch")," has been reached.")),(0,r.kt)("p",null,(0,r.kt)("img",{alt:"notification",src:n(17987).Z,width:"656",height:"278"})),(0,r.kt)("p",null,"Figure 2: Delivery without retransmissions in batch mode."),(0,r.kt)("p",null,">"," ",(0,r.kt)("strong",{parentName:"p"},"*NOTE:")," Batch mode is higher bandwidth whereas interactive mode is higher latency.*"),(0,r.kt)("h3",{id:"retransmission"},"Retransmission"),(0,r.kt)("p",null,"The record of the type ",(0,r.kt)("inlineCode",{parentName:"p"},"Type")," SHOULD be retransmitted\nevery time ",(0,r.kt)("inlineCode",{parentName:"p"},"Send Epoch")," is smaller than or equal to the current epoch."),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"Send Epoch")," and ",(0,r.kt)("inlineCode",{parentName:"p"},"Send Count")," MUST be increased every time a record is retransmitted.\nAlthough no function is defined on how to increase ",(0,r.kt)("inlineCode",{parentName:"p"},"Send Epoch"),",\nit SHOULD be exponentially increased until reaching an upper bound\nwhere it then goes back to a lower epoch in order to\nprevent a record's ",(0,r.kt)("inlineCode",{parentName:"p"},"Send Epoch"),"'s from becoming too large."),(0,r.kt)("p",null,">"," ",(0,r.kt)("strong",{parentName:"p"},"*NOTE:")," We do not retransmission ",(0,r.kt)("inlineCode",{parentName:"p"},"ACK"),"s as we do not know when they have arrived,\ntherefore we simply resend them every time we receive a ",(0,r.kt)("inlineCode",{parentName:"p"},"MESSAGE"),".*"),(0,r.kt)("h2",{id:"formal-specification"},"Formal Specification"),(0,r.kt)("p",null,"MVDS has been formally specified using TLA+: ","<",(0,r.kt)("a",{parentName:"p",href:"https://github.com/vacp2p/formalities/tree/master/MVDS"},"https://github.com/vacp2p/formalities/tree/master/MVDS"),">","."),(0,r.kt)("h2",{id:"acknowledgments"},"Acknowledgments"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Preston van Loon"),(0,r.kt)("li",{parentName:"ul"},"Greg Markou"),(0,r.kt)("li",{parentName:"ul"},"Rene Nayman"),(0,r.kt)("li",{parentName:"ul"},"Jacek Sieka")),(0,r.kt)("h2",{id:"copyright"},"Copyright"),(0,r.kt)("p",null,"Copyright and related rights waived via ",(0,r.kt)("a",{parentName:"p",href:"https://creativecommons.org/publicdomain/zero/1.0/"},"CC0"),"."),(0,r.kt)("h2",{id:"footnotes"},"Footnotes"),(0,r.kt)("div",{className:"footnotes"},(0,r.kt)("hr",{parentName:"div"}),(0,r.kt)("ol",{parentName:"div"},(0,r.kt)("li",{parentName:"ol",id:"fn-1"},"akwizgran et al. ",(0,r.kt)("a",{parentName:"li",href:"https://code.briarproject.org/briar/briar-spec/blob/master/protocols/BSP"},"BSP"),". Briar.",(0,r.kt)("a",{parentName:"li",href:"#fnref-1",className:"footnote-backref"},"\u21a9")),(0,r.kt)("li",{parentName:"ol",id:"fn-2"},"<",(0,r.kt)("a",{parentName:"li",href:"https://github.com/vacp2p/mvds"},"https://github.com/vacp2p/mvds"),">",(0,r.kt)("a",{parentName:"li",href:"#fnref-2",className:"footnote-backref"},"\u21a9")))))}m.isMDXComponent=!0},3905:(e,t,n)=>{n.d(t,{Zo:()=>d,kt:()=>h});var a=n(67294);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function o(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},i=Object.keys(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var s=a.createContext({}),p=function(e){var t=a.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):o(o({},t),e)),n},d=function(e){var t=p(e.components);return a.createElement(s.Provider,{value:t},e.children)},m={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},c=a.forwardRef((function(e,t){var n=e.components,r=e.mdxType,i=e.originalType,s=e.parentName,d=l(e,["components","mdxType","originalType","parentName"]),c=p(n),h=r,u=c["".concat(s,".").concat(h)]||c[h]||m[h]||i;return n?a.createElement(u,o(o({ref:t},d),{},{components:n})):a.createElement(u,o({ref:t},d))}));function h(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var i=n.length,o=new Array(i);o[0]=c;var l={};for(var s in t)hasOwnProperty.call(t,s)&&(l[s]=t[s]);l.originalType=e,l.mdxType="string"==typeof e?e:r,o[1]=l;for(var p=2;p<i;p++)o[p]=n[p];return a.createElement.apply(null,o)}return a.createElement.apply(null,n)}c.displayName="MDXCreateElement"},17987:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/batch-8bb753ee771b1f96610ba432fa7fcec3.png"},48712:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/interactive-b04b5377d67c337013e72abbbd40ec69.png"}}]);