"use strict";(self.webpackChunklogos_docs_template=self.webpackChunklogos_docs_template||[]).push([[6941],{49042:(t,e,a)=>{a.r(e),a.d(e,{assets:()=>s,contentTitle:()=>i,default:()=>d,frontMatter:()=>r,metadata:()=>o,toc:()=>p});var n=a(87462),l=(a(67294),a(3905));const r={title:"62/STATUS-PAYLOADS",name:"Status Message Payloads",status:"draft",description:"Describes the payload of each message in Status.",editor:"r4bbit &lt;r4bbit@status.im&gt;",contributors:["Adam Babik &lt;adam@status.im&gt;","Andrea Maria Piana &lt;andreap@status.im&gt;","Oskar Thoren &lt;oskarth@titanproxy.com&gt;","Samuel Hawksby-Robinson &lt;samuel@status.im&gt;"]},i=void 0,o={unversionedId:"62/payloads",id:"62/payloads",title:"62/STATUS-PAYLOADS",description:"Describes the payload of each message in Status.",source:"@site/status/62/payloads.md",sourceDirName:"62",slug:"/62/payloads",permalink:"/status/62/payloads",draft:!1,tags:[],version:"current",frontMatter:{title:"62/STATUS-PAYLOADS",name:"Status Message Payloads",status:"draft",description:"Describes the payload of each message in Status.",editor:"r4bbit &lt;r4bbit@status.im&gt;",contributors:["Adam Babik &lt;adam@status.im&gt;","Andrea Maria Piana &lt;andreap@status.im&gt;","Oskar Thoren &lt;oskarth@titanproxy.com&gt;","Samuel Hawksby-Robinson &lt;samuel@status.im&gt;"]},sidebar:"defaultSidebar",previous:{title:"61/STATUS-Community-History-Service",permalink:"/status/61/community-history-service"},next:{title:"63/STATUS-Keycard-Usage",permalink:"/status/63/keycard-usage"}},s={},p=[{value:"Abstract",id:"abstract",level:2},{value:"Wire Format Specification",id:"wire-format-specification",level:2},{value:"Payload wrapper",id:"payload-wrapper",level:3},{value:"Encoding",id:"encoding",level:3},{value:"Types of messages",id:"types-of-messages",level:3},{value:"ChatMessage",id:"chatmessage",level:4},{value:"Content types",id:"content-types",level:4},{value:"Mentions",id:"mentions",level:5},{value:"Sticker content type",id:"sticker-content-type",level:5},{value:"Image content type",id:"image-content-type",level:5},{value:"Audio content type",id:"audio-content-type",level:5},{value:"Community content type",id:"community-content-type",level:5},{value:"DiscordMessage content type",id:"discordmessage-content-type",level:5},{value:"Message types",id:"message-types",level:4},{value:"Clock vs Timestamp and message ordering",id:"clock-vs-timestamp-and-message-ordering",level:4},{value:"Chats",id:"chats",level:4},{value:"ContactUpdate",id:"contactupdate",level:3},{value:"Payload Fields",id:"payload-fields",level:4},{value:"Contact update",id:"contact-update",level:4},{value:"EmojiReaction",id:"emojireaction",level:3},{value:"MembershipUpdateMessage and MembershipUpdateEvent",id:"membershipupdatemessage-and-membershipupdateevent",level:3},{value:"Chat entities",id:"chat-entities",level:4},{value:"SyncInstallationContactV2",id:"syncinstallationcontactv2",level:3},{value:"SyncInstallationPublicChat",id:"syncinstallationpublicchat",level:3},{value:"SyncPairInstallation",id:"syncpairinstallation",level:3},{value:"ChatIdentity",id:"chatidentity",level:3},{value:"CommunityDescription",id:"communitydescription",level:3},{value:"CommunityRequestToJoin",id:"communityrequesttojoin",level:3},{value:"PinMessage",id:"pinmessage",level:3},{value:"EditMessage",id:"editmessage",level:3},{value:"DeleteMessage",id:"deletemessage",level:3},{value:"CommunityMessageArchiveLink",id:"communitymessagearchivelink",level:3},{value:"AcceptContactRequest",id:"acceptcontactrequest",level:3},{value:"RetractContactRequest",id:"retractcontactrequest",level:3},{value:"CommunityRequestToJoinResponse",id:"communityrequesttojoinresponse",level:3},{value:"CommunityRequestToLeave",id:"communityrequesttoleave",level:3},{value:"RequestContactVerification",id:"requestcontactverification",level:3},{value:"AcceptContactVerification",id:"acceptcontactverification",level:3},{value:"DeclineContactVerification",id:"declinecontactverification",level:3},{value:"CancelContactVerification",id:"cancelcontactverification",level:3},{value:"CommunityCancelRequestToJoin",id:"communitycancelrequesttojoin",level:3},{value:"CommunityEditSharedAddresses",id:"communityeditsharedaddresses",level:3},{value:"Upgradability",id:"upgradability",level:2},{value:"Security Considerations",id:"security-considerations",level:2},{value:"Changelog",id:"changelog",level:2},{value:"Version 0.5",id:"version-05",level:3},{value:"Version 0.4",id:"version-04",level:3},{value:"Version 0.3",id:"version-03",level:3},{value:"Copyright",id:"copyright",level:2}],m={toc:p};function d(t){let{components:e,...a}=t;return(0,l.kt)("wrapper",(0,n.Z)({},m,a,{components:e,mdxType:"MDXLayout"}),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"Status: draft"),(0,l.kt)("li",{parentName:"ul"},"Editor: r4bbit ","<",(0,l.kt)("a",{parentName:"li",href:"mailto:r4bbit@status.im"},"r4bbit@status.im"),">"),(0,l.kt)("li",{parentName:"ul"},"Contributors:",(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},"Adam Babik ","<",(0,l.kt)("a",{parentName:"li",href:"mailto:adam@status.im"},"adam@status.im"),">"),(0,l.kt)("li",{parentName:"ul"},"Andrea Maria Piana ","<",(0,l.kt)("a",{parentName:"li",href:"mailto:andreap@status.im"},"andreap@status.im"),">"),(0,l.kt)("li",{parentName:"ul"},"Oskar Thoren ","<",(0,l.kt)("a",{parentName:"li",href:"mailto:oskarth@titanproxy.com"},"oskarth@titanproxy.com"),">"),(0,l.kt)("li",{parentName:"ul"},"Samuel Hawksby-Robinson ","<",(0,l.kt)("a",{parentName:"li",href:"mailto:samuel@status.im"},"samuel@status.im"),">")))),(0,l.kt)("h2",{id:"abstract"},"Abstract"),(0,l.kt)("p",null,"This specification describes how the payload of each message in Status looks\nlike.\nIt is primarily centered around chat and chat-related use cases."),(0,l.kt)("p",null,"The payloads aims to be flexible enough to support messaging but also cases\ndescribed in the ",(0,l.kt)("a",{parentName:"p",href:"https://status.im/whitepaper.pdf"},"Status Whitepaper")," as well\nas various clients created using different technologies."),(0,l.kt)("h2",{id:"wire-format-specification"},"Wire Format Specification"),(0,l.kt)("h3",{id:"payload-wrapper"},"Payload wrapper"),(0,l.kt)("p",null,"The node wraps all payloads in a ",(0,l.kt)("a",{parentName:"p",href:"https://developers.google.com/protocol-buffers/"},"protobuf record"),"\nrecord:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-protobuf"},"message StatusProtocolMessage {\n  bytes signature = 4001;\n  bytes payload = 4002;\n}\n")),(0,l.kt)("p",null,(0,l.kt)("inlineCode",{parentName:"p"},"signature")," is the bytes of the signed ",(0,l.kt)("inlineCode",{parentName:"p"},"SHA3-256")," of the payload,\nsigned with the key of the author of the message.\nThe node needs the signature to validate authorship of the message,\nso that the message can be relayed to third parties.\nIf a signature is not present, but an author is provided by a layer below,\nthe message is not to be relayed to third parties,\nand it is considered plausibly deniable."),(0,l.kt)("h3",{id:"encoding"},"Encoding"),(0,l.kt)("p",null,"The node encodes the payload using ",(0,l.kt)("a",{parentName:"p",href:"https://developers.google.com/protocol-buffers"},"Protobuf")),(0,l.kt)("h3",{id:"types-of-messages"},"Types of messages"),(0,l.kt)("h4",{id:"chatmessage"},"ChatMessage"),(0,l.kt)("p",null,"The type ",(0,l.kt)("inlineCode",{parentName:"p"},"ChatMessage")," represents a chat message exchanged between clients."),(0,l.kt)("p",null,"Payload"),(0,l.kt)("p",null,"The protobuf description is:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-protobuf"},"message ChatMessage {\n  // Lamport timestamp of the chat message\n  uint64 clock = 1;\n  // Unix timestamps in milliseconds, currently not used as we use whisper as\n  // more reliable, but here so that we don't rely on it\n  uint64 timestamp = 2;\n  // Text of the message\n  string text = 3;\n  // Id of the message that we are replying to\n  string response_to = 4;\n  // Ens name of the sender\n  string ens_name = 5;\n  // Chat id, this field is symmetric for public-chats and private group chats,\n  // but asymmetric in case of one-to-ones, as the sender will use the chat-id\n  // of the received, while the receiver will use the chat-id of the sender.\n  // Probably should be the concatenation of sender-pk & receiver-pk in\n  // alphabetical order\n  string chat_id = 6;\n\n  // The type of message (public/one-to-one/private-group-chat)\n  MessageType message_type = 7;\n  // The type of the content of the message\n  ContentType content_type = 8;\n\n  oneof payload {\n    StickerMessage sticker = 9;\n    ImageMessage image = 10;\n    AudioMessage audio = 11;\n    bytes community = 12;\n    DiscordMessage discord_message = 99;\n  }\n\n  // Grant for community chat messages\n  bytes grant = 13;\n\n  // Message author's display name, introduced in version 1\n  string display_name = 14;\n\n  ContactRequestPropagatedState contact_request_propagated_state = 15;\n\n  repeated UnfurledLink unfurled_links = 16;\n\n  enum ContentType {\n    UNKNOWN_CONTENT_TYPE = 0;\n    TEXT_PLAIN = 1;\n    STICKER = 2;\n    STATUS = 3;\n    EMOJI = 4;\n    TRANSACTION_COMMAND = 5;\n    // Only local\n    SYSTEM_MESSAGE_CONTENT_PRIVATE_GROUP = 6;\n    IMAGE = 7;\n    AUDIO = 8;\n    COMMUNITY = 9;\n    // Only local\n    SYSTEM_MESSAGE_GAP = 10;\n    CONTACT_REQUEST = 11;\n    DISCORD_MESSAGE = 12;\n    IDENTITY_VERIFICATION = 13;\n    // Only local\n    SYSTEM_MESSAGE_PINNED_MESSAGE = 14;\n    // Only local\n    SYSTEM_MESSAGE_MUTUAL_EVENT_SENT = 15;\n    // Only local\n    SYSTEM_MESSAGE_MUTUAL_EVENT_ACCEPTED = 16;\n    // Only local\n    SYSTEM_MESSAGE_MUTUAL_EVENT_REMOVED = 17;\n  }\n}\n")),(0,l.kt)("table",null,(0,l.kt)("thead",{parentName:"table"},(0,l.kt)("tr",{parentName:"thead"},(0,l.kt)("th",{parentName:"tr",align:null},"Field"),(0,l.kt)("th",{parentName:"tr",align:null},"Name"),(0,l.kt)("th",{parentName:"tr",align:null},"Type"),(0,l.kt)("th",{parentName:"tr",align:null},"Description"))),(0,l.kt)("tbody",{parentName:"table"},(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"1"),(0,l.kt)("td",{parentName:"tr",align:null},"clock"),(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"uint64")),(0,l.kt)("td",{parentName:"tr",align:null},"The clock of the chat")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"2"),(0,l.kt)("td",{parentName:"tr",align:null},"timestamp"),(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"uint64")),(0,l.kt)("td",{parentName:"tr",align:null},"The sender timestamp at message creation")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"3"),(0,l.kt)("td",{parentName:"tr",align:null},"text"),(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"string")),(0,l.kt)("td",{parentName:"tr",align:null},"The content of the message")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"4"),(0,l.kt)("td",{parentName:"tr",align:null},"response_to"),(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"string")),(0,l.kt)("td",{parentName:"tr",align:null},"The ID of the message replied to")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"5"),(0,l.kt)("td",{parentName:"tr",align:null},"ens_name"),(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"string")),(0,l.kt)("td",{parentName:"tr",align:null},"The ENS name of the user sending the message")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"6"),(0,l.kt)("td",{parentName:"tr",align:null},"chat_id"),(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"string")),(0,l.kt)("td",{parentName:"tr",align:null},"The local ID of the chat the message is sent to")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"7"),(0,l.kt)("td",{parentName:"tr",align:null},"message_type"),(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"MessageType")),(0,l.kt)("td",{parentName:"tr",align:null},"The type of message, different for one-to-one, public or group chats")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"8"),(0,l.kt)("td",{parentName:"tr",align:null},"content_type"),(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"ContentType")),(0,l.kt)("td",{parentName:"tr",align:null},"The type of the content of the message")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"9"),(0,l.kt)("td",{parentName:"tr",align:null},"payload"),(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"Sticker")," I ",(0,l.kt)("inlineCode",{parentName:"td"},"Image")," I ",(0,l.kt)("inlineCode",{parentName:"td"},"Audio")," I ",(0,l.kt)("inlineCode",{parentName:"td"},"DiscordMessage")," I ",(0,l.kt)("inlineCode",{parentName:"td"},"bytes")," I nil`"),(0,l.kt)("td",{parentName:"tr",align:null},"The payload of the message based on the content type")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"13"),(0,l.kt)("td",{parentName:"tr",align:null},"grant"),(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"bytes")),(0,l.kt)("td",{parentName:"tr",align:null},"Grant for community chat messages")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"14"),(0,l.kt)("td",{parentName:"tr",align:null},"display_name"),(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"string")),(0,l.kt)("td",{parentName:"tr",align:null},"The message author's display name")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"15"),(0,l.kt)("td",{parentName:"tr",align:null},"contact_request_propagated_state"),(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"ContactRequestPropagatedState")),(0,l.kt)("td",{parentName:"tr",align:null},"Contact request clock values")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"16"),(0,l.kt)("td",{parentName:"tr",align:null},"unfurled_links"),(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"UnfurledLink[]")),(0,l.kt)("td",{parentName:"tr",align:null},"Unfurled links and their metadata that have been attached to the message")))),(0,l.kt)("h4",{id:"content-types"},"Content types"),(0,l.kt)("p",null,"A node requires content types for a proper interpretation of incoming messages.\nNot each message is plain text but may carry different information."),(0,l.kt)("p",null,"The following content types MUST be supported:"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"TEXT_PLAIN")," identifies a message which content is a plaintext.")),(0,l.kt)("p",null,"There are other content types that MAY be implemented by the client:"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"STICKER")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"STATUS")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"EMOJI")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"TRANSACTION_COMMAND")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"IMAGE")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"AUDIO")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"COMMUNITY")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"CONTACT_REQUEST")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"DISCORD_MESSAGE")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"IDENTITY_VERIFICATION"))),(0,l.kt)("h5",{id:"mentions"},"Mentions"),(0,l.kt)("p",null,"A mention MUST be represented as a string with the ",(0,l.kt)("inlineCode",{parentName:"p"},"@0xpk")," format,\nwhere ",(0,l.kt)("inlineCode",{parentName:"p"},"pk")," is the public key of the\n",(0,l.kt)("a",{parentName:"p",href:"https://specs.status.im/spec/2"},"user account")," to be mentioned,\nwithin the ",(0,l.kt)("inlineCode",{parentName:"p"},"text")," field of a message with content_type ",(0,l.kt)("inlineCode",{parentName:"p"},"TEXT_PLAIN"),".\nA message MAY contain more than one mention.\nThis specification RECOMMENDs that the application\ndoes not require the user to enter the entire pk.\nThis specification RECOMMENDs that the application\nallows the user to create a mention by typing @ followed by the related ENS or\n3-word pseudonym.\nThis specification RECOMMENDs that the application\nprovides the user auto-completion functionality to create a mention.\nFor better user experience,\nthe client SHOULD display a known\n",(0,l.kt)("a",{parentName:"p",href:"https://specs.status.im/spec/2#contact-verification"},"ens name or the 3-word pseudonym corresponding to the key"),"\ninstead of the ",(0,l.kt)("inlineCode",{parentName:"p"},"pk"),"."),(0,l.kt)("h5",{id:"sticker-content-type"},"Sticker content type"),(0,l.kt)("p",null,"A ",(0,l.kt)("inlineCode",{parentName:"p"},"ChatMessage")," with ",(0,l.kt)("inlineCode",{parentName:"p"},"STICKER")," ",(0,l.kt)("inlineCode",{parentName:"p"},"Content/Type")," MUST also specify the ID of the ",(0,l.kt)("inlineCode",{parentName:"p"},"Pack"),"\nand the ",(0,l.kt)("inlineCode",{parentName:"p"},"Hash")," of the pack, in the ",(0,l.kt)("inlineCode",{parentName:"p"},"Sticker")," field of ",(0,l.kt)("inlineCode",{parentName:"p"},"ChatMessage")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-protobuf"},"message StickerMessage {\n  string hash = 1;\n  int32 pack = 2;\n}\n")),(0,l.kt)("h5",{id:"image-content-type"},"Image content type"),(0,l.kt)("p",null,"A ",(0,l.kt)("inlineCode",{parentName:"p"},"ChatMessage")," with ",(0,l.kt)("inlineCode",{parentName:"p"},"IMAGE")," ",(0,l.kt)("inlineCode",{parentName:"p"},"Content/Type")," MUST also\nspecify the ",(0,l.kt)("inlineCode",{parentName:"p"},"payload")," of the image and the ",(0,l.kt)("inlineCode",{parentName:"p"},"type"),"."),(0,l.kt)("p",null,"Clients MUST sanitize the payload before accessing its content, in particular:"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"Clients MUST choose a secure decoder"),(0,l.kt)("li",{parentName:"ul"},"Clients SHOULD strip metadata if present without parsing/decoding it"),(0,l.kt)("li",{parentName:"ul"},"Clients SHOULD NOT add metadata/exif when sending an image file for privacy\nand security reasons"),(0,l.kt)("li",{parentName:"ul"},"Clients MUST make sure that the transport layer constraints the size of the payload\nto limit they are able to handle securely")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-protobuf"},"message ImageMessage {\n  bytes payload = 1;\n  ImageType type = 2;\n  enum ImageType {\n    UNKNOWN_IMAGE_TYPE = 0;\n    PNG = 1;\n    JPEG = 2;\n    WEBP = 3;\n    GIF = 4;\n  }\n}\n")),(0,l.kt)("h5",{id:"audio-content-type"},"Audio content type"),(0,l.kt)("p",null,"A ",(0,l.kt)("inlineCode",{parentName:"p"},"ChatMessage")," with ",(0,l.kt)("inlineCode",{parentName:"p"},"AUDIO"),",\n",(0,l.kt)("inlineCode",{parentName:"p"},"Content/Type")," MUST also specify the ",(0,l.kt)("inlineCode",{parentName:"p"},"payload")," of the audio,\nthe ",(0,l.kt)("inlineCode",{parentName:"p"},"type")," and the duration in milliseconds (",(0,l.kt)("inlineCode",{parentName:"p"},"duration_ms"),")."),(0,l.kt)("p",null,"Clients MUST sanitize the payload before accessing its content, in particular:"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"Clients MUST choose a secure decoder"),(0,l.kt)("li",{parentName:"ul"},"Clients SHOULD strip metadata if present without parsing/decoding it"),(0,l.kt)("li",{parentName:"ul"},"Clients SHOULD NOT add metadata/exif when sending an audio file for privacy\nand security reasons"),(0,l.kt)("li",{parentName:"ul"},"Clients MUST make sure that the transport layer constraints the size\nof the payload to limit they are able to handle securely")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-protobuf"},"message AudioMessage {\n  bytes payload = 1;\n  AudioType type = 2;\n  uint64 duration_ms = 3;\n  enum AudioType {\n    UNKNOWN_AUDIO_TYPE = 0;\n    AAC = 1;\n    AMR = 2;\n")),(0,l.kt)("h5",{id:"community-content-type"},"Community content type"),(0,l.kt)("p",null,"A ",(0,l.kt)("inlineCode",{parentName:"p"},"ChatMessage")," with ",(0,l.kt)("inlineCode",{parentName:"p"},"COMMUNITY")," ",(0,l.kt)("inlineCode",{parentName:"p"},"Content/Type"),",\nMUST also specify the ",(0,l.kt)("inlineCode",{parentName:"p"},"payload")," of the community as bytes from a ",(0,l.kt)("a",{parentName:"p",href:"#communitydescription"},"CommunityDescription"),"."),(0,l.kt)("h5",{id:"discordmessage-content-type"},"DiscordMessage content type"),(0,l.kt)("p",null,"A ",(0,l.kt)("inlineCode",{parentName:"p"},"ChatMessage")," with ",(0,l.kt)("inlineCode",{parentName:"p"},"DISCORD_MESSAGE")," ",(0,l.kt)("inlineCode",{parentName:"p"},"Content/Type"),",\nMUST also specify the ",(0,l.kt)("inlineCode",{parentName:"p"},"payload")," of the ",(0,l.kt)("inlineCode",{parentName:"p"},"DiscordMessage"),"."),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-protobuf"},"message DiscordMessage {\n  string id = 1;\n  string type = 2;\n  string timestamp = 3;\n  string timestampEdited = 4;\n  string content = 5;\n  DiscordMessageAuthor author = 6;\n  DiscordMessageReference reference = 7;\n  repeated DiscordMessageAttachment attachments = 8;\n}\n\nmessage DiscordMessageAuthor {\n  string id = 1;\n  string name = 2;\n  string discriminator = 3;\n  string nickname = 4;\n  string avatarUrl = 5;\n  bytes avatarImagePayload = 6;\n  string localUrl = 7;\n}\n\nmessage DiscordMessageReference {\n  string messageId = 1;\n  string channelId = 2;\n  string guildId = 3;\n}\n\nmessage DiscordMessageAttachment {\n  string id = 1;\n  string messageId = 2;\n  string url = 3;\n  string fileName = 4;\n  uint64 fileSizeBytes = 5;\n  string contentType = 6;\n  bytes payload = 7;\n  string localUrl = 8;\n}\n")),(0,l.kt)("h4",{id:"message-types"},"Message types"),(0,l.kt)("p",null,"A node requires message types to decide how to encrypt a particular message and\nwhat metadata needs to be attached when passing a message to the transport layer.\nFor more on this, see ",(0,l.kt)("a",{parentName:"p",href:"/waku/standards/core/10/waku2"},"10/WAKU2"),"."),(0,l.kt)("p",null,"The following messages types MUST be supported:"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"ONE_TO_ONE")," is a message to the public group"),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"PUBLIC_GROUP")," is a private message"),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"PRIVATE_GROUP")," is a message to the private group."),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"COMMUNITY_CHAT")," is a message to a community channe.")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-protobuf"},"enum MessageType {\n  UNKNOWN_MESSAGE_TYPE = 0;\n  ONE_TO_ONE = 1;\n  PUBLIC_GROUP = 2;\n  PRIVATE_GROUP = 3;\n  // Only local\n  SYSTEM_MESSAGE_PRIVATE_GROUP = 4;\n  COMMUNITY_CHAT = 5;\n  // Only local\n  SYSTEM_MESSAGE_GAP = 6;\n}\n")),(0,l.kt)("h4",{id:"clock-vs-timestamp-and-message-ordering"},"Clock vs Timestamp and message ordering"),(0,l.kt)("p",null,"If a user sends a new message,\nbefore the messages sent while the user was offline are received,\nthe new message is supposed to be displayed last in a chat.\nThis is where the basic algorithm of Lamport timestamp would fall short as\nit's only meant to order causally related events."),(0,l.kt)("p",null,'The status client therefore makes a "bid",\nspeculating that it will beat the current chat-timestamp,\ns.t. the status client\'s Lamport timestamp format is:\n',(0,l.kt)("inlineCode",{parentName:"p"},"clock = max({timestamp}, chat_clock + 1)")),(0,l.kt)("p",null,"This will satisfy the Lamport requirement, namely: a -> b then T(a) < T(b)"),(0,l.kt)("p",null,(0,l.kt)("inlineCode",{parentName:"p"},"timestamp")," MUST be Unix time calculated, when the node creates the message,\nin milliseconds.\nThis field SHOULD not be relied upon for message ordering."),(0,l.kt)("p",null,(0,l.kt)("inlineCode",{parentName:"p"},"clock")," SHOULD be calculated using the algorithm of\n",(0,l.kt)("a",{parentName:"p",href:"https://en.wikipedia.org/wiki/Lamport_timestamps"},"Lamport timestamps"),".\nWhen there are messages available in a chat,\nthe node calculates ",(0,l.kt)("inlineCode",{parentName:"p"},"clock"),"'s value\nbased on the last received message in a particular chat:\n",(0,l.kt)("inlineCode",{parentName:"p"},"max(timeNowInMs, last-message-clock-value + 1)"),".\nIf there are no messages, ",(0,l.kt)("inlineCode",{parentName:"p"},"clock")," is initialized with ",(0,l.kt)("inlineCode",{parentName:"p"},"timestamp"),"'s value."),(0,l.kt)("p",null,"Messages with a ",(0,l.kt)("inlineCode",{parentName:"p"},"clock")," greater than ",(0,l.kt)("inlineCode",{parentName:"p"},"120")," seconds over the Whisper/Waku timestamp\nSHOULD be discarded,\nin order to avoid malicious users to increase the ",(0,l.kt)("inlineCode",{parentName:"p"},"clock")," of a chat arbitrarily."),(0,l.kt)("p",null,"Messages with a ",(0,l.kt)("inlineCode",{parentName:"p"},"clock")," less than ",(0,l.kt)("inlineCode",{parentName:"p"},"120")," seconds under the Whisper/Waku timestamp\nmight indicate an attempt to insert messages in the chat history,\nwhich is not distinguishable from a ",(0,l.kt)("inlineCode",{parentName:"p"},"datasync")," layer re-transit event.\nA client MAY mark this messages with a warning to the user, or discard them."),(0,l.kt)("p",null,"The node uses ",(0,l.kt)("inlineCode",{parentName:"p"},"clock")," value for the message ordering.\nThe algorithm used, and\nthe distributed nature of the system produces casual ordering,\nwhich might produce counter-intuitive results in some edge cases.\nFor example, when a user joins a public chat and\nsends a message before receiving the exist messages,\ntheir message ",(0,l.kt)("inlineCode",{parentName:"p"},"clock")," value might be lower and\nthe message will end up in the past when the historical messages are fetched."),(0,l.kt)("h4",{id:"chats"},"Chats"),(0,l.kt)("p",null,"Chat is a structure that helps organize messages.\nIt's usually desired to display messages only from a single recipient,\nor a group of recipients at a time and chats help to achieve that."),(0,l.kt)("p",null,"All incoming messages can be matched against a chat.\nThe below table describes how to calculate a chat ID for each message type."),(0,l.kt)("table",null,(0,l.kt)("thead",{parentName:"table"},(0,l.kt)("tr",{parentName:"thead"},(0,l.kt)("th",{parentName:"tr",align:null},"Message Type"),(0,l.kt)("th",{parentName:"tr",align:null},"Chat ID Calculation"),(0,l.kt)("th",{parentName:"tr",align:null},"Direction"),(0,l.kt)("th",{parentName:"tr",align:null},"Comment"))),(0,l.kt)("tbody",{parentName:"table"},(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"PUBLIC_GROUP"),(0,l.kt)("td",{parentName:"tr",align:null},"chat ID is equal to a public channel name; it should equal ",(0,l.kt)("inlineCode",{parentName:"td"},"chatId")," from the message"),(0,l.kt)("td",{parentName:"tr",align:null},"Incoming/Outgoing"),(0,l.kt)("td",{parentName:"tr",align:null})),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"ONE_TO_ONE"),(0,l.kt)("td",{parentName:"tr",align:null},"let ",(0,l.kt)("inlineCode",{parentName:"td"},"P")," be a public key of the recipient; ",(0,l.kt)("inlineCode",{parentName:"td"},"hex-encode(P)")," is a chat ID; use it as ",(0,l.kt)("inlineCode",{parentName:"td"},"chatId")," value in the message"),(0,l.kt)("td",{parentName:"tr",align:null},"Outgoing"),(0,l.kt)("td",{parentName:"tr",align:null})),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"user-message"),(0,l.kt)("td",{parentName:"tr",align:null},"let ",(0,l.kt)("inlineCode",{parentName:"td"},"P")," be a public key of message's signature; ",(0,l.kt)("inlineCode",{parentName:"td"},"hex-encode(P)")," is a chat ID; discard ",(0,l.kt)("inlineCode",{parentName:"td"},"chat-id")," from message"),(0,l.kt)("td",{parentName:"tr",align:null},"Incoming"),(0,l.kt)("td",{parentName:"tr",align:null},"if there is no matched chat, it might be the first message from public key ",(0,l.kt)("inlineCode",{parentName:"td"},"P"),"; the node MAY discard the message or MAY create a new chat; Status official clients create a new chat")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"PRIVATE_GROUP"),(0,l.kt)("td",{parentName:"tr",align:null},"use ",(0,l.kt)("inlineCode",{parentName:"td"},"chatId")," from the message"),(0,l.kt)("td",{parentName:"tr",align:null},"Incoming/Outgoing"),(0,l.kt)("td",{parentName:"tr",align:null},"find an existing chat by ",(0,l.kt)("inlineCode",{parentName:"td"},"chatId"),"; if none is found, the user is not a member of that chat or the user hasn't joined that chat, the message MUST be discarded")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"COMMUNITY_CHAT"),(0,l.kt)("td",{parentName:"tr",align:null},"use ",(0,l.kt)("inlineCode",{parentName:"td"},"chatId")," from the message"),(0,l.kt)("td",{parentName:"tr",align:null},"Incoming/Outgoing"),(0,l.kt)("td",{parentName:"tr",align:null},"find existing community chat within a community based on ",(0,l.kt)("inlineCode",{parentName:"td"},"chatId"),"; the ",(0,l.kt)("inlineCode",{parentName:"td"},"chatId")," includes a community id prefix")))),(0,l.kt)("h3",{id:"contactupdate"},"ContactUpdate"),(0,l.kt)("p",null,(0,l.kt)("inlineCode",{parentName:"p"},"ContactUpdate")," is a message exchange to notify peers\nthat either the user has been added as a contact, or\nthat information about the sending user have changed."),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-protobuf"},"message ContactUpdate {\n  uint64 clock = 1;\n  string ens_name = 2;\n  string profile_image = 3;\n  string display_name = 4;\n  uint64 contact_request_clock = 5;\n  ContactRequestPropagatedState contact_request_propagated_state = 6;\n  string public_key = 7;\n}\n\nmessage ContactRequestPropagatedState {\n  uint64 local_clock = 1;\n  uint64 local_state = 2;\n  uint64 remote_clock = 3;\n  uint64 remote_state = 4;\n}\n")),(0,l.kt)("h4",{id:"payload-fields"},"Payload Fields"),(0,l.kt)("table",null,(0,l.kt)("thead",{parentName:"table"},(0,l.kt)("tr",{parentName:"thead"},(0,l.kt)("th",{parentName:"tr",align:null},"Field"),(0,l.kt)("th",{parentName:"tr",align:null},"Name"),(0,l.kt)("th",{parentName:"tr",align:null},"Type"),(0,l.kt)("th",{parentName:"tr",align:null},"Description"))),(0,l.kt)("tbody",{parentName:"table"},(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"1"),(0,l.kt)("td",{parentName:"tr",align:null},"clock"),(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"uint64")),(0,l.kt)("td",{parentName:"tr",align:null},"The clock of the chat with the user")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"2"),(0,l.kt)("td",{parentName:"tr",align:null},"ens_name"),(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"string")),(0,l.kt)("td",{parentName:"tr",align:null},"The ENS name if set")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"3"),(0,l.kt)("td",{parentName:"tr",align:null},"profile_image"),(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"string")),(0,l.kt)("td",{parentName:"tr",align:null},"The base64 encoded profile picture of the user")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"4"),(0,l.kt)("td",{parentName:"tr",align:null},"display_name"),(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"string")),(0,l.kt)("td",{parentName:"tr",align:null},"The display name of the user")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"5"),(0,l.kt)("td",{parentName:"tr",align:null},"contact_request_clock"),(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"uint64")),(0,l.kt)("td",{parentName:"tr",align:null},"The clock at which a contact request was sent")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"6"),(0,l.kt)("td",{parentName:"tr",align:null},"contact_request_propagated_state"),(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"ContactRequestPropagatedState")),(0,l.kt)("td",{parentName:"tr",align:null},"Additional propagation clock values")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"7"),(0,l.kt)("td",{parentName:"tr",align:null},"public_key"),(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"string")),(0,l.kt)("td",{parentName:"tr",align:null},"The public key of the user")))),(0,l.kt)("h4",{id:"contact-update"},"Contact update"),(0,l.kt)("p",null,"A client SHOULD send a ",(0,l.kt)("inlineCode",{parentName:"p"},"ContactUpdate")," to all the contacts each time:"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"The ens_name has changed"),(0,l.kt)("li",{parentName:"ul"},"A user edits the profile image")),(0,l.kt)("p",null,"A client SHOULD also periodically send a ",(0,l.kt)("inlineCode",{parentName:"p"},"ContactUpdate")," to all the contacts,\nthe interval is up to the client,\nthe Status official client sends these updates every 48 hours."),(0,l.kt)("h3",{id:"emojireaction"},"EmojiReaction"),(0,l.kt)("p",null,(0,l.kt)("inlineCode",{parentName:"p"},"EmojiReaction"),'s represents a user\'s "reaction" to a specific chat message.\nFor more information about the concept of emoji reactions see ',(0,l.kt)("a",{parentName:"p",href:"https://en.wikipedia.org/wiki/Facebook_like_button#Use_on_Facebook"},"Facebook Reactions"),"."),(0,l.kt)("p",null,"This specification RECOMMENDS that the UI/UX implementation of sending ",(0,l.kt)("inlineCode",{parentName:"p"},"EmojiReactions"),"\nrequires only a single click operation,\nas users have an expectation that emoji reactions are effortless\nand simple to perform.  "),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-protobuf"},"message EmojiReaction {\n  // clock Lamport timestamp of the chat message\n  uint64 clock = 1;\n\n  // chat_id the ID of the chat the message belongs to, for query efficiency the\n  // chat_id is stored in the db even though the\n  // target message also stores the chat_id\n  string chat_id = 2;\n\n  // message_id the ID of the target message that the user wishes to react to\n  string message_id = 3;\n\n  // message_type \n  // is (somewhat confusingly) the ID of the type of chat the message belongs to\n  MessageType message_type = 4;\n\n  // type the ID of the emoji the user wishes to react with\n  Type type = 5;\n\n  enum Type {\n    UNKNOWN_EMOJI_REACTION_TYPE = 0;\n    LOVE = 1;\n    THUMBS_UP = 2;\n    THUMBS_DOWN = 3;\n    LAUGH = 4;\n    SAD = 5;\n    ANGRY = 6;\n  }\n\n // whether this is a retraction of a previously sent emoji\n  bool retracted = 6;\n}\n")),(0,l.kt)("p",null,"Clients MUST specify ",(0,l.kt)("inlineCode",{parentName:"p"},"clock"),", ",(0,l.kt)("inlineCode",{parentName:"p"},"chat_id"),", ",(0,l.kt)("inlineCode",{parentName:"p"},"message_id"),", ",(0,l.kt)("inlineCode",{parentName:"p"},"type")," and ",(0,l.kt)("inlineCode",{parentName:"p"},"message_type"),"."),(0,l.kt)("p",null,"This specification RECOMMENDS that the UI/UX implementation of retracting an ",(0,l.kt)("inlineCode",{parentName:"p"},"EmojiReaction"),"s\nrequires only a single click operation,\nas users have an expectation that emoji reaction removals are effortless and\nsimple to perform.  "),(0,l.kt)("h3",{id:"membershipupdatemessage-and-membershipupdateevent"},"MembershipUpdateMessage and MembershipUpdateEvent"),(0,l.kt)("p",null,(0,l.kt)("inlineCode",{parentName:"p"},"MembershipUpdateEvent")," is a message used to propagate information\nabout group membership changes in a group chat.\nThe details are in the ",(0,l.kt)("a",{parentName:"p",href:"../56/communities"},"Group chats specs"),"."),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-protobuf"},"message MembershipUpdateMessage {\n  // The chat id of the private group chat\n  string chat_id = 1;\n  // A list of events for this group chat, first x bytes are the signature, \n  // then is a protobuf encoded MembershipUpdateEvent\n  repeated bytes events = 2;\n\n  // An optional chat message\n  oneof chat_entity {\n    ChatMessage message = 3;\n    EmojiReaction emoji_reaction = 4;\n  }\n}\n\nmessage MembershipUpdateEvent {\n  // Lamport timestamp of the event\n  uint64 clock = 1;\n  // List of public keys of objects of the action\n  repeated string members = 2;\n  // Name of the chat for the CHAT_CREATED/NAME_CHANGED event types\n  string name = 3;\n  // The type of the event\n  EventType type = 4;\n  // Color of the chat for the CHAT_CREATED/COLOR_CHANGED event types\n  string color = 5;\n  // Chat image\n  bytes image = 6;\n\n  enum EventType {\n    UNKNOWN = 0;\n    CHAT_CREATED = 1;\n    NAME_CHANGED = 2;\n    MEMBERS_ADDED = 3;\n    MEMBER_JOINED = 4;\n    MEMBER_REMOVED = 5;\n    ADMINS_ADDED = 6;\n    ADMIN_REMOVED = 7;\n    COLOR_CHANGED = 8;\n    IMAGE_CHANGED = 9;\n  }\n}\n")),(0,l.kt)("p",null,"Payload"),(0,l.kt)("table",null,(0,l.kt)("thead",{parentName:"table"},(0,l.kt)("tr",{parentName:"thead"},(0,l.kt)("th",{parentName:"tr",align:null},"Field"),(0,l.kt)("th",{parentName:"tr",align:null},"Name"),(0,l.kt)("th",{parentName:"tr",align:null},"Type"),(0,l.kt)("th",{parentName:"tr",align:null},"Description"))),(0,l.kt)("tbody",{parentName:"table"},(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"1"),(0,l.kt)("td",{parentName:"tr",align:null},"chat_id"),(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"string")),(0,l.kt)("td",{parentName:"tr",align:null},"The chat id of the private group chat")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"2"),(0,l.kt)("td",{parentName:"tr",align:null},"events"),(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"bytes[]")),(0,l.kt)("td",{parentName:"tr",align:null},"The list of events for this group chat")))),(0,l.kt)("h4",{id:"chat-entities"},"Chat entities"),(0,l.kt)("p",null,"A ",(0,l.kt)("inlineCode",{parentName:"p"},"MembershipUpdateMessage")," includes either a ",(0,l.kt)("inlineCode",{parentName:"p"},"ChatMessage")," or ",(0,l.kt)("inlineCode",{parentName:"p"},"EmojiReaction"),"."),(0,l.kt)("h3",{id:"syncinstallationcontactv2"},"SyncInstallationContactV2"),(0,l.kt)("p",null,"The node uses ",(0,l.kt)("inlineCode",{parentName:"p"},"SyncInstallationContact")," messages to synchronize\nin a best-effort the contacts to other devices."),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-protobuf"},"message SyncInstallationContactV2 {\n  uint64 last_updated_locally = 1;\n  string id = 2;\n  string profile_image = 3;\n  string ens_name = 4;\n  uint64 last_updated = 5;\n  repeated string system_tags = 6;\n  string local_nickname = 7;\n  bool added = 9;\n  bool blocked = 10;\n  bool muted = 11;\n  bool removed = 12;\n  bool has_added_us = 13;\n  int64 verification_status = 14;\n  int64 trust_status = 15;\n  int64 contact_request_local_state = 16;\n  int64 contact_request_local_clock = 17;\n  int64 contact_request_remote_state = 18;\n  int64 contact_request_remote_clock = 19;\n  string display_name = 20;\n}\n")),(0,l.kt)("p",null,"Payload"),(0,l.kt)("table",null,(0,l.kt)("thead",{parentName:"table"},(0,l.kt)("tr",{parentName:"thead"},(0,l.kt)("th",{parentName:"tr",align:null},"Field"),(0,l.kt)("th",{parentName:"tr",align:null},"Name"),(0,l.kt)("th",{parentName:"tr",align:null},"Type"),(0,l.kt)("th",{parentName:"tr",align:null},"Description"))),(0,l.kt)("tbody",{parentName:"table"},(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"1"),(0,l.kt)("td",{parentName:"tr",align:null},"last_updated_locally"),(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"uint64")),(0,l.kt)("td",{parentName:"tr",align:null},"Timestamp of last local update")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"2"),(0,l.kt)("td",{parentName:"tr",align:null},"id"),(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"string")),(0,l.kt)("td",{parentName:"tr",align:null},"id of the contact synced")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"3"),(0,l.kt)("td",{parentName:"tr",align:null},"profile_image"),(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"string")),(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"base64")," encoded profile picture of the user")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"4"),(0,l.kt)("td",{parentName:"tr",align:null},"ens_name"),(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"string")),(0,l.kt)("td",{parentName:"tr",align:null},"ENS name of the contact")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"5"),(0,l.kt)("td",{parentName:"tr",align:null}),(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"array[string]")),(0,l.kt)("td",{parentName:"tr",align:null},"Array of ",(0,l.kt)("inlineCode",{parentName:"td"},"system_tags")," for the user, this can currently be: ",(0,l.kt)("inlineCode",{parentName:"td"},'":contact/added", ":contact/blocked", ":contact/request-received"'))),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"7"),(0,l.kt)("td",{parentName:"tr",align:null},"local_nickname"),(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"string")),(0,l.kt)("td",{parentName:"tr",align:null},"Local display name of the contact")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"9"),(0,l.kt)("td",{parentName:"tr",align:null},"added"),(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"bool")),(0,l.kt)("td",{parentName:"tr",align:null},"Wether the contact is added")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"10"),(0,l.kt)("td",{parentName:"tr",align:null},"blocked"),(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"bool")),(0,l.kt)("td",{parentName:"tr",align:null},"Wether the contact is blocked")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"11"),(0,l.kt)("td",{parentName:"tr",align:null},"muted"),(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"bool")),(0,l.kt)("td",{parentName:"tr",align:null},"Wether the contact is muted")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"12"),(0,l.kt)("td",{parentName:"tr",align:null},"removed"),(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"bool")),(0,l.kt)("td",{parentName:"tr",align:null},"Wether the contact is removed")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"13"),(0,l.kt)("td",{parentName:"tr",align:null},"has_added_us"),(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"bool")),(0,l.kt)("td",{parentName:"tr",align:null},"Wether the contact has added us")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"14"),(0,l.kt)("td",{parentName:"tr",align:null},"verification_status"),(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"int64")),(0,l.kt)("td",{parentName:"tr",align:null},"The verification status of the contact")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"15"),(0,l.kt)("td",{parentName:"tr",align:null},"trust_status"),(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"int64")),(0,l.kt)("td",{parentName:"tr",align:null},"The trust status of the contact")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"16"),(0,l.kt)("td",{parentName:"tr",align:null},"contact_request_local_state"),(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"int64")),(0,l.kt)("td",{parentName:"tr",align:null},"The local contact request state")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"17"),(0,l.kt)("td",{parentName:"tr",align:null},"contact_request_local_clock"),(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"int64")),(0,l.kt)("td",{parentName:"tr",align:null},"The local contact request clock")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"18"),(0,l.kt)("td",{parentName:"tr",align:null},"contact_request_remote_state"),(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"int64")),(0,l.kt)("td",{parentName:"tr",align:null},"The remote contact request state")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"19"),(0,l.kt)("td",{parentName:"tr",align:null},"contact_request_remote_clock"),(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"int64")),(0,l.kt)("td",{parentName:"tr",align:null},"The remote contact request clock")))),(0,l.kt)("h3",{id:"syncinstallationpublicchat"},"SyncInstallationPublicChat"),(0,l.kt)("p",null,"The node uses ",(0,l.kt)("inlineCode",{parentName:"p"},"SyncInstallationPublicChat")," message to synchronize\nin a best-effort the public chats to other devices."),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-protobuf"},"message SyncInstallationPublicChat {\n  uint64 clock = 1;\n  string id = 2;\n}\n")),(0,l.kt)("p",null,"Payload"),(0,l.kt)("table",null,(0,l.kt)("thead",{parentName:"table"},(0,l.kt)("tr",{parentName:"thead"},(0,l.kt)("th",{parentName:"tr",align:null},"Field"),(0,l.kt)("th",{parentName:"tr",align:null},"Name"),(0,l.kt)("th",{parentName:"tr",align:null},"Type"),(0,l.kt)("th",{parentName:"tr",align:null},"Description"))),(0,l.kt)("tbody",{parentName:"table"},(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"1"),(0,l.kt)("td",{parentName:"tr",align:null},"clock"),(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"uint64")),(0,l.kt)("td",{parentName:"tr",align:null},"clock value of the chat")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"2"),(0,l.kt)("td",{parentName:"tr",align:null},"id"),(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"string")),(0,l.kt)("td",{parentName:"tr",align:null},"id of the chat synced")))),(0,l.kt)("h3",{id:"syncpairinstallation"},"SyncPairInstallation"),(0,l.kt)("p",null,"The node uses ",(0,l.kt)("inlineCode",{parentName:"p"},"PairInstallation")," messages to propagate information\nabout a device to its paired devices."),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-protobuf"},"message SyncPairInstallation {\n  uint64 clock = 1;\n  string installation_id = 2;\n  string device_type = 3;\n  string name = 4;\n  // following fields used for local pairing\n  uint32 version = 5;\n}\n")),(0,l.kt)("p",null,"Payload"),(0,l.kt)("table",null,(0,l.kt)("thead",{parentName:"table"},(0,l.kt)("tr",{parentName:"thead"},(0,l.kt)("th",{parentName:"tr",align:null},"Field"),(0,l.kt)("th",{parentName:"tr",align:null},"Name"),(0,l.kt)("th",{parentName:"tr",align:null},"Type"),(0,l.kt)("th",{parentName:"tr",align:null},"Description"))),(0,l.kt)("tbody",{parentName:"table"},(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"1"),(0,l.kt)("td",{parentName:"tr",align:null},"clock"),(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"uint64")),(0,l.kt)("td",{parentName:"tr",align:null},"clock value of the chat")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"2"),(0,l.kt)("td",{parentName:"tr",align:null},"installation_id"),(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"string")),(0,l.kt)("td",{parentName:"tr",align:null},"A randomly generated id that identifies this device")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"3"),(0,l.kt)("td",{parentName:"tr",align:null},"device_type"),(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"string")),(0,l.kt)("td",{parentName:"tr",align:null},"The OS of the device ",(0,l.kt)("inlineCode",{parentName:"td"},"ios"),",",(0,l.kt)("inlineCode",{parentName:"td"},"android")," or ",(0,l.kt)("inlineCode",{parentName:"td"},"desktop"))),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"4"),(0,l.kt)("td",{parentName:"tr",align:null},"name"),(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"string")),(0,l.kt)("td",{parentName:"tr",align:null},"The self-assigned name of the device")))),(0,l.kt)("h3",{id:"chatidentity"},"ChatIdentity"),(0,l.kt)("p",null,(0,l.kt)("inlineCode",{parentName:"p"},"ChatIdentity")," represents the user defined identity associated\nwith their public chat key."),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-protobuf"},"message ChatIdentity {\n  uint64 clock = 1;\n  string ens_name = 2;\n  map&lt;string, IdentityImage&gt; images = 3;\n  string display_name = 4;\n  string description = 5;\n  string color = 6;\n  string emoji = 7;\n  repeated SocialLink social_links = 8;\n  // first known message timestamp in seconds \n  // (valid only for community chats for now)\n  // 0 - unknown\n  // 1 - no messages\n  uint32 first_message_timestamp = 9;\n}\n")),(0,l.kt)("p",null,"Payload"),(0,l.kt)("table",null,(0,l.kt)("thead",{parentName:"table"},(0,l.kt)("tr",{parentName:"thead"},(0,l.kt)("th",{parentName:"tr",align:null},"Field"),(0,l.kt)("th",{parentName:"tr",align:null},"Name"),(0,l.kt)("th",{parentName:"tr",align:null},"Type"),(0,l.kt)("th",{parentName:"tr",align:null},"Description"))),(0,l.kt)("tbody",{parentName:"table"},(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"1"),(0,l.kt)("td",{parentName:"tr",align:null},"clock"),(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"uint64")),(0,l.kt)("td",{parentName:"tr",align:null},"Clock value of the message")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"2"),(0,l.kt)("td",{parentName:"tr",align:null},"ens_name"),(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"string")),(0,l.kt)("td",{parentName:"tr",align:null},"A valid ENS associated with the chat key")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"3"),(0,l.kt)("td",{parentName:"tr",align:null},"images"),(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"map<string, IdentityImage>")),(0,l.kt)("td",{parentName:"tr",align:null},"Image data associated with the chat key")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"4"),(0,l.kt)("td",{parentName:"tr",align:null},"display_name"),(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"string")),(0,l.kt)("td",{parentName:"tr",align:null},"The self-assigned display_name of the chat key")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"5"),(0,l.kt)("td",{parentName:"tr",align:null},"description"),(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"string")),(0,l.kt)("td",{parentName:"tr",align:null},"The description of the chat")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"6"),(0,l.kt)("td",{parentName:"tr",align:null},"color"),(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"string")),(0,l.kt)("td",{parentName:"tr",align:null},"The color of the chat")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"7"),(0,l.kt)("td",{parentName:"tr",align:null},"emoji"),(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"string")),(0,l.kt)("td",{parentName:"tr",align:null},"The emoji of the chat")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"8"),(0,l.kt)("td",{parentName:"tr",align:null},"social_links"),(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"array<SocialLink>")),(0,l.kt)("td",{parentName:"tr",align:null},"A list of links to social platforms")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"9"),(0,l.kt)("td",{parentName:"tr",align:null},"first_message_timestamp"),(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"uint32")),(0,l.kt)("td",{parentName:"tr",align:null},"First known message timestamp in seconds")))),(0,l.kt)("h3",{id:"communitydescription"},"CommunityDescription"),(0,l.kt)("p",null,(0,l.kt)("inlineCode",{parentName:"p"},"CommunityDescription")," represents a community metadata\nthat is used to discover communities and share community updates."),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-protobuf"},'message CommunityDescription {\n  uint64 clock = 1;\n  map&lt;string,CommunityMember&gt; members = 2;\n  CommunityPermissions permissions = 3;\n  ChatIdentity identity = 5;\n  map&lt;string,CommunityChat&gt; chats = 6;\n  repeated string ban_list = 7;\n  map&lt;string,CommunityCategory&gt; categories = 8;\n  uint64 archive_magnetlink_clock = 9;\n  CommunityAdminSettings admin_settings = 10;\n  string intro_message = 11;\n  string outro_message = 12;\n  bool encrypted = 13;\n  repeated string tags = 14;\n  map&lt;string, CommunityTokenPermission&gt; token_permissions = 15;\n  repeated CommunityTokenMetadata community_tokens_metadata = 16;\n  uint64 active_members_count = 17;\n}\n\nmessage CommunityMember {\n  enum Roles {\n    reserved 2, 3;\n    reserved "ROLE_MANAGE_USERS", "ROLE_MODERATE_CONTENT";\n    ROLE_NONE = 0;\n    ROLE_OWNER = 1;\n    ROLE_ADMIN = 4;\n    ROLE_TOKEN_MASTER = 5;\n  }\n  repeated Roles roles = 1;\n  repeated RevealedAccount revealed_accounts = 2 [deprecated = true];\n  uint64 last_update_clock = 3;\n}\n\nmessage CommunityPermissions {\n  enum Access {\n    UNKNOWN_ACCESS = 0;\n    NO_MEMBERSHIP = 1;\n    INVITATION_ONLY = 2;\n    ON_REQUEST = 3;\n  }\n\n  bool ens_only = 1;\n  // https://gitlab.matrix.org/matrix-org/olm/blob/master/docs/megolm.md is a \n  // candidate for the algorithm to be used in case we want to have private \n  // communityal chats, lighter than pairwise encryption using the DR, less secure,\n  // but more efficient for large number of participants\n  bool private = 2;\n  Access access = 3;\n}\n')),(0,l.kt)("p",null,"Payload"),(0,l.kt)("table",null,(0,l.kt)("thead",{parentName:"table"},(0,l.kt)("tr",{parentName:"thead"},(0,l.kt)("th",{parentName:"tr",align:null},"Field"),(0,l.kt)("th",{parentName:"tr",align:null},"Name"),(0,l.kt)("th",{parentName:"tr",align:null},"Type"),(0,l.kt)("th",{parentName:"tr",align:null},"Description"))),(0,l.kt)("tbody",{parentName:"table"},(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"1"),(0,l.kt)("td",{parentName:"tr",align:null},"clock"),(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"uint64")),(0,l.kt)("td",{parentName:"tr",align:null},"Clock value of the message")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"2"),(0,l.kt)("td",{parentName:"tr",align:null},"members"),(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"map<string, CommunityMember>")),(0,l.kt)("td",{parentName:"tr",align:null},"The members of the community")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"3"),(0,l.kt)("td",{parentName:"tr",align:null},"permissions"),(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"CommunityPermissions")),(0,l.kt)("td",{parentName:"tr",align:null},"Image data associated with the chat key")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"4"),(0,l.kt)("td",{parentName:"tr",align:null},"display_name"),(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"string")),(0,l.kt)("td",{parentName:"tr",align:null},"The self-assigned display_name of the chat key")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"5"),(0,l.kt)("td",{parentName:"tr",align:null},"description"),(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"string")),(0,l.kt)("td",{parentName:"tr",align:null},"The description of the chat")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"6"),(0,l.kt)("td",{parentName:"tr",align:null},"color"),(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"string")),(0,l.kt)("td",{parentName:"tr",align:null},"The color of the chat")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"7"),(0,l.kt)("td",{parentName:"tr",align:null},"emoji"),(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"string")),(0,l.kt)("td",{parentName:"tr",align:null},"The emoji of the chat")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"8"),(0,l.kt)("td",{parentName:"tr",align:null},"social_links"),(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"array<SocialLink>")),(0,l.kt)("td",{parentName:"tr",align:null},"A list of links to social platforms")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"9"),(0,l.kt)("td",{parentName:"tr",align:null},"first_message_timestamp"),(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"uint32")),(0,l.kt)("td",{parentName:"tr",align:null},"First known message timestamp in seconds")))),(0,l.kt)("h3",{id:"communityrequesttojoin"},"CommunityRequestToJoin"),(0,l.kt)("p",null,"A ",(0,l.kt)("inlineCode",{parentName:"p"},"CommunityRequestToJoin")," represents a request to join a community,\nsent by a user that is not yet a member of that community.\nA request to join a community includes a list of ",(0,l.kt)("inlineCode",{parentName:"p"},"RevealedAccount"),".\nThese are wallet addresses that users are willing to reveal\nwith the community's control node and admins."),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-protobuf"},"message CommunityRequestToJoin {\n  uint64 clock = 1;\n  string ens_name = 2;\n  string chat_id = 3;\n  bytes community_id = 4;\n  string display_name = 5;\n  repeated RevealedAccount revealed_accounts = 6;\n}\n\nmessage RevealedAccount {\n  string address = 1;\n  bytes signature = 2;\n  repeated uint64 chain_ids = 3;\n  bool isAirdropAddress = 4;\n}\n")),(0,l.kt)("p",null,"Payload"),(0,l.kt)("table",null,(0,l.kt)("thead",{parentName:"table"},(0,l.kt)("tr",{parentName:"thead"},(0,l.kt)("th",{parentName:"tr",align:null},"Field"),(0,l.kt)("th",{parentName:"tr",align:null},"Name"),(0,l.kt)("th",{parentName:"tr",align:null},"Type"),(0,l.kt)("th",{parentName:"tr",align:null},"Description"))),(0,l.kt)("tbody",{parentName:"table"},(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"1"),(0,l.kt)("td",{parentName:"tr",align:null},"clock"),(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"uint64")),(0,l.kt)("td",{parentName:"tr",align:null},"Clock value of the message")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"2"),(0,l.kt)("td",{parentName:"tr",align:null},"ens_name"),(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"string")),(0,l.kt)("td",{parentName:"tr",align:null},"The ENS of the user sending the request")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"3"),(0,l.kt)("td",{parentName:"tr",align:null},"chat_id"),(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"string")),(0,l.kt)("td",{parentName:"tr",align:null},"The id of the chat to request access to")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"4"),(0,l.kt)("td",{parentName:"tr",align:null},"community_id"),(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"bytes")),(0,l.kt)("td",{parentName:"tr",align:null},"The public key of the community")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"5"),(0,l.kt)("td",{parentName:"tr",align:null},"display_name"),(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"string")),(0,l.kt)("td",{parentName:"tr",align:null},"The display name of the usre sending the request")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"6"),(0,l.kt)("td",{parentName:"tr",align:null},"revealed_accounts"),(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"array<RevealedAccount>")),(0,l.kt)("td",{parentName:"tr",align:null},"A list of accounts to reveal to the control node")))),(0,l.kt)("h3",{id:"pinmessage"},"PinMessage"),(0,l.kt)("p",null,"A ",(0,l.kt)("inlineCode",{parentName:"p"},"PinMessage")," is a signal that tells a client that a specific message\nhas to be marked as pinned."),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-protobuf"},"message PinMessage {\n  uint64 clock = 1;\n  string message_id = 2;\n  string chat_id = 3;\n  bool pinned = 4;\n  MessageType message_type = 5;\n}\n")),(0,l.kt)("p",null,"Payload"),(0,l.kt)("table",null,(0,l.kt)("thead",{parentName:"table"},(0,l.kt)("tr",{parentName:"thead"},(0,l.kt)("th",{parentName:"tr",align:null},"Field"),(0,l.kt)("th",{parentName:"tr",align:null},"Name"),(0,l.kt)("th",{parentName:"tr",align:null},"Type"),(0,l.kt)("th",{parentName:"tr",align:null},"Description"))),(0,l.kt)("tbody",{parentName:"table"},(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"1"),(0,l.kt)("td",{parentName:"tr",align:null},"clock"),(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"uint64")),(0,l.kt)("td",{parentName:"tr",align:null},"Clock value of the message")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"2"),(0,l.kt)("td",{parentName:"tr",align:null},"message_id"),(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"string")),(0,l.kt)("td",{parentName:"tr",align:null},"The id of the message to be pinned")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"3"),(0,l.kt)("td",{parentName:"tr",align:null},"chat_id"),(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"string")),(0,l.kt)("td",{parentName:"tr",align:null},"The id of the chat of the message to be pinned")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"4"),(0,l.kt)("td",{parentName:"tr",align:null},"pinned"),(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"bool")),(0,l.kt)("td",{parentName:"tr",align:null},"Whether the message should be pinned or unpinned")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"5"),(0,l.kt)("td",{parentName:"tr",align:null},"message_type"),(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"MessageType")),(0,l.kt)("td",{parentName:"tr",align:null},"The type of message (public/one-to-one/private-group-chat)")))),(0,l.kt)("h3",{id:"editmessage"},"EditMessage"),(0,l.kt)("p",null,"A ",(0,l.kt)("inlineCode",{parentName:"p"},"EditMessage")," represents an update to an existing message."),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-protobuf"},"message EditMessage {\n  uint64 clock = 1;\n  string text = 2;\n\n  string chat_id = 3;\n  string message_id = 4;\n\n  bytes grant = 5;\n\n  MessageType message_type = 6;\n\n  ChatMessage.ContentType content_type = 7;\n  repeated UnfurledLink unfurled_links = 8;\n}\n\n")),(0,l.kt)("p",null,"Payload"),(0,l.kt)("table",null,(0,l.kt)("thead",{parentName:"table"},(0,l.kt)("tr",{parentName:"thead"},(0,l.kt)("th",{parentName:"tr",align:null},"Field"),(0,l.kt)("th",{parentName:"tr",align:null},"Name"),(0,l.kt)("th",{parentName:"tr",align:null},"Type"),(0,l.kt)("th",{parentName:"tr",align:null},"Description"))),(0,l.kt)("tbody",{parentName:"table"},(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"1"),(0,l.kt)("td",{parentName:"tr",align:null},"clock"),(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"uint64")),(0,l.kt)("td",{parentName:"tr",align:null},"Clock value of the message")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"2"),(0,l.kt)("td",{parentName:"tr",align:null},"text"),(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"string")),(0,l.kt)("td",{parentName:"tr",align:null},"The updated message text")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"3"),(0,l.kt)("td",{parentName:"tr",align:null},"chat_id"),(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"string")),(0,l.kt)("td",{parentName:"tr",align:null},"The id of the chat of the message")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"4"),(0,l.kt)("td",{parentName:"tr",align:null},"message_id"),(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"string")),(0,l.kt)("td",{parentName:"tr",align:null},"The id of the message to be edited")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"5"),(0,l.kt)("td",{parentName:"tr",align:null},"grant"),(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"bytes")),(0,l.kt)("td",{parentName:"tr",align:null},"A grant for a community edit messages")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"6"),(0,l.kt)("td",{parentName:"tr",align:null},"message_type"),(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"MessageType")),(0,l.kt)("td",{parentName:"tr",align:null},"The type of message")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"7"),(0,l.kt)("td",{parentName:"tr",align:null},"content_type"),(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"ChatMessage.ContentType")),(0,l.kt)("td",{parentName:"tr",align:null},"The updated content type of the message")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"8"),(0,l.kt)("td",{parentName:"tr",align:null},"unfurled_links"),(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"array<UnfurledLink>")),(0,l.kt)("td",{parentName:"tr",align:null},"Updated link metadata")))),(0,l.kt)("h3",{id:"deletemessage"},"DeleteMessage"),(0,l.kt)("p",null,"A ",(0,l.kt)("inlineCode",{parentName:"p"},"DeleteMessage")," represents a signal to delete a message\nfrom the local database of a client."),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-protobuf"},"message DeleteMessage {\n  uint64 clock = 1;\n\n  string chat_id = 2;\n  string message_id = 3;\n\n  // Grant for community delete messages\n  bytes grant = 4;\n\n  // The type of message (public/one-to-one/private-group-chat)\n  MessageType message_type = 5;\n\n  string deleted_by = 6;\n}\n")),(0,l.kt)("p",null,"Payload"),(0,l.kt)("table",null,(0,l.kt)("thead",{parentName:"table"},(0,l.kt)("tr",{parentName:"thead"},(0,l.kt)("th",{parentName:"tr",align:null},"Field"),(0,l.kt)("th",{parentName:"tr",align:null},"Name"),(0,l.kt)("th",{parentName:"tr",align:null},"Type"),(0,l.kt)("th",{parentName:"tr",align:null},"Description"))),(0,l.kt)("tbody",{parentName:"table"},(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"1"),(0,l.kt)("td",{parentName:"tr",align:null},"clock"),(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"uint64")),(0,l.kt)("td",{parentName:"tr",align:null},"Clock value of the message")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"2"),(0,l.kt)("td",{parentName:"tr",align:null},"chat_id"),(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"string")),(0,l.kt)("td",{parentName:"tr",align:null},"The id of the chat of the message")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"3"),(0,l.kt)("td",{parentName:"tr",align:null},"message_id"),(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"string")),(0,l.kt)("td",{parentName:"tr",align:null},"The id of the message to delete")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"4"),(0,l.kt)("td",{parentName:"tr",align:null},"grant"),(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"bytes")),(0,l.kt)("td",{parentName:"tr",align:null},"A grant for a community edit messages")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"5"),(0,l.kt)("td",{parentName:"tr",align:null},"message_type"),(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"MessageType")),(0,l.kt)("td",{parentName:"tr",align:null},"The type of message")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"6"),(0,l.kt)("td",{parentName:"tr",align:null},"deleted_by"),(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"string")),(0,l.kt)("td",{parentName:"tr",align:null},"The public key of the user who deleted the message")))),(0,l.kt)("h3",{id:"communitymessagearchivelink"},"CommunityMessageArchiveLink"),(0,l.kt)("p",null,"A ",(0,l.kt)("inlineCode",{parentName:"p"},"CommunityMessageArchiveLink")," contains a magnet uri for a community's message archive,\ncreated using ",(0,l.kt)("a",{parentName:"p",href:"../61/community-history-service"},"61/STATUS-Community-History-Archives"),"."),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-protobuf"},"message CommunityMessageArchiveMagnetlink {\n  uint64 clock = 1;\n  string magnet_uri = 2;\n}\n")),(0,l.kt)("p",null,"Payload"),(0,l.kt)("table",null,(0,l.kt)("thead",{parentName:"table"},(0,l.kt)("tr",{parentName:"thead"},(0,l.kt)("th",{parentName:"tr",align:null},"Field"),(0,l.kt)("th",{parentName:"tr",align:null},"Name"),(0,l.kt)("th",{parentName:"tr",align:null},"Type"),(0,l.kt)("th",{parentName:"tr",align:null},"Description"))),(0,l.kt)("tbody",{parentName:"table"},(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"1"),(0,l.kt)("td",{parentName:"tr",align:null},"clock"),(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"uint64")),(0,l.kt)("td",{parentName:"tr",align:null},"Clock value of the message")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"2"),(0,l.kt)("td",{parentName:"tr",align:null},"magnet_uri"),(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"string")),(0,l.kt)("td",{parentName:"tr",align:null},"The magnet uri of the community archive torrent")))),(0,l.kt)("h3",{id:"acceptcontactrequest"},"AcceptContactRequest"),(0,l.kt)("p",null,"A ",(0,l.kt)("inlineCode",{parentName:"p"},"AcceptContractRequest")," message signals to the requester that the request was accepted."),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-protobuf"},"message AcceptContactRequest {\n  string id = 1;\n  uint64 clock = 2;\n}\n\n")),(0,l.kt)("p",null,"Payload"),(0,l.kt)("table",null,(0,l.kt)("thead",{parentName:"table"},(0,l.kt)("tr",{parentName:"thead"},(0,l.kt)("th",{parentName:"tr",align:null},"Field"),(0,l.kt)("th",{parentName:"tr",align:null},"Name"),(0,l.kt)("th",{parentName:"tr",align:null},"Type"),(0,l.kt)("th",{parentName:"tr",align:null},"Description"))),(0,l.kt)("tbody",{parentName:"table"},(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"1"),(0,l.kt)("td",{parentName:"tr",align:null},"id"),(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"string")),(0,l.kt)("td",{parentName:"tr",align:null},"The id of the contact request")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"2"),(0,l.kt)("td",{parentName:"tr",align:null},"clock"),(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"uint64")),(0,l.kt)("td",{parentName:"tr",align:null},"Clock value of the message")))),(0,l.kt)("h3",{id:"retractcontactrequest"},"RetractContactRequest"),(0,l.kt)("p",null,"A ",(0,l.kt)("inlineCode",{parentName:"p"},"RetractContractRequest")," message signals to the reiver, of a request,\nthat the request was retracted."),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-protobuf"},"message RetractContactRequest {\n  string id = 1;\n  uint64 clock = 2;\n}\n\n")),(0,l.kt)("p",null,"Payload"),(0,l.kt)("table",null,(0,l.kt)("thead",{parentName:"table"},(0,l.kt)("tr",{parentName:"thead"},(0,l.kt)("th",{parentName:"tr",align:null},"Field"),(0,l.kt)("th",{parentName:"tr",align:null},"Name"),(0,l.kt)("th",{parentName:"tr",align:null},"Type"),(0,l.kt)("th",{parentName:"tr",align:null},"Description"))),(0,l.kt)("tbody",{parentName:"table"},(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"1"),(0,l.kt)("td",{parentName:"tr",align:null},"id"),(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"string")),(0,l.kt)("td",{parentName:"tr",align:null},"The id of the contact request")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"2"),(0,l.kt)("td",{parentName:"tr",align:null},"clock"),(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"uint64")),(0,l.kt)("td",{parentName:"tr",align:null},"Clock value of the message")))),(0,l.kt)("h3",{id:"communityrequesttojoinresponse"},"CommunityRequestToJoinResponse"),(0,l.kt)("p",null,"A ",(0,l.kt)("inlineCode",{parentName:"p"},"CommunityRequestToJoinResponse")," represents a response to a request to join a community."),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-protobuf"},"message CommunityRequestToJoinResponse {\n  uint64 clock = 1;\n  CommunityDescription community = 2;\n  bool accepted = 3;\n  bytes grant = 4;\n  bytes community_id = 5;\n  string magnet_uri = 6;\n}\n")),(0,l.kt)("p",null,"Payload"),(0,l.kt)("table",null,(0,l.kt)("thead",{parentName:"table"},(0,l.kt)("tr",{parentName:"thead"},(0,l.kt)("th",{parentName:"tr",align:null},"Field"),(0,l.kt)("th",{parentName:"tr",align:null},"Name"),(0,l.kt)("th",{parentName:"tr",align:null},"Type"),(0,l.kt)("th",{parentName:"tr",align:null},"Description"))),(0,l.kt)("tbody",{parentName:"table"},(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"1"),(0,l.kt)("td",{parentName:"tr",align:null},"clock"),(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"uint64")),(0,l.kt)("td",{parentName:"tr",align:null},"Clock value of the message")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"2"),(0,l.kt)("td",{parentName:"tr",align:null},"community"),(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"CommunityDescription")),(0,l.kt)("td",{parentName:"tr",align:null},"The community metadata")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"3"),(0,l.kt)("td",{parentName:"tr",align:null},"accepted"),(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"bool")),(0,l.kt)("td",{parentName:"tr",align:null},"Whether the request was accepted")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"4"),(0,l.kt)("td",{parentName:"tr",align:null},"grant"),(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"bytes")),(0,l.kt)("td",{parentName:"tr",align:null},"The grant")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"5"),(0,l.kt)("td",{parentName:"tr",align:null},"community_id"),(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"bytes")),(0,l.kt)("td",{parentName:"tr",align:null},"The id of the community")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"6"),(0,l.kt)("td",{parentName:"tr",align:null},"magnet_uri"),(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"string")),(0,l.kt)("td",{parentName:"tr",align:null},"The latest magnet uri of the community's archive torrent")))),(0,l.kt)("h3",{id:"communityrequesttoleave"},"CommunityRequestToLeave"),(0,l.kt)("p",null,"A ",(0,l.kt)("inlineCode",{parentName:"p"},"CommunityRequestToLeave")," represents a signal to a community\nthat a user wants to be removed from the community's member list."),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-protobuf"},"message CommunityRequestToLeave {\n  uint64 clock = 1;\n  bytes community_id = 2;\n}\n")),(0,l.kt)("p",null,"Payload"),(0,l.kt)("table",null,(0,l.kt)("thead",{parentName:"table"},(0,l.kt)("tr",{parentName:"thead"},(0,l.kt)("th",{parentName:"tr",align:null},"Field"),(0,l.kt)("th",{parentName:"tr",align:null},"Name"),(0,l.kt)("th",{parentName:"tr",align:null},"Type"),(0,l.kt)("th",{parentName:"tr",align:null},"Description"))),(0,l.kt)("tbody",{parentName:"table"},(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"1"),(0,l.kt)("td",{parentName:"tr",align:null},"clock"),(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"uint64")),(0,l.kt)("td",{parentName:"tr",align:null},"Clock value of the message")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"2"),(0,l.kt)("td",{parentName:"tr",align:null},"community_id"),(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"bytes")),(0,l.kt)("td",{parentName:"tr",align:null},"The id of the community")))),(0,l.kt)("h3",{id:"requestcontactverification"},"RequestContactVerification"),(0,l.kt)("p",null,"A ",(0,l.kt)("inlineCode",{parentName:"p"},"RequestContactVerification"),' is a request to verify a contact using a "challenge",\nwhich can by any string message and\ntypically involves questions that only the contact should know.'),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-protobuf"},"message RequestContactVerification {\n  uint64 clock = 1;\n  string challenge = 3;\n}\n")),(0,l.kt)("p",null,"Payload"),(0,l.kt)("table",null,(0,l.kt)("thead",{parentName:"table"},(0,l.kt)("tr",{parentName:"thead"},(0,l.kt)("th",{parentName:"tr",align:null},"Field"),(0,l.kt)("th",{parentName:"tr",align:null},"Name"),(0,l.kt)("th",{parentName:"tr",align:null},"Type"),(0,l.kt)("th",{parentName:"tr",align:null},"Description"))),(0,l.kt)("tbody",{parentName:"table"},(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"1"),(0,l.kt)("td",{parentName:"tr",align:null},"clock"),(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"uint64")),(0,l.kt)("td",{parentName:"tr",align:null},"Clock value of the message")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"2"),(0,l.kt)("td",{parentName:"tr",align:null},"challenge"),(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"string")),(0,l.kt)("td",{parentName:"tr",align:null},"The challenge message used for verification")))),(0,l.kt)("h3",{id:"acceptcontactverification"},"AcceptContactVerification"),(0,l.kt)("p",null,"A ",(0,l.kt)("inlineCode",{parentName:"p"},"AcceptContactVerification")," signals that a verification request was accepted and\nincludes a response to the challenge."),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-protobuf"},"message AcceptContactVerification {\n  uint64 clock = 1;\n  string id = 2;\n  string response = 3;\n}\n")),(0,l.kt)("p",null,"Payload"),(0,l.kt)("table",null,(0,l.kt)("thead",{parentName:"table"},(0,l.kt)("tr",{parentName:"thead"},(0,l.kt)("th",{parentName:"tr",align:null},"Field"),(0,l.kt)("th",{parentName:"tr",align:null},"Name"),(0,l.kt)("th",{parentName:"tr",align:null},"Type"),(0,l.kt)("th",{parentName:"tr",align:null},"Description"))),(0,l.kt)("tbody",{parentName:"table"},(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"1"),(0,l.kt)("td",{parentName:"tr",align:null},"clock"),(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"uint64")),(0,l.kt)("td",{parentName:"tr",align:null},"Clock value of the message")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"2"),(0,l.kt)("td",{parentName:"tr",align:null},"id"),(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"string")),(0,l.kt)("td",{parentName:"tr",align:null},"The verification request id")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"3"),(0,l.kt)("td",{parentName:"tr",align:null},"response"),(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"string")),(0,l.kt)("td",{parentName:"tr",align:null},"The response for the challenge")))),(0,l.kt)("h3",{id:"declinecontactverification"},"DeclineContactVerification"),(0,l.kt)("p",null,"A ",(0,l.kt)("inlineCode",{parentName:"p"},"DeclineContactVerification")," declines a contact verification request."),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-protobuf"},"message DeclineContactVerification {\n  uint64 clock = 1;\n  string id = 2;\n}\n")),(0,l.kt)("p",null,"Payload"),(0,l.kt)("table",null,(0,l.kt)("thead",{parentName:"table"},(0,l.kt)("tr",{parentName:"thead"},(0,l.kt)("th",{parentName:"tr",align:null},"Field"),(0,l.kt)("th",{parentName:"tr",align:null},"Name"),(0,l.kt)("th",{parentName:"tr",align:null},"Type"),(0,l.kt)("th",{parentName:"tr",align:null},"Description"))),(0,l.kt)("tbody",{parentName:"table"},(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"1"),(0,l.kt)("td",{parentName:"tr",align:null},"clock"),(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"uint64")),(0,l.kt)("td",{parentName:"tr",align:null},"Clock value of the message")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"2"),(0,l.kt)("td",{parentName:"tr",align:null},"id"),(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"string")),(0,l.kt)("td",{parentName:"tr",align:null},"The verification request id")))),(0,l.kt)("h3",{id:"cancelcontactverification"},"CancelContactVerification"),(0,l.kt)("p",null,"A ",(0,l.kt)("inlineCode",{parentName:"p"},"CancelContactVerification")," cancels a contact verification request."),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-protobuf"},"message CancelContactVerification {\n  uint64 clock = 1;\n  string id = 2;\n}\n")),(0,l.kt)("p",null,"Payload"),(0,l.kt)("table",null,(0,l.kt)("thead",{parentName:"table"},(0,l.kt)("tr",{parentName:"thead"},(0,l.kt)("th",{parentName:"tr",align:null},"Field"),(0,l.kt)("th",{parentName:"tr",align:null},"Name"),(0,l.kt)("th",{parentName:"tr",align:null},"Type"),(0,l.kt)("th",{parentName:"tr",align:null},"Description"))),(0,l.kt)("tbody",{parentName:"table"},(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"1"),(0,l.kt)("td",{parentName:"tr",align:null},"clock"),(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"uint64")),(0,l.kt)("td",{parentName:"tr",align:null},"Clock value of the message")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"2"),(0,l.kt)("td",{parentName:"tr",align:null},"id"),(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"string")),(0,l.kt)("td",{parentName:"tr",align:null},"The verification request id")))),(0,l.kt)("h3",{id:"communitycancelrequesttojoin"},"CommunityCancelRequestToJoin"),(0,l.kt)("p",null,"A ",(0,l.kt)("inlineCode",{parentName:"p"},"CommunityCancelRequestToJoin")," cancels a pending request to join."),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-protobuf"},"message CommunityCancelRequestToJoin {\n  uint64 clock = 1;\n  string ens_name = 2;\n  string chat_id = 3;\n  bytes community_id = 4;\n  string display_name = 5;\n}\n")),(0,l.kt)("p",null,"Payload"),(0,l.kt)("table",null,(0,l.kt)("thead",{parentName:"table"},(0,l.kt)("tr",{parentName:"thead"},(0,l.kt)("th",{parentName:"tr",align:null},"Field"),(0,l.kt)("th",{parentName:"tr",align:null},"Name"),(0,l.kt)("th",{parentName:"tr",align:null},"Type"),(0,l.kt)("th",{parentName:"tr",align:null},"Description"))),(0,l.kt)("tbody",{parentName:"table"},(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"1"),(0,l.kt)("td",{parentName:"tr",align:null},"clock"),(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"uint64")),(0,l.kt)("td",{parentName:"tr",align:null},"Clock value of the message")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"2"),(0,l.kt)("td",{parentName:"tr",align:null},"ens_name"),(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"string")),(0,l.kt)("td",{parentName:"tr",align:null},"The ENS name of the account cancelling the request")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"3"),(0,l.kt)("td",{parentName:"tr",align:null},"chat_id"),(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"string")),(0,l.kt)("td",{parentName:"tr",align:null},"The id of the chat")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"4"),(0,l.kt)("td",{parentName:"tr",align:null},"community_id"),(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"bytes")),(0,l.kt)("td",{parentName:"tr",align:null},"The id of the community")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"5"),(0,l.kt)("td",{parentName:"tr",align:null},"display_name"),(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"string")),(0,l.kt)("td",{parentName:"tr",align:null},"The display name of the account cancelling the request")))),(0,l.kt)("h3",{id:"communityeditsharedaddresses"},"CommunityEditSharedAddresses"),(0,l.kt)("p",null,"A ",(0,l.kt)("inlineCode",{parentName:"p"},"CommunityEditSharedAddresses")," message allows users to edit the shared accounts\nthey've revealed when requesting to join a community."),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-protobuf"},"message CommunityEditSharedAddresses {\n  uint64 clock = 1;\n  bytes community_id = 2;\n  repeated RevealedAccount revealed_accounts = 3;\n}\n")),(0,l.kt)("p",null,"Payload"),(0,l.kt)("table",null,(0,l.kt)("thead",{parentName:"table"},(0,l.kt)("tr",{parentName:"thead"},(0,l.kt)("th",{parentName:"tr",align:null},"Field"),(0,l.kt)("th",{parentName:"tr",align:null},"Name"),(0,l.kt)("th",{parentName:"tr",align:null},"Type"),(0,l.kt)("th",{parentName:"tr",align:null},"Description"))),(0,l.kt)("tbody",{parentName:"table"},(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"1"),(0,l.kt)("td",{parentName:"tr",align:null},"clock"),(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"uint64")),(0,l.kt)("td",{parentName:"tr",align:null},"Clock value of the message")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"2"),(0,l.kt)("td",{parentName:"tr",align:null},"community_id"),(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"bytes")),(0,l.kt)("td",{parentName:"tr",align:null},"The id of the community")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"3"),(0,l.kt)("td",{parentName:"tr",align:null},"revealed_accounts"),(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"array&lt;RevealedAccount&gt;")),(0,l.kt)("td",{parentName:"tr",align:null},"A list of revealed accounts")))),(0,l.kt)("h2",{id:"upgradability"},"Upgradability"),(0,l.kt)("p",null,"There are two ways to upgrade the protocol without breaking compatibility:"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"A node always supports accretion"),(0,l.kt)("li",{parentName:"ul"},"A node does not support deletion of existing fields or messages,\nwhich might break compatibility")),(0,l.kt)("h2",{id:"security-considerations"},"Security Considerations"),(0,l.kt)("h2",{id:"changelog"},"Changelog"),(0,l.kt)("h3",{id:"version-05"},"Version 0.5"),(0,l.kt)("p",null,"Released ",(0,l.kt)("a",{parentName:"p",href:"https://github.com/status-im/specs/commit/968fafff23cdfc67589b34dd64015de29aaf41f0"},"August 25, 2020")),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"Added support for emoji reactions")),(0,l.kt)("h3",{id:"version-04"},"Version 0.4"),(0,l.kt)("p",null,"Released ",(0,l.kt)("a",{parentName:"p",href:"https://github.com/status-im/specs/commit/ad45cd5fed3c0f79dfa472253a404f670dd47396"},"July 16, 2020")),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"Added support for images"),(0,l.kt)("li",{parentName:"ul"},"Added support for audio")),(0,l.kt)("h3",{id:"version-03"},"Version 0.3"),(0,l.kt)("p",null,"Released ",(0,l.kt)("a",{parentName:"p",href:"https://github.com/status-im/specs/commit/664dd1c9df6ad409e4c007fefc8c8945b8d324e8"},"May 22, 2020")),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"Added language to include Waku in all relevant places")),(0,l.kt)("h2",{id:"copyright"},"Copyright"),(0,l.kt)("p",null,"Copyright and related rights waived via ",(0,l.kt)("a",{parentName:"p",href:"https://creativecommons.org/publicdomain/zero/1.0/"},"CC0"),"."))}d.isMDXComponent=!0},3905:(t,e,a)=>{a.d(e,{Zo:()=>m,kt:()=>k});var n=a(67294);function l(t,e,a){return e in t?Object.defineProperty(t,e,{value:a,enumerable:!0,configurable:!0,writable:!0}):t[e]=a,t}function r(t,e){var a=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),a.push.apply(a,n)}return a}function i(t){for(var e=1;e<arguments.length;e++){var a=null!=arguments[e]?arguments[e]:{};e%2?r(Object(a),!0).forEach((function(e){l(t,e,a[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(a)):r(Object(a)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(a,e))}))}return t}function o(t,e){if(null==t)return{};var a,n,l=function(t,e){if(null==t)return{};var a,n,l={},r=Object.keys(t);for(n=0;n<r.length;n++)a=r[n],e.indexOf(a)>=0||(l[a]=t[a]);return l}(t,e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);for(n=0;n<r.length;n++)a=r[n],e.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(t,a)&&(l[a]=t[a])}return l}var s=n.createContext({}),p=function(t){var e=n.useContext(s),a=e;return t&&(a="function"==typeof t?t(e):i(i({},e),t)),a},m=function(t){var e=p(t.components);return n.createElement(s.Provider,{value:e},t.children)},d={inlineCode:"code",wrapper:function(t){var e=t.children;return n.createElement(n.Fragment,{},e)}},u=n.forwardRef((function(t,e){var a=t.components,l=t.mdxType,r=t.originalType,s=t.parentName,m=o(t,["components","mdxType","originalType","parentName"]),u=p(a),k=l,c=u["".concat(s,".").concat(k)]||u[k]||d[k]||r;return a?n.createElement(c,i(i({ref:e},m),{},{components:a})):n.createElement(c,i({ref:e},m))}));function k(t,e){var a=arguments,l=e&&e.mdxType;if("string"==typeof t||l){var r=a.length,i=new Array(r);i[0]=u;var o={};for(var s in e)hasOwnProperty.call(e,s)&&(o[s]=e[s]);o.originalType=t,o.mdxType="string"==typeof t?t:l,i[1]=o;for(var p=2;p<r;p++)i[p]=a[p];return n.createElement.apply(null,i)}return n.createElement.apply(null,a)}u.displayName="MDXCreateElement"}}]);